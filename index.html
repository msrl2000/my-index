<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- Enhanced Content Security Policy to prevent XSS attacks and improve security -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https: blob:;
        connect-src 'self' https: http: blob:;
        font-src 'self' data:;
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
        upgrade-insecure-requests;
    ">
    
    <!-- Google Analytics will be loaded dynamically based on settings -->
    
    <!-- LZString compression library -->
    <script>
        var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function(o){if(null==o)return"";var r=i._compress(o,6,function(o){return n.charAt(o)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},compressToUTF16:function(o){return null==o?"":i._compress(o,15,function(o){return r(o+32)})+" "},decompressFromUTF16:function(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return e.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);
    </script>
    
    <title>Personal Services Index</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    <style>
        :root {
            --bg-primary: #f0f4f8;
            --bg-secondary: #e2e8f0;
            --bg-tertiary: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #475569;
            --card-bg: rgba(255,255,255,0.9);
            --card-border: rgba(71, 85, 105, 0.2);
            --header-bg: rgba(255,255,255,0.9);
            --header-border: rgba(71, 85, 105, 0.2);
            --btn-secondary-bg: rgba(148, 163, 184, 0.2);
            --btn-secondary-border: rgba(71, 85, 105, 0.3);
            --input-bg: rgba(255, 255, 255, 0.9);
            --input-border: rgba(71, 85, 105, 0.3);
            --modal-bg: rgb(255, 255, 255);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-color-hover: rgba(0, 0, 0, 0.15);
            --accent-color: #3b82f6;
            --accent-color-light: #dbeafe;
            --accent-color-dark: #2563eb;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --card-bg: rgba(30, 41, 59, 0.9);
            --card-border: rgba(148, 163, 184, 0.2);
            --header-bg: rgba(30, 41, 59, 0.9);
            --header-border: rgba(148, 163, 184, 0.2);
            --btn-secondary-bg: rgba(148, 163, 184, 0.1);
            --btn-secondary-border: rgba(148, 163, 184, 0.3);
            --input-bg: rgba(30, 41, 59, 0.9);
            --input-border: rgba(148, 163, 184, 0.3);
            --modal-bg: rgb(15, 23, 42);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-color-hover: rgba(0, 0, 0, 0.4);
            --accent-color: #60a5fa;
            --accent-color-light: rgba(96, 165, 250, 0.2);
            --accent-color-dark: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--header-bg) 0%, var(--card-bg) 100%);
            border-radius: 1rem;
            border: 1px solid var(--header-border);
            backdrop-filter: blur(10px);
        }

        .header-title-section {
            flex: 1;
            text-align: left;
            position: relative;
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .search-container {
            position: relative;
        }

        .search-clear-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
        }

        .search-clear-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        .search-clear-btn.visible {
            opacity: 1;
        }

        [dir="rtl"] .search-clear-btn {
            right: auto;
            left: 0.75rem;
        }

        .search-input {
            background: var(--card-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            width: 200px;
            height: 3rem;
            transition: all 0.3s;
            box-sizing: border-box;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .header-icon-btn {
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-muted);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 3rem;
            height: 3rem;
        }

        .header-icon-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .header h1 .edit-btn,
        .header p .edit-btn {
            opacity: 0;
            transition: opacity 0.2s;
            margin-left: 0.5rem;
            pointer-events: none;
            display: inline-flex;
            vertical-align: middle;
        }

        .header h1 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header h1:hover .edit-btn,
        .header p:hover .edit-btn {
            opacity: 0;
        }

        /* Show header edit buttons only in edit mode */
        .edit-mode .header h1 .edit-btn,
        .edit-mode .header p .edit-btn {
            opacity: 1;
            pointer-events: auto;
        }

        .edit-mode .header h1:hover .edit-btn,
        .edit-mode .header p:hover .edit-btn {
            opacity: 1;
        }

        /* Make header text non-clickable in non-edit mode */
        .header h1,
        .header p {
            cursor: default;
        }

        /* Make header text clickable only in edit mode */
        .edit-mode .header h1,
        .edit-mode .header p {
            cursor: pointer;
        }

        .lang-toggle-btn {
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-muted);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 3rem;
            height: 3rem;
        }

        .lang-toggle-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .lang-icon {
            transition: transform 0.3s ease;
        }

        .dark-mode-toggle {
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-muted);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 3rem;
            height: 3rem;
        }

        .dark-mode-toggle:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .dark-mode-icon {
            transition: transform 0.3s ease;
        }

        [data-theme="dark"] .dark-mode-icon {
            transform: rotate(180deg);
        }

        /* Mobile Menu Styles */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 0.5rem;
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            transition: all 0.3s;
        }

        .hamburger-menu:hover {
            background: rgba(148, 163, 184, 0.2);
        }

        .hamburger-line {
            width: 20px;
            height: 2px;
            background: var(--text-muted);
            margin: 2px 0;
            transition: all 0.3s;
        }

        .hamburger-menu.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger-menu.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .hamburger-menu.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--shadow-color-hover);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: var(--modal-bg);
            backdrop-filter: blur(15px);
            border-left: 1px solid var(--card-border);
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
            padding: 1rem;
        }

        [dir="rtl"] .mobile-menu {
            right: auto;
            left: -300px;
            border-left: none;
            border-right: 1px solid var(--card-border);
        }

        .mobile-menu.active {
            right: 0;
        }

        [dir="rtl"] .mobile-menu.active {
            right: auto;
            left: 0;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--card-border);
        }

        .mobile-menu-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }

        .mobile-menu-close:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        /* Desktop Menu Styles */
        .desktop-menu {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: var(--modal-bg);
            border-left: 1px solid var(--border-color);
            box-shadow: -4px 0 15px var(--shadow-color);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .desktop-menu.show {
            transform: translateX(0);
        }

        /* RTL support for Hebrew */
        .desktop-menu[dir="rtl"] {
            right: auto;
            left: 0;
            border-left: none;
            border-right: 1px solid var(--border-color);
            box-shadow: 4px 0 15px var(--shadow-color);
            transform: translateX(-100%);
        }

        .desktop-menu[dir="rtl"].show {
            transform: translateX(0);
        }

        .desktop-menu-content {
            padding: 1.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .desktop-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .desktop-menu-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .desktop-menu-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }

        .desktop-menu-close:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        .desktop-menu-sections {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .desktop-menu-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .desktop-menu-section-title {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .desktop-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
            text-decoration: none;
        }

        .desktop-menu-item:hover {
            background: rgba(148, 163, 184, 0.1);
            transform: translateX(4px);
        }

        .desktop-menu-item-icon {
            font-size: 1.25rem;
            width: 1.5rem;
            text-align: center;
        }

        .desktop-menu-item-icon.disabled {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .desktop-menu-item-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .desktop-form-group {
            margin-bottom: 1.5rem;
        }

        .desktop-form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .desktop-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            box-sizing: border-box;
            transition: all 0.3s;
        }

        .desktop-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Mobile Google Analytics Input Styles */
        .mobile-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            box-sizing: border-box;
            transition: all 0.3s;
        }

        .mobile-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .mobile-form-group {
            margin-bottom: 1rem;
        }

        .mobile-form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .desktop-menu-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .desktop-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            flex: 1;
        }

        .desktop-btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .desktop-btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        /* iPhone-like Toggle Switch for Desktop Menu */
        .desktop-toggle-switch {
            position: relative;
            width: 51px;
            height: 31px;
            background: #ccc;
            border-radius: 31px;
            cursor: pointer;
            transition: background 0.3s ease;
            flex-shrink: 0;
            border: none;
            outline: none;
        }

        .desktop-toggle-switch.active {
            background: #34c759;
        }

        .desktop-toggle-switch:hover {
            background: #b3b3b3;
        }

        .desktop-toggle-switch.active:hover {
            background: #30d158;
        }

        .desktop-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 27px;
            height: 27px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .desktop-toggle-switch.active .desktop-toggle-slider {
            transform: translateX(20px);
        }

        .desktop-toggle-switch input {
            display: none;
        }

        /* Hide desktop menu on mobile */
        @media (max-width: 768px) {
            .desktop-menu {
                display: none;
            }
        }

        /* Hide specific buttons in desktop mode */
        @media (min-width: 769px) {
            .dark-mode-toggle,
            .lang-toggle-btn,
            #shareBtn,
            #editModeToggle,
            .header-icon-btn[onclick*="importFile"] {
                display: none !important;
            }
        }

        .mobile-menu-section {
            margin-bottom: 1.5rem;
        }

        .mobile-menu-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mobile-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
            text-decoration: none;
        }

        .mobile-menu-item:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .mobile-menu-item-icon {
            font-size: 1.25rem;
            min-width: 1.5rem;
            text-align: center;
        }

        .mobile-menu-item-icon.disabled {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .mobile-menu-item-text {
            flex: 1;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .mobile-search-container {
            margin-bottom: 1rem;
        }

        .mobile-search-wrapper {
            position: relative;
        }

        .mobile-search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            padding-right: 2.5rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            box-sizing: border-box;
        }

        .mobile-search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .mobile-search-clear-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
        }

        .mobile-search-clear-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        .mobile-search-clear-btn.visible {
            opacity: 1;
        }

        [dir="rtl"] .mobile-search-clear-btn {
            right: auto;
            left: 0.75rem;
        }

        [dir="rtl"] .mobile-search-input {
            padding-left: 2.5rem;
            padding-right: 1rem;
        }

        /* Mobile Responsive Breakpoints */
        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
            }

            .header-controls {
                display: none;
            }

            .search-container {
                display: none;
            }

            .header {
                padding: 0.75rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.875rem;
            }

            .categories-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .category-card {
                padding: 1rem;
            }

            .server-item {
                padding: 0.75rem;
            }

            .modal {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }

                    /* Mobile: Show server controls on touch */
        .server-controls {
            opacity: 1;
        }

        /* Mobile: Add touch feedback */
        .server-item:active {
            transform: scale(0.98);
        }



        /* Mobile URL button - only show in view mode on mobile */
        .mobile-url-btn {
            display: none;
        }

        @media (max-width: 768px) {
            .mobile-url-btn {
                display: flex;
            }
        }

        /* Hide mobile URL button in edit mode */
        .edit-mode .mobile-url-btn {
            display: none;
        }

        /* Mobile URL popup - show when mobile URL button is clicked */
        .url-popup.mobile-open {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }

            .header h1 {
                font-size: 1.25rem;
            }

            .header p {
                font-size: 0.8rem;
            }

            .modal {
                padding: 1rem;
            }
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .header h1:hover {
            transform: scale(1.02);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .header p:hover {
            color: var(--text-muted);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: -1rem;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8, #7c3aed);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--btn-secondary-bg), rgba(203, 213, 225, 0.3));
            color: var(--text-muted);
            border: 1px solid var(--btn-secondary-border);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.3), rgba(203, 213, 225, 0.4));
            transform: translateY(-1px);
        }

        .btn-small {
            padding: 0.25rem;
            font-size: 0.625rem;
            min-width: 1.25rem;
            height: 1.25rem;
            justify-content: center;
            display: flex;
            align-items: center;
        }

        .btn-ghost {
            background: transparent;
            color: #64748b;
            padding: 0.5rem;
        }

        .btn-ghost:hover {
            background: rgba(71, 85, 105, 0.1);
        }
        /* URL popup button container */
        .url-popup-btn-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            flex-shrink: 0;
        }
        /* URL popup button styles */
        .url-popup-btn {
            background: transparent;
            color: #64748b;
            padding: 0.25rem;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            line-height: 1;
            display: flex; /* Show on desktop */
            align-items: center;
            justify-content: center;
            width: 1.5rem;
            height: 1.5rem;
            min-width: 1.5rem;
            min-height: 1.5rem;
        }

        .url-popup-btn:hover {
            background: rgba(71, 85, 105, 0.1);
            color: #3b82f6;
        }

        .url-popup-btn.active {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        /* Hide URL popup button in edit mode */
        .edit-mode .url-popup-btn {
            display: none;
        }



        .btn-danger {
            color: #ef4444;
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        .btn-danger[style*="background: #ef4444"] {
            background: #ef4444 !important;
            color: white !important;
            border: 1px solid #ef4444 !important;
        }
        .btn-danger[style*="background: #ef4444"]:hover {
            background: #dc2626 !important;
            border-color: #dc2626 !important;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .category-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--card-bg) 100%);
            border: 1px solid var(--card-border);
            border-radius: 0.75rem;
            padding: 1rem;
            backdrop-filter: blur(15px);
            transition: all 0.3s;
            box-shadow: 0 4px 15px var(--shadow-color);
            position: relative;
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px var(--shadow-color-hover);
        }

        /* Drag and Drop Styles */
        .category-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .category-card.drag-over {
            border: 1px dashed var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
        }

        .server-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .server-item.drag-over {
            border: 1px dashed var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
        }

        .server-list.drag-over {
            border: 1px dashed var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.25rem 0;
        }

        .drag-handle {
            cursor: grab;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            opacity: 0.6;
        }

        .drag-handle:hover {
            opacity: 1;
            background: rgba(148, 163, 184, 0.2);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .drag-handle {
            pointer-events: auto;
        }

        .category-card .drag-handle,
        .server-item .drag-handle {
            z-index: 10;
        }



        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .category-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-icon {
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .category-icon:hover {
            transform: scale(1.05);
        }

        .category-icon.media { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(248, 113, 113, 0.3)); color: #dc2626; }
        .category-icon.network { background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(74, 222, 128, 0.3)); color: #16a34a; }
        .category-icon.storage { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(251, 146, 60, 0.3)); color: #ea580c; }
        .category-icon.services { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(167, 139, 250, 0.3)); color: #7c3aed; }
        .category-icon.development { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(96, 165, 250, 0.3)); color: #2563eb; }
        .category-icon.monitoring { background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(244, 114, 182, 0.3)); color: #db2777; }
        .category-icon.security { background: linear-gradient(135deg, rgba(245, 101, 101, 0.2), rgba(252, 165, 165, 0.3)); color: #ef4444; }
        .category-icon.communication { background: linear-gradient(135deg, rgba(52, 211, 153, 0.2), rgba(94, 234, 212, 0.3)); color: #059669; }
        .category-icon.productivity { background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(196, 181, 253, 0.3)); color: #9333ea; }
        .category-icon.gaming { background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(254, 240, 138, 0.3)); color: #d97706; }
        .category-icon.database { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(129, 140, 248, 0.3)); color: #4f46e5; }
        .category-icon.automation { background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(56, 189, 248, 0.3)); color: #0284c7; }

        .category-name {
            font-size: 1rem;
            font-weight: 600;
        }

        .category-controls {
            display: flex;
            gap: 0.25rem;
        }

        .category-controls .btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .category-card:hover .category-controls .btn {
            opacity: 1;
        }

        .server-list {
            space-y: 0.5rem;
        }

        .server-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: linear-gradient(135deg, var(--btn-secondary-bg), rgba(203, 213, 225, 0.15));
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
            group: true;
            cursor: pointer;
            box-shadow: 0 2px 8px var(--shadow-color);
            position: relative;
            height: 8px;
        }

        .title-separator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: none;
            border-radius: 0;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
            position: relative;
            min-height: 2rem;
        }

        .title-separator:hover {
            background: transparent;
            transform: none;
            box-shadow: none;
        }

        .title-text {
            flex: 1;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: color 0.2s;
            text-align: left;
        }

        [dir="rtl"] .title-text {
            text-align: right;
        }

        .title-text:hover {
            color: #3b82f6;
        }

        .server-item:hover {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(203, 213, 225, 0.25));
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--shadow-color-hover);
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 0 8px var(--shadow-color);
            animation: pulse 2s infinite;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .status-dot:hover {
            transform: scale(1.1);
            box-shadow: 0 0 12px var(--shadow-color-hover);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .status-online { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .status-warning { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .status-offline { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-checking { 
            background: linear-gradient(135deg, #eab308, #ca8a04);
            animation: pulse 1s infinite;
        }

        .server-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .server-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            transition: color 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .server-name:hover {
            color: #3b82f6;
        }

        .server-url {
            display: none;
        }

        /* URL Popup Styles */
        .url-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--modal-bg);
            border: 1px solid var(--card-border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            box-shadow: 0 8px 25px var(--shadow-color-hover);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            min-width: 200px;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }

        /* Disabled: server-item:hover .url-popup {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        } */

        /* Disable URL popup hover effect on mobile devices */
        @media (max-width: 768px) {
            .server-item:hover .url-popup:not(.manual-open) {
                opacity: 0;
                visibility: hidden;
            }
        }

        /* Hide URL popup in edit mode */
        .edit-mode .server-item:hover .url-popup {
            opacity: 0;
            visibility: hidden;
        }

        /* URL popup when manually opened */
        .url-popup.manual-open {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }

        /* Hide hover-based popup when manually opened */
        .server-item.has-manual-popup:hover .url-popup:not(.manual-open) {
            opacity: 0;
            visibility: hidden;
        }

        .url-popup-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .url-display {
            font-size: 0.75rem;
            color: var(--text-secondary);
            word-break: break-all;
            line-height: 1.3;
            background: var(--btn-secondary-bg);
            padding: 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid var(--btn-secondary-border);
        }

        .url-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .url-copy-btn {
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .url-copy-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        .url-open-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 1px solid #3b82f6;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .url-open-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
        }

        /* Popup arrow */
        .url-popup::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--modal-bg);
        }

        .server-controls {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            width: 0;
            overflow: hidden;
        }

        .title-controls {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            width: 0;
            overflow: hidden;
        }

        .category-controls {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            width: 0;
            overflow: hidden;
        }

        .category-controls .btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* Edit Mode Styles */
        .edit-mode .server-controls {
            opacity: 1;
            pointer-events: auto;
            width: auto;
            overflow: visible;
        }

        .edit-mode .title-controls {
            opacity: 1;
            pointer-events: auto;
            width: auto;
            overflow: visible;
        }

        .edit-mode .category-controls {
            opacity: 1;
            pointer-events: auto;
            width: auto;
            overflow: visible;
        }

        .edit-mode .category-controls .btn {
            opacity: 1;
        }
        .edit-mode .drag-handle {
            opacity: 1;
            pointer-events: auto;
        }
        .edit-mode .add-category-btn {
            display: block;
        }

        .edit-mode .add-server-btn {
            display: block;
        }

        /* Hide edit elements by default */
        .drag-handle {
            opacity: 0;
            pointer-events: none;
            width: 0;
            overflow: hidden;
        }

        .add-category-btn {
            display: none !important;
        }

        .add-server-btn {
            display: none !important;
        }

        .add-title-btn {
            display: none !important;
        }

        /* Show in edit mode */
        .edit-mode .add-category-btn {
            display: flex !important;
        }

        .edit-mode .add-server-btn {
            display: block !important;
        }

        .edit-mode .add-title-btn {
            display: block !important;
        }
        .input {
            padding: 0.5rem 0.75rem;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 0.375rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            width: 100%;
        }
        .input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .edit-form {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--shadow-color-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        /* Protocol selection modal should appear on top of other modals */
        #protocolSelectionModal {
            z-index: 2000;
        }

        .modal {
            background: var(--modal-bg);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--card-border);
            box-shadow: 0 25px 50px var(--shadow-color-hover);
            opacity: 1;
        }

        .modal h3 {
            margin-bottom: 1rem;
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .hidden {
            display: none;
        }



        .file-input {
            display: none;
        }





        /* RTL Support */
        [dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        [dir="rtl"] body {
            direction: rtl;
            text-align: right;
        }

        [dir="rtl"] .container {
            direction: rtl;
        }

        [dir="rtl"] .header {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .header-title-section {
            text-align: right;
            order: 2;
        }

        [dir="rtl"] .header-controls {
            order: 1;
        }

        [dir="rtl"] .header h1 .edit-btn,
        [dir="rtl"] .header p .edit-btn {
            margin-left: 0;
            margin-right: 0.5rem;
        }

        [dir="rtl"] .category-header {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .category-title {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .server-item {
            flex-direction: row-reverse;
        }



        [dir="rtl"] .controls {
            flex-direction: row-reverse;
        }







        [dir="rtl"] .form-group label {
            text-align: right;
        }

        [dir="rtl"] .input {
            text-align: right;
        }



        [dir="rtl"] .header-edit-input {
            text-align: center;
        }

        [dir="rtl"] .server-name {
            text-align: right;
        }

        [dir="rtl"] .server-url {
            text-align: right;
            direction: ltr; /* Keep URL left-to-right even in RTL */
        }

        [dir="rtl"] .category-name {
            text-align: right;
        }

        [dir="rtl"] .server-info {
            text-align: right;
        }

        [dir="rtl"] .server-list {
            direction: rtl;
        }
        [dir="rtl"] .categories-grid {
            direction: rtl;
        }
       
        /* RTL - Complete mirror layout */
        [dir="rtl"] .category-icon {
            order: 2;
        }

        [dir="rtl"] .category-name {
            order: 1;
        }

        [dir="rtl"] .status-dot {
            order: 3;
        }

        [dir="rtl"] .server-info {
            order: 2;
        }



        [dir="rtl"] .category-controls {
            order: 1;
        }

        [dir="rtl"] .category-title {
            order: 2;
        }

        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.5rem 0;
            max-width: 100%;
        }

        .color-option {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .color-option:hover {
            transform: scale(1.2);
        }

        .color-option.selected {
            transform: scale(1.3);
            box-shadow: 0 4px 15px var(--shadow-color-hover);
        }

        .icon-option {
            width: 2rem;
            height: 2rem;
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            background: var(--btn-secondary-bg);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .icon-option:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: scale(1.1);
            border-color: var(--accent-color);
        }

        .icon-option.selected {
            background: var(--accent-color);
            color: white;
            transform: scale(1.2);
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px var(--shadow-color-hover);
        }

        /* Protocol Selection Modal Styles */
        .protocol-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .protocol-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            background: var(--btn-secondary-bg);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            width: 100%;
        }

        .protocol-option:hover {
            background: rgba(148, 163, 184, 0.2);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .protocol-icon {
            font-size: 1.5rem;
            min-width: 2rem;
            text-align: center;
        }

        .protocol-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-color);
        }

        .protocol-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-left: auto;
        }

        /* Header Icon Picker Styles */
        .icon-picker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(2.5rem, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 0.5rem;
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            background: var(--btn-secondary-bg);
        }

        .header-icon-option {
            width: 2.5rem;
            height: 2.5rem;
            border: 1px solid var(--btn-secondary-border);
            border-radius: 0.5rem;
            background: var(--btn-secondary-bg);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .header-icon-option:hover {
            background: rgba(148, 163, 184, 0.2);
            transform: scale(1.1);
            border-color: var(--accent-color);
        }

        .header-icon-option.selected {
            background: var(--accent-color);
            color: white;
            transform: scale(1.2);
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px var(--shadow-color-hover);
        }



        .server-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--btn-secondary-bg), rgba(203, 213, 225, 0.15));
            border: 2px solid var(--btn-secondary-border);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
            group: true;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--shadow-color);
            position: relative;
        }

        .header-edit-input {
            background: transparent;
            border: none;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            text-align: left;
            width: 100%;
            outline: none;
        }

        [dir="rtl"] .header-edit-input {
            text-align: right;
        }

        /* Add to CSS */
        .modal-actions {
          display: flex;
          gap: 1rem;
          justify-content: flex-end;
          width: 100%;
          margin-left: auto;
        }
        .server-modal-actions {
          justify-content: space-between;
        }
        
        /* RTL/LTR Modal Support */
        .modal[dir="rtl"] {
          direction: rtl;
          text-align: right;
        }
        
        .modal[dir="ltr"] {
          direction: ltr;
          text-align: left;
        }
        
        .modal[dir="rtl"] .form-group label {
          text-align: right;
        }
        
        .modal[dir="ltr"] .form-group label {
          text-align: left;
        }
        
        .modal[dir="rtl"] .color-picker {
          justify-content: flex-end;
        }
        
        .modal[dir="ltr"] .color-picker {
          justify-content: flex-start;
        }
        /* Changes notification styles */
        .changes-notification {
            position: relative;
            background: #f59e0b;
            color: white;
            padding: 0.75rem 1rem;
            padding-left: 3rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid #f59e0b;
            opacity: 0;
            visibility: hidden;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .notification-close-btn {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 101;
        }
        .notification-close-btn:hover {
            background: #dc2626;
            transform: translateY(-50%) scale(1.1);
        }
        .changes-notification.show {
            opacity: 1;
            visibility: visible;
            max-height: 100px;
        }

        [data-theme="dark"] .changes-notification {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }
        /* Mobile responsive for notification */
        @media (max-width: 768px) {
            .changes-notification {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
        }

        /* Hide header edit buttons by default */
        .edit-btn {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        /* Show header edit buttons in edit mode */
        .edit-mode .edit-btn {
            opacity: 1;
            pointer-events: auto;
        }

        /* Hide edit elements by default */

        /* Social Media Bar Styles */
        .social-media-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            padding: 0.5rem 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .social-media-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            max-width: 400px;
            margin: 0 auto;
        }

        .social-media-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .social-media-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .social-icon {
            width: 1.2rem;
            height: 1.2rem;
            display: block;
        }

        /* Edit mode styles for social media */
        .edit-mode .social-media-btn {
            cursor: pointer;
        }

        .edit-mode .social-media-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .social-media-btn.edit-btn {
            background: var(--accent-color);
            color: white;
        }

        .social-media-btn.delete-btn {
            background: #ef4444;
            color: white;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .social-media-container {
                gap: 0.5rem;
            }
            
            .social-media-btn {
                width: 2.5rem;
                height: 2.5rem;
            }
            
            .social-icon {
                width: 1rem;
                height: 1rem;
            }
        }

        /* Social Media Editor Styles */
        .social-media-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        .social-media-list::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .social-media-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid #6b7280;
            border-radius: 0.5rem;
            background: var(--card-bg);
            position: relative;
            margin-bottom: 0.75rem;
        }

        .social-media-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .social-media-item.drag-over {
            border-color: var(--accent-color);
            background: var(--accent-color-light);
        }

        .social-media-drag-handle {
            cursor: grab;
            padding: 0.25rem;
            color: var(--text-muted);
            font-size: 1.2rem;
            margin-top: 0.5rem;
        }

        .social-media-drag-handle:active {
            cursor: grabbing;
        }

        .social-media-icon-preview {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            background: var(--bg-color);
            overflow: hidden;
            flex-shrink: 0;
            margin-left: 0.5rem;
        }

        /* RTL icon positioning */
        [dir="rtl"] .social-media-icon-preview {
            margin-left: 0;
            margin-right: 0.5rem;
        }

        .social-media-icon-preview svg {
            width: 1rem;
            height: 1rem;
            color: var(--text-color);
        }

        .social-media-fields {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .inline-form-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .inline-form-group label {
            min-width: 90px;
            font-size: 0.875rem;
            margin-bottom: 0;
        }

        .inline-form-group .input {
            flex: 1;
        }

        .inline-form-group .svg-input {
            flex: 1;
            margin-right: -0.5rem; /* Space for the icon preview */
        }

        /* Make all inputs the same width */
        .social-media-fields .inline-form-group:not(.svg-input-group) .input {
            margin-right: 2.5rem; /* Match the space taken by icon in SVG input */
        }

        /* RTL adjustments for input sizing */
        [dir="rtl"] .inline-form-group .svg-input {
            margin-right: 0;
            margin-left: -0.5rem;
        }

        [dir="rtl"] .social-media-fields .inline-form-group:not(.svg-input-group) .input {
            margin-right: 0;
            margin-left: 2.5rem;
        }



        .social-media-remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            min-width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: absolute;
            top: 1rem;
            right: 1rem;
        }

        /* RTL support for Hebrew */
        [dir="rtl"] .social-media-remove-btn {
            right: auto;
            left: 1rem;
        }

        .social-media-remove-btn:hover {
            background: #dc2626;
        }

        /* Custom Dropdown Styles */
        .custom-dropdown {
            position: relative;
            width: 100%;
            cursor: pointer;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            background: var(--bg-color);
            transition: border-color 0.2s;
        }

        .custom-dropdown:hover {
            border-color: var(--accent-color);
        }

        .dropdown-selected {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            min-height: 2.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dropdown-selected:hover {
            background: var(--accent-color-light);
        }

        .dropdown-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
        }

        .dropdown-icon svg {
            width: 1rem;
            height: 1rem;
            color: var(--text-color);
        }

        .dropdown-text {
            flex: 1;
            font-size: 0.875rem;
        }

        .dropdown-arrow {
            font-size: 1rem;
            color: var(--text-color);
            transition: transform 0.2s;
            margin-left: auto;
            font-weight: bold;
        }

        .custom-dropdown.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-options {
            position: fixed;
            background: var(--modal-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 5000;
            display: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            min-width: 200px;
        }

        .custom-dropdown.open .dropdown-options {
            display: block;
        }

        .dropdown-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
            background: var(--modal-bg);
        }

        .dropdown-option:hover {
            background: var(--accent-color-light);
        }

        .dropdown-option.selected {
            background: var(--accent-color);
            color: white;
        }

        .dropdown-option.selected .dropdown-icon svg {
            color: white;
        }

        /* Collapsed social media item styles */
        .social-media-collapsed-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .social-media-collapsed-item:hover {
            background: var(--accent-color-light);
            border-color: var(--accent-color);
        }

        .social-media-collapsed-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .social-media-collapsed-icon {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .social-media-collapsed-icon svg {
            width: 1.5rem;
            height: 1.5rem;
        }

        .social-media-collapsed-details {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .social-media-collapsed-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .social-media-collapsed-url {
            font-size: 0.875rem;
            color: var(--text-secondary);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .social-media-collapsed-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .social-media-edit-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .social-media-edit-btn:hover {
            background: var(--accent-color-light);
            color: var(--accent-color);
        }

        .social-media-delete-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .social-media-delete-btn:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        .social-media-expanded-form {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: none;
        }

        .social-media-expanded-form.active {
            display: block;
        }

        .social-media-save-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            margin-top: 1rem;
            width: 100%;
        }

        .social-media-save-btn:hover {
            background: var(--accent-color-dark);
        }

        .social-media-save-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        /* Mobile responsive for social media editor */
        @media (max-width: 768px) {
            .social-media-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .social-media-icon-preview {
                align-self: center;
            }
            
            .social-media-actions {
                flex-direction: column;
            }

            .social-media-collapsed-item {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .social-media-collapsed-info {
                justify-content: flex-start;
                gap: 0.75rem;
            }

            .social-media-collapsed-url {
                max-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title-section">
                <h1>
                    Home Server Configuration
                    <button class="btn btn-ghost btn-small edit-btn" onclick="event.stopPropagation(); showEditHeaderModal()" title="◊¢◊®◊ô◊õ◊™ ◊õ◊ï◊™◊®◊™">
                        ‚úèÔ∏è
                    </button>
                </h1>
                <p>
                    Manage your local servers and services
                    <button class="btn btn-ghost btn-small edit-btn" onclick="event.stopPropagation(); showEditHeaderModal()" title="◊¢◊®◊ô◊õ◊™ ◊õ◊ï◊™◊®◊™">
                        ‚úèÔ∏è
                    </button>
                </p>
            </div>
            <div class="header-controls">
                <div class="search-container">
                    <input type="text" id="filterInput" class="search-input" placeholder="◊ó◊ô◊§◊ï◊© ◊©◊®◊™◊ô◊ù...">
                    <button class="search-clear-btn" id="searchClearBtn" onclick="clearSearch()" title="◊†◊ô◊ß◊ï◊ô ◊ó◊ô◊§◊ï◊©">
                        ‚úï
                    </button>
                </div>

                <button class="header-icon-btn" onclick="document.getElementById('importFile').click()" title="◊ô◊ô◊ë◊ï◊ê ◊î◊í◊ì◊®◊ï◊™">
                    üìÅ
                </button>
                <button class="header-icon-btn" id="editModeToggle" onclick="toggleEditMode()" title="◊î◊ó◊ú◊§◊™ ◊û◊¶◊ë ◊¢◊®◊ô◊õ◊î">
                    ‚úèÔ∏è
                </button>
                                           <button class="header-icon-btn" id="shareBtn" onclick="shareDashboard()" title="◊©◊ô◊™◊ï◊£ ◊î◊í◊ì◊®◊ï◊™">
                    üì§
                </button>
                <button class="lang-toggle-btn" onclick="toggleLanguage()" title="">
                    <span class="lang-icon">üåê</span>
                </button>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="◊û◊¶◊ë ◊õ◊î◊î / ◊ë◊î◊ô◊®">
                    <span class="dark-mode-icon">üåô</span>
                </button>
                <button class="header-icon-btn" onclick="showHelpModal()" title="◊¢◊ñ◊®◊î">
                    ‚ùì
                </button>
                <button class="header-icon-btn" onclick="toggleDesktopMenu()" title="◊î◊í◊ì◊®◊ï◊™">
                    ‚öôÔ∏è
                </button>
            </div>
            <div class="hamburger-menu" onclick="toggleMobileMenu()">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </div>
        </div>



        <div class="controls">
            <input type="file" id="importFile" class="file-input" accept=".json" onchange="importConfig(event)">
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu">
            <div class="mobile-menu-header">
                <div class="mobile-menu-title">Menu</div>
                <button class="mobile-menu-close" onclick="closeMobileMenu()">‚úï</button>
            </div>
            
            <div class="mobile-search-container">
                <div class="mobile-search-wrapper">
                    <input type="text" id="mobileFilterInput" class="mobile-search-input" placeholder="">
                    <button class="mobile-search-clear-btn" id="mobileSearchClearBtn" onclick="clearMobileSearch()" title="◊†◊ô◊ß◊ï◊ô ◊ó◊ô◊§◊ï◊©">
                        ‚úï
                    </button>
                </div>
            </div>
            
            <div class="mobile-menu-section">
                <div class="mobile-menu-section-title" id="mobileActionsTitle">Actions</div>

                <div class="mobile-menu-item" onclick="toggleEditMode(); closeMobileMenu();">
                    <div class="mobile-menu-item-icon">‚úèÔ∏è</div>
                    <div class="mobile-menu-item-text" id="mobileToggleEditMode">Toggle Edit Mode</div>
                </div>

                <div class="mobile-menu-item" onclick="document.getElementById('importFile').click(); closeMobileMenu();">
                    <div class="mobile-menu-item-icon">üìÅ</div>
                    <div class="mobile-menu-item-text" id="mobileImportConfig">Import Config</div>
                </div>
                <div class="mobile-menu-item" onclick="shareDashboard(); closeMobileMenu();">
                    <div class="mobile-menu-item-icon">üì§</div>
                    <div class="mobile-menu-item-text" id="mobileShareConfiguration">Share Setup</div>
                </div>
                <div class="mobile-menu-item" onclick="resetAllSettings(); closeMobileMenu();">
                    <div class="mobile-menu-item-icon">üîÑ</div>
                    <div class="mobile-menu-item-text" id="mobileResetAll">Reset All</div>
                </div>
            </div>
            
            <div class="mobile-menu-section">
                <div class="mobile-menu-section-title" id="mobileSettingsTitle">Settings</div>

                <div class="mobile-menu-item" onclick="toggleLanguage(); closeMobileMenu();">
                    <div class="mobile-menu-item-icon">üåê</div>
                    <div class="mobile-menu-item-text" id="mobileToggleLanguage">Toggle Language</div>
                </div>
                <div class="mobile-menu-item" onclick="toggleDarkMode();">
                    <div class="mobile-menu-item-icon" id="mobileDarkModeIcon">üåô</div>
                    <div class="mobile-menu-item-text" id="mobileToggleDarkMode">Dark \\ Light Mode</div>
                </div>
                <div class="mobile-menu-item" onclick="toggleMobileSocialMedia();">
                    <div class="mobile-menu-item-icon" id="mobileSocialMediaIcon">‚¨áÔ∏è</div>
                    <div class="mobile-menu-item-text" id="mobileShowSocialMediaLabel">Show Bottom Bar</div>
                </div>
                <div class="mobile-menu-item" onclick="toggleMostUsedWebsites();" id="mobileMostUsedWebsitesItem">
                    <div class="mobile-menu-item-icon">üî•</div>
                    <div class="mobile-menu-item-text" id="mobileMostUsedWebsites"></div>
                </div>
                <div class="mobile-menu-item" onclick="showHelpModal();">
                    <div class="mobile-menu-item-icon">‚ùì</div>
                    <div class="mobile-menu-item-text" id="mobileHelp">Help</div>
                </div>
            </div>
            
            <div class="mobile-menu-section">
                <div class="mobile-menu-section-title" id="mobileSettingsSectionTitle">Settings</div>
                <div class="mobile-menu-item" onclick="toggleServerStatusCheck();" id="mobileServerStatusCheckItem">
                    <div class="mobile-menu-item-icon">üö¶</div>
                    <div class="mobile-menu-item-text" id="mobileServerStatusCheck">Check Server Status</div>
                </div>
                <div class="mobile-menu-item" onclick="toggleOpenLinksInNewTab();" id="mobileOpenLinksInNewTabItem">
                    <div class="mobile-menu-item-icon">üóÇÔ∏è</div>
                    <div class="mobile-menu-item-text" id="mobileOpenLinksInNewTab"></div>
                </div>
                <div class="mobile-form-group" id="mobileGoogleAnalyticsContainer">
                    <!-- Mobile Google Analytics input will be generated dynamically -->
                </div>
            </div>
        </div>

        <!-- Desktop Menu -->
        <div id="desktopMenu" class="desktop-menu">
            <div class="desktop-menu-content">
                <div class="desktop-menu-header">
                    <h3 id="desktopMenuTitle">Settings</h3>
                    <button class="desktop-menu-close" onclick="toggleDesktopMenu()" title="◊°◊í◊ô◊®◊î">‚úï</button>
                </div>
                <div class="desktop-menu-sections">
                    <div class="desktop-menu-section">
                        <div class="desktop-menu-section-title" id="desktopActionsTitle">Actions</div>
                        <div class="desktop-menu-item" onclick="toggleEditMode();">
                            <div class="desktop-menu-item-icon">‚úèÔ∏è</div>
                            <div class="desktop-menu-item-text" id="desktopToggleEditMode">Toggle Edit Mode</div>
                        </div>
                        <div class="desktop-menu-item" onclick="document.getElementById('importFile').click();">
                            <div class="desktop-menu-item-icon">üìÅ</div>
                            <div class="desktop-menu-item-text" id="desktopImportConfig">Import Config</div>
                        </div>
                        <div class="desktop-menu-item" onclick="shareDashboard();">
                            <div class="desktop-menu-item-icon">üì§</div>
                            <div class="desktop-menu-item-text" id="desktopShareConfiguration">Share Setup</div>
                        </div>
                        <div class="desktop-menu-item" onclick="resetAllSettings();">
                            <div class="desktop-menu-item-icon">üîÑ</div>
                            <div class="desktop-menu-item-text" id="desktopResetAll">Reset All</div>
                        </div>
                    </div>
                    
                    <div class="desktop-menu-section">
                        <div class="desktop-menu-section-title" id="desktopSettingsTitle">Display</div>
                        <div class="desktop-menu-item" onclick="toggleLanguageInDesktopMenu();">
                            <div class="desktop-menu-item-icon">üåê</div>
                            <div class="desktop-menu-item-text" id="desktopToggleLanguage">Toggle Language</div>
                        </div>
                        <div class="desktop-menu-item" onclick="toggleDarkMode();">
                            <div class="desktop-menu-item-icon" id="desktopDarkModeIcon">üåô</div>
                            <div class="desktop-menu-item-text" id="desktopToggleDarkMode">Dark \\ Light Mode</div>
                        </div>
                        <div class="desktop-menu-item" onclick="toggleDesktopSocialMedia()">
                            <div class="desktop-menu-item-icon" id="desktopSocialMediaIcon">üì±</div>
                            <div class="desktop-menu-item-text" id="desktopShowSocialMediaLabel">Show Bottom Bar</div>
                        </div>
                        <div class="desktop-menu-item" onclick="toggleMostUsedWebsites();" id="desktopMostUsedWebsitesItem">
                            <div class="desktop-menu-item-icon">üî•</div>
                            <div class="desktop-menu-item-text" id="desktopMostUsedWebsites"></div>
                        </div>
                        <div class="desktop-menu-item" onclick="showHelpModal();">
                            <div class="desktop-menu-item-icon">‚ùì</div>
                            <div class="desktop-menu-item-text" id="desktopHelp">Help</div>
                        </div>
                    </div>
                    
                    <div class="desktop-menu-section">
                        <div class="desktop-menu-section-title" id="desktopSettingsSectionTitle">Settings</div>
                        <div class="desktop-menu-item" onclick="toggleServerStatusCheck();" id="desktopServerStatusCheckItem">
                            <div class="desktop-menu-item-icon">üö¶</div>
                            <div class="desktop-menu-item-text" id="desktopServerStatusCheck">Check Server Status</div>
                        </div>
                        <div class="desktop-menu-item" onclick="toggleOpenLinksInNewTab();" id="desktopOpenLinksInNewTabItem">
                            <div class="desktop-menu-item-icon">üóÇÔ∏è</div>
                            <div class="desktop-menu-item-text" id="desktopOpenLinksInNewTab"></div>
                        </div>
                        <div class="desktop-form-group" id="desktopGoogleAnalyticsContainer">
                            <!-- Desktop Google Analytics input will be generated dynamically -->
                        </div>
                    </div>
                    

                    

                </div>
            </div>
        </div>

        <div id="changesNotification" class="changes-notification">
            <button class="notification-close-btn" onclick="hideChangesNotification()" title="◊°◊í◊ô◊®◊î">‚úï</button>
        </div>

        <div id="categoriesGrid" class="categories-grid">
            <!-- Categories will be rendered here -->
        </div>
    </div>
    <!-- Modal Container -->
    <div id="modalContainer">
        <!-- Modals will be generated dynamically -->
    </div>

    <!-- Social Media Button Bar -->
    <div id="socialMediaBar" class="social-media-bar">
        <div class="social-media-container">
            <a href="https://x.com" target="_blank" class="social-media-btn" title="X (◊ò◊ï◊ï◊ô◊ò◊®)">
                <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="https://facebook.com" target="_blank" class="social-media-btn" title="◊§◊ô◊ô◊°◊ë◊ï◊ß">
                <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
            </a>
            <a href="https://linkedin.com" target="_blank" class="social-media-btn" title="◊ú◊ô◊†◊ß◊ì◊ê◊ô◊ü">
                <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
            </a>
            <a href="https://github.com" target="_blank" class="social-media-btn" title="◊í◊ô◊ò◊î◊ê◊ë">
                <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- Social Media Editor Modal -->
    <div id="socialMediaModal" class="modal-overlay hidden" onmousedown="handleModalMouseDown(event, 'socialMediaModal')" onmouseup="handleModalMouseUp(event, 'socialMediaModal')">
        <div class="modal" onclick="event.stopPropagation()" dir="rtl" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                <button class="btn btn-ghost" onclick="hideSocialMediaModal()" title="◊°◊í◊ô◊®◊î">‚úï</button>
                <h3 id="socialMediaModalTitle">◊¢◊®◊ô◊õ◊™ ◊ß◊ô◊©◊ï◊®◊ô ◊®◊©◊™◊ï◊™ ◊ó◊ë◊®◊™◊ô◊ï◊™</h3>
                <div style="width: 2rem;"></div>
            </div>
            
            <div id="socialMediaModalContent">
                <div class="social-media-list" id="socialMediaList">
                    <!-- Social media items will be populated here -->
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="addSocialMediaItem()">
                        <span class="btn-icon">‚ûï</span>
                        <span class="btn-text" id="addSocialMediaText">◊î◊ï◊°◊£ ◊®◊©◊™ ◊ó◊ë◊®◊™◊ô◊™</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal-overlay hidden" onmousedown="handleModalMouseDown(event, 'helpModal')" onmouseup="handleModalMouseUp(event, 'helpModal')">
        <div class="modal" onclick="event.stopPropagation()" dir="auto" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                <button class="btn btn-ghost" onclick="hideHelpModal()" title="◊°◊í◊ô◊®◊î">‚úï</button>
                <h3 id="helpModalTitle">Personal Services Index - Help</h3>
                <div style="width: 2rem;"></div>
            </div>
            <div id="helpModalContent" style="line-height: 1.6;">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>


    <script>




        // Enhanced input sanitization with improved security
        function sanitizeInput(input, maxLength = 100) {
            // Type validation with logging
            if (typeof input !== 'string') {
                console.warn('sanitizeInput: Invalid input type', typeof input);
                return '';
            }
            
            // Length validation with logging
            if (input.length > maxLength) {
                console.warn('sanitizeInput: Input too long', input.length, '>', maxLength);
                return input.substring(0, maxLength);
            }
            
            // Enhanced dangerous pattern detection
            let sanitized = input
                .replace(/[<>]/g, '') // Remove < and >
                .replace(/javascript:/gi, '') // Remove javascript: protocol
                .replace(/vbscript:/gi, '') // Remove vbscript: protocol
                .replace(/data:text\/html/gi, '') // Remove data: URLs with HTML
                .replace(/on\w+\s*=/gi, '') // Remove event handlers
                .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // Remove script tags
                .replace(/<iframe\b[^>]*>/gi, '') // Remove iframe tags
                .replace(/<object\b[^>]*>/gi, '') // Remove object tags
                .replace(/<embed\b[^>]*>/gi, '') // Remove embed tags
                .trim();
            
            return sanitized;
        }



        function isValidUrl(string) {
            try {
                const url = new URL(string);
                
                // Enhanced protocol validation - allow safe protocols including mailto
                const allowedProtocols = ['http:', 'https:', 'mailto:'];
                
                // Additional security checks
                if (!allowedProtocols.includes(url.protocol)) {
                    console.warn('isValidUrl: Unsupported protocol', url.protocol);
                    return false;
                }
                
                // Block file:// URLs except localhost for security
                if (url.protocol === 'file:' && !url.hostname.startsWith('localhost')) {
                    console.warn('isValidUrl: Blocked file:// URL for security');
                    return false;
                }
                
                // Block URLs with suspicious patterns
                if (url.href.includes('javascript:') || url.href.includes('vbscript:')) {
                    console.warn('isValidUrl: Blocked URL with dangerous protocol');
                    return false;
                }
                
                // Special handling for mailto URLs
                if (url.protocol === 'mailto:') {
                    // Validate email format in mailto URL
                    const email = url.pathname || url.href.replace('mailto:', '');
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        console.warn('isValidUrl: Invalid email format in mailto URL');
                        return false;
                    }
                    return true;
                }
                
                return true;
            } catch (error) {
                console.warn('isValidUrl: Invalid URL format', error.message);
                return false;
            }
        }

        function hasProtocol(url) {
            return /^[a-zA-Z]+:\/\//.test(url);
        }

        function validateString(str, maxLength = 100) {
            if (typeof str !== 'string') return false;
            
            // Sanitize the string first
            const sanitized = sanitizeInput(str, maxLength);
            const result = sanitized.length > 0 && sanitized.length <= maxLength;
            

            return result;
        }

        function validateCategory(category) {
            if (!category || typeof category !== 'object') {
                return false;
            }
            
            if (!validateString(category.name, 50)) {
                return false;
            }
            if (!validateString(category.id, 20)) {
                return false;
            }
            
            if (!Array.isArray(category.servers)) {
                return false;
            }
            
            for (const server of category.servers) {
                if (!validateServer(server)) {
                    return false;
                }
            }
            
            return true;
        }

        function validateServer(server) {
            if (!server || typeof server !== 'object') {
                return false;
            }
            
            if (!validateString(server.name, 50)) {
                return false;
            }
            if (!validateString(server.id, 20)) {
                return false;
            }
            if (!isValidUrl(server.url)) {
                return false;
            }
            
            return true;
        }

        function validateImportedData(data) {
            try {
                // Basic structure validation
                if (!data || typeof data !== 'object') {
                    console.warn('validateImportedData: Invalid data structure');
                    return false;
                }
                
                // Validate header data with detailed logging
                if (data.headerTitle) {
                    if (!validateString(data.headerTitle, 100)) {
                        console.warn('validateImportedData: Invalid headerTitle', data.headerTitle);
                        return false;
                    }
                }
                
                if (data.headerSubtitle) {
                    if (!validateString(data.headerSubtitle, 200)) {
                        console.warn('validateImportedData: Invalid headerSubtitle', data.headerSubtitle);
                        return false;
                    }
                }
                
                // Enhanced categories validation
                if (data.categories) {
                    if (!Array.isArray(data.categories)) {
                        console.warn('validateImportedData: Categories is not an array');
                        return false;
                    }
                    
                    if (data.categories.length > 50) {
                        console.warn('validateImportedData: Too many categories', data.categories.length, '> 50');
                        return false;
                    }
                    
                    // Validate each category with detailed logging
                    for (let i = 0; i < data.categories.length; i++) {
                        const category = data.categories[i];
                        if (!validateCategory(category)) {
                            console.warn('validateImportedData: Invalid category at index', i, category);
                            return false;
                        }
                    }
                }
                
                // Validate social media links if present
                if (data.socialMediaLinks) {
                    if (!Array.isArray(data.socialMediaLinks)) {
                        console.warn('validateImportedData: socialMediaLinks is not an array');
                        return false;
                    }
                    
                    if (data.socialMediaLinks.length > 100) {
                        console.warn('validateImportedData: Too many social media links', data.socialMediaLinks.length, '> 100');
                        return false;
                    }
                    
                    for (let i = 0; i < data.socialMediaLinks.length; i++) {
                        const link = data.socialMediaLinks[i];
                        if (!link || typeof link !== 'object') {
                            console.warn('validateImportedData: Invalid social media link at index', i);
                            return false;
                        }
                        
                        if (!validateString(link.name, 50) || !validateString(link.url, 500)) {
                            console.warn('validateImportedData: Invalid social media link data at index', i, link);
                            return false;
                        }
                    }
                }
                
                console.log('validateImportedData: Data validation successful');
                return true;
                
            } catch (error) {
                console.error('validateImportedData: Validation error:', error.message);
                return false;
            }
        }

        // Data structure and state management
        let currentLanguage = 'en';
        let filteredCategories = [];

        // Shared social media configuration
        const sharedSocialMediaConfig = [
            { 
                id: 'facebook', 
                name: 'Facebook', 
                url: 'https://facebook.com/your-profile-name', 
                title: 'Facebook',
                predefinedType: 'facebook',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>'
            },
            { 
                id: 'twitter', 
                name: 'Twitter', 
                url: 'https://twitter.com/your-profile-name', 
                title: 'Twitter',
                predefinedType: 'twitter',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>'
            },
            { 
                id: 'github', 
                name: 'GitHub', 
                url: 'https://github.com/your-profile-name', 
                title: 'GitHub',
                predefinedType: 'github',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>'
            },
            { 
                id: 'linkedin', 
                name: 'LinkedIn', 
                url: 'https://linkedin.com/in/your-profile-name', 
                title: 'LinkedIn',
                predefinedType: 'linkedin',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>'
            }
        ];

        let currentTheme = localStorage.getItem('dashboardTheme') || 'light';
                // Default data for English
        const defaultDataEn = {
            headerTitle: "Personal Services Index",
            headerSubtitle: "Your homepage for quick access to your favorite services and websites",
            categories: [
            {
                id: '1',
                    name: 'Social Media',
                borderColor: '#ef4444',
                    customIcon: 'üí¨',
                servers: [
                        { id: '1', name: 'Gmail', url: 'https://mail.google.com', status: 'online', borderColor: '#22c55e' },
                        { id: '2', name: 'WhatsApp Web', url: 'https://web.whatsapp.com', status: 'online', borderColor: '#8b5cf6' }
                ]
            },
            {
                id: '2',
                    name: 'Productivity',
                borderColor: '#22c55e',
                    customIcon: 'üìù',
                servers: [
                        { id: '3', name: 'Google Drive', url: 'https://drive.google.com', status: 'online', borderColor: '#06b6d4' },
                        { id: '4', name: 'Notion', url: 'https://notion.so', status: 'online', borderColor: '#f97316' }
                ]
            },
            {
                id: '3',
                    name: 'Entertainment',
                borderColor: '#f97316',
                    customIcon: 'üé¨',
                servers: [
                        { id: '5', name: 'YouTube', url: 'https://youtube.com', status: 'online', borderColor: '#3b82f6' },
                        { id: '6', name: 'Netflix', url: 'https://netflix.com', status: 'online', borderColor: '#ec4899' }
                ]
            }
            ],
            socialMediaLinks: sharedSocialMediaConfig
        };

        // Default data for Hebrew
        const defaultDataHe = {
            headerTitle: "◊ê◊ô◊†◊ì◊ß◊° ◊©◊ô◊®◊ï◊™◊ô◊ù ◊ê◊ô◊©◊ô",
            headerSubtitle: "◊ì◊£ ◊î◊ë◊ô◊™ ◊©◊ú◊ö ◊ú◊í◊ô◊©◊î ◊û◊î◊ô◊®◊î ◊ú◊©◊ô◊®◊ï◊™◊ô◊ù ◊ï◊ê◊™◊®◊ô◊ù ◊î◊ê◊î◊ï◊ë◊ô◊ù ◊¢◊ú◊ô◊ö",
            categories: [
                {
                    id: '1',
                    name: '◊®◊©◊™◊ï◊™ ◊ó◊ë◊®◊™◊ô◊ï◊™',
                    borderColor: '#ef4444',
                    customIcon: 'üí¨',
                    servers: [
                        { id: '1', name: 'Gmail', url: 'https://mail.google.com', status: 'online', borderColor: '#22c55e' },
                        { id: '2', name: 'WhatsApp Web', url: 'https://web.whatsapp.com', status: 'online', borderColor: '#8b5cf6' }
                    ]
                },
                {
                    id: '2',
                    name: '◊§◊®◊ï◊ì◊ï◊ß◊ò◊ô◊ë◊ô◊ï◊™',
                    borderColor: '#22c55e',
                    customIcon: 'üìù',
                    servers: [
                        { id: '3', name: 'Google Drive', url: 'https://drive.google.com', status: 'online', borderColor: '#06b6d4' },
                        { id: '4', name: 'Notion', url: 'https://notion.so', status: 'online', borderColor: '#f97316' }
                    ]
                },
                {
                    id: '3',
                    name: '◊ë◊ô◊ì◊ï◊®',
                    borderColor: '#f97316',
                    customIcon: 'üé¨',
                    servers: [
                        { id: '5', name: 'YouTube', url: 'https://youtube.com', status: 'online', borderColor: '#3b82f6' },
                        { id: '6', name: 'Netflix', url: 'https://netflix.com', status: 'online', borderColor: '#ec4899' }
                    ]
                }
            ],
            socialMediaLinks: sharedSocialMediaConfig
        };
        // Function to detect browser language and set appropriate defaults
        function detectLanguageAndSetDefaults() {
            const browserLang = navigator.language || navigator.userLanguage || 'en';
            const isHebrew = browserLang.startsWith('he') || browserLang.startsWith('iw');
            
            if (isHebrew) {
                categories = defaultDataHe.categories;
                headerTitle = defaultDataHe.headerTitle;
                headerSubtitle = defaultDataHe.headerSubtitle;
                socialMediaLinks = defaultDataHe.socialMediaLinks;
                currentLanguage = 'he';
            } else {
                categories = defaultDataEn.categories;
                headerTitle = defaultDataEn.headerTitle;
                headerSubtitle = defaultDataEn.headerSubtitle;
                socialMediaLinks = defaultDataEn.socialMediaLinks;
                currentLanguage = 'en';
            }
        }

        // Function to reset to language-appropriate defaults
        function resetToLanguageDefaults() {
            // Clear language setting to force re-detection
            localStorage.removeItem('dashboardLanguage');
            // Re-detect language and set defaults
            detectLanguageAndSetDefaults();
            // Update UI language
            setLanguage(currentLanguage);
            // Render social media bar after reset
            renderSocialMediaBar();
        }
        // Social media links data - initialized with shared configuration
        let socialMediaLinks = [...sharedSocialMediaConfig];

        // Predefined social media options with their configurations
        const predefinedSocialMedia = {
            facebook: {
                name: 'Facebook',
                baseUrl: 'https://facebook.com/',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>'
            },
            twitter: {
                name: 'X (Twitter)',
                baseUrl: 'https://x.com/',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>'
            },
            instagram: {
                name: 'Instagram',
                baseUrl: 'https://instagram.com/',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>'
            },
            linkedin: {
                name: 'LinkedIn',
                baseUrl: 'https://linkedin.com/in/',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>'
            },
            youtube: {
                name: 'YouTube',
                baseUrl: 'https://youtube.com/@',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>'
            },
            github: {
                name: 'GitHub',
                baseUrl: 'https://github.com/',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>'
            },
            email: {
                name: 'Email',
                baseUrl: 'mailto:',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>'
            },
            other: {
                name: 'Other',
                baseUrl: '',
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'
            }
        };

        // Initialize with detected language defaults
        detectLanguageAndSetDefaults();

        // Helper functions for social media selection
        function getUrlPlaceholder(type) {
            const placeholders = {
                facebook: currentLanguage === 'he' ? '◊©◊ù ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: john.doe)' : 'Your profile name (e.g., john.doe)',
                twitter: currentLanguage === 'he' ? '◊©◊ù ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: johndoe)' : 'Your profile name (e.g., johndoe)',
                instagram: currentLanguage === 'he' ? '◊©◊ù ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: johndoe)' : 'Your profile name (e.g., johndoe)',
                linkedin: currentLanguage === 'he' ? '◊©◊ù ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: john-doe)' : 'Your profile name (e.g., john-doe)',
                youtube: currentLanguage === 'he' ? '◊©◊ù ◊î◊¢◊®◊ï◊• ◊©◊ú◊ö (◊ú◊û◊©◊ú: johndoe)' : 'Your channel name (e.g., johndoe)',
                github: currentLanguage === 'he' ? '◊©◊ù ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: johndoe)' : 'Your profile name (e.g., johndoe)',
                email: currentLanguage === 'he' ? '◊õ◊™◊ï◊ë◊™ ◊î◊ê◊ô◊û◊ô◊ô◊ú ◊©◊ú◊ö (◊ú◊û◊©◊ú: john@example.com)' : 'Your email address (e.g., john@example.com)',
                other: currentLanguage === 'he' ? '◊õ◊™◊ï◊ë◊™ URL ◊û◊ú◊ê◊î (◊ú◊û◊©◊ú: https://example.com)' : 'Full URL (e.g., https://example.com)'
            };
            return placeholders[type] || placeholders.other;
        }

        function getUrlValue(link, type) {
            if (type === 'other') {
                return link.url;
            }
            
            const predefined = predefinedSocialMedia[type];
            if (!predefined) return link.url;
            
            // Extract username from URL if it's a predefined type
            if (link.url && link.url.startsWith(predefined.baseUrl)) {
                return link.url.replace(predefined.baseUrl, '');
            }
            
            return '';
        }

        function handleSocialMediaTypeChange(index, type) {
            const link = socialMediaLinks[index];
            if (!link) return;
            
            // Update the link with new type
            link.predefinedType = type;
            
            // Update name for predefined types
            const predefined = predefinedSocialMedia[type];
            if (predefined && type !== 'other') {
                link.name = predefined.name;
            }
            
            // Clear URL for predefined types
            if (type !== 'other') {
                link.url = '';
            }
            
            // Update SVG for predefined types
            if (type !== 'other') {
                link.svg = predefined.svg;
            }
            
            // Update the specific item's UI elements without re-rendering
            const form = document.getElementById(`expandedForm_${index}`);
            if (form) {
                // Update dropdown display
                const dropdownSelected = form.querySelector('.dropdown-selected');
                if (dropdownSelected) {
                    const predefined = predefinedSocialMedia[type];
                    const iconSpan = dropdownSelected.querySelector('.dropdown-icon');
                    const textSpan = dropdownSelected.querySelector('.dropdown-text');
                    
                    if (iconSpan && textSpan) {
                        iconSpan.innerHTML = predefined ? predefined.svg : '';
                        textSpan.textContent = predefined ? predefined.name : 'Other';
                    }
                }
                
                // Update URL input placeholder and value
                const urlInput = form.querySelector('.social-media-url');
                const urlLabel = form.querySelector('.social-media-url-group label');
                if (urlInput) {
                    urlInput.placeholder = getUrlPlaceholder(type);
                    urlInput.value = '';
                }
                if (urlLabel) {
                    urlLabel.textContent = type === 'other' ? (currentLanguage === 'he' ? '◊õ◊™◊ï◊ë◊™ URL:' : 'URL:') : (currentLanguage === 'he' ? '◊©◊ù ◊§◊®◊ï◊§◊ô◊ú:' : 'Profile Name:');
                }
                
                // Show/hide name field
                const nameGroup = form.querySelector(`#nameGroup_${index}`);
                if (nameGroup) {
                    nameGroup.style.display = type === 'other' ? '' : 'none';
                }
                
                // Show/hide SVG field
                const svgGroup = form.querySelector(`#svgGroup_${index}`);
                if (svgGroup) {
                    svgGroup.style.display = type === 'other' ? '' : 'none';
                }
                
                // Show/hide SVG help text
                const svgHelp = form.querySelector(`#svgHelp_${index}`);
                if (svgHelp) {
                    svgHelp.style.display = type === 'other' ? '' : 'none';
                }
                
                // Update SVG input and preview for predefined types
                if (type !== 'other') {
                    const svgInput = form.querySelector('.svg-input');
                    const iconPreview = form.querySelector(`#iconPreview_${index}`);
                    if (svgInput && predefined) {
                        svgInput.value = predefined.svg;
                    }
                    if (iconPreview && predefined) {
                        iconPreview.innerHTML = predefined.svg;
                    }
                }
                
                // Close dropdown more aggressively
                const customDropdown = form.querySelector('.custom-dropdown');
                if (customDropdown) {
                    customDropdown.classList.remove('open');
                }
                
                // Also close any other open dropdowns
                document.querySelectorAll('.custom-dropdown').forEach(dd => {
                    if (dd !== customDropdown) {
                        dd.classList.remove('open');
                    }
                });
                
                // Focus on URL input for better UX
                setTimeout(() => {
                    const urlInput = form.querySelector('.social-media-url');
                    if (urlInput) {
                        urlInput.focus();
                    }
                }, 100);
            }
            
            // Update the collapsed view
            updateCollapsedView(index, link);
        }

        // Function to toggle dropdown
        function toggleDropdown(index) {
            const dropdown = document.querySelector(`#dropdown_${index}`);
            const customDropdown = dropdown?.closest('.custom-dropdown');
            
            // Close all other dropdowns first
            document.querySelectorAll('.custom-dropdown').forEach(dd => {
                if (dd !== customDropdown) {
                    dd.classList.remove('open');
                }
            });
            
            // Toggle current dropdown
            if (customDropdown) {
                const isOpen = customDropdown.classList.contains('open');
                
                if (!isOpen) {
                    // Position the dropdown when opening
                    const rect = customDropdown.getBoundingClientRect();
                    dropdown.style.top = (rect.bottom + 5) + 'px';
                    dropdown.style.left = rect.left + 'px';
                    dropdown.style.width = rect.width + 'px';
                }
                
                customDropdown.classList.toggle('open');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.custom-dropdown')) {
                document.querySelectorAll('.custom-dropdown').forEach(dd => {
                    dd.classList.remove('open');
                });
            }
        });

        // Social Media Editor Functions
        function showSocialMediaModal() {
            const modal = document.getElementById('socialMediaModal');
            const title = document.getElementById('socialMediaModalTitle');
            
            // Set title and button texts based on current language
            if (title) title.textContent = currentLanguage === 'he' ? '◊¢◊®◊ô◊õ◊™ ◊®◊©◊™◊ï◊™ ◊ó◊ë◊®◊™◊ô◊ï◊™' : 'Edit Social Media';
            
            const addSocialMediaText = document.getElementById('addSocialMediaText');
            const saveChangesText = document.getElementById('saveChangesText');
            
            if (addSocialMediaText) addSocialMediaText.textContent = currentLanguage === 'he' ? '◊î◊ï◊°◊§◊™ ◊®◊©◊™ ◊ó◊ë◊®◊™◊ô◊™' : 'Add Social Media';
            if (saveChangesText) saveChangesText.textContent = currentLanguage === 'he' ? '◊©◊û◊ô◊®◊™ ◊©◊ô◊†◊ï◊ô◊ô◊ù' : 'Save Changes';
            
            // Populate the modal with current social media links
            populateSocialMediaEditor();
            
            modal.classList.remove('hidden');
        }

        function hideSocialMediaModal() {
            document.getElementById('socialMediaModal').classList.add('hidden');
        }

        function populateSocialMediaEditor() {
            const container = document.getElementById('socialMediaList');
            container.innerHTML = '';
            
            socialMediaLinks.forEach((link, index) => {
                const item = createSocialMediaItem(link, index);
                container.appendChild(item);
            });
        }
        function createSocialMediaItem(link, index) {
            const container = document.createElement('div');
            container.className = 'social-media-item-container';
            container.dataset.index = index;
            
            // Determine if this is a predefined social media or custom
            const isPredefined = link.predefinedType && predefinedSocialMedia[link.predefinedType];
            const selectedType = isPredefined ? link.predefinedType : 'other';
            
            // Create collapsed item
            const collapsedItem = document.createElement('div');
            collapsedItem.className = 'social-media-collapsed-item';
            collapsedItem.innerHTML = `
                <div class="social-media-collapsed-info">
                    <div class="social-media-collapsed-icon">
                        ${link.svg}
                    </div>
                    <div class="social-media-collapsed-details">
                        <div class="social-media-collapsed-name">${link.name}</div>
                        <div class="social-media-collapsed-url">${link.url}</div>
                    </div>
                </div>
                <div class="social-media-collapsed-actions">
                    <button class="social-media-edit-btn" onclick="editSocialMediaItem(${index})" title="${currentLanguage === 'he' ? '◊¢◊®◊ô◊õ◊î' : 'Edit'}">
                        ‚úèÔ∏è
                    </button>
                    ${socialMediaLinks.length > 1 ? `
                        <button class="social-media-delete-btn" onclick="deleteSocialMediaItem(${index})" title="${currentLanguage === 'he' ? '◊û◊ó◊ô◊ß◊î' : 'Delete'}">
                            üóëÔ∏è
                        </button>
                    ` : ''}
                </div>
            `;
            
            // Create expanded form (initially hidden)
            const expandedForm = document.createElement('div');
            expandedForm.className = 'social-media-expanded-form';
            expandedForm.id = `expandedForm_${index}`;
            
            // Generate custom dropdown with logos
            const customDropdownOptions = Object.entries(predefinedSocialMedia).map(([key, value]) => {
                const selected = key === selectedType ? 'selected' : '';
                return `<div class="dropdown-option ${selected}" data-value="${key}" onclick="event.stopPropagation(); handleSocialMediaTypeChange(${index}, '${key}')">
                    <span class="dropdown-icon">${value.svg}</span>
                    <span class="dropdown-text">${value.name}</span>
                </div>`;
            }).join('');
            
            expandedForm.innerHTML = `
                <div class="social-media-fields">
                    <div class="form-group inline-form-group">
                        <label>${currentLanguage === 'he' ? '◊®◊©◊™ ◊ó◊ë◊®◊™◊ô◊™:' : 'Social Media:'}</label>
                        <div class="custom-dropdown" onclick="toggleDropdown(${index})">
                            <div class="dropdown-selected">
                                <span class="dropdown-icon">${predefinedSocialMedia[selectedType]?.svg || ''}</span>
                                <span class="dropdown-text">${predefinedSocialMedia[selectedType]?.name || 'Other'}</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-options" id="dropdown_${index}">
                                ${customDropdownOptions}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group inline-form-group" id="nameGroup_${index}" style="${selectedType === 'other' ? '' : 'display: none;'}">
                        <label>${currentLanguage === 'he' ? '◊©◊ù:' : 'Name:'}</label>
                        <input type="text" class="input social-media-name" placeholder="${currentLanguage === 'he' ? '◊©◊ù' : 'Name'}" 
                               value="${link.name}" onchange="updateSocialMediaItem(${index}, 'name', this.value)">
                    </div>
                    
                    <div class="form-group inline-form-group social-media-url-group">
                        <label>${selectedType === 'other' ? (currentLanguage === 'he' ? '◊õ◊™◊ï◊ë◊™ URL:' : 'URL:') : (currentLanguage === 'he' ? '◊©◊ù ◊§◊®◊ï◊§◊ô◊ú:' : 'Profile Name:')}</label>
                        <input type="text" class="input social-media-url" 
                               placeholder="${getUrlPlaceholder(selectedType)}" 
                               value="${getUrlValue(link, selectedType)}" 
                               onchange="updateSocialMediaItem(${index}, 'url', this.value)">
                    </div>

                    <div class="form-group inline-form-group svg-input-group" id="svgGroup_${index}" style="${selectedType === 'other' ? '' : 'display: none;'}">
                        <label>${currentLanguage === 'he' ? '◊ú◊ï◊í◊ï (SVG):' : 'Logo (SVG):'}</label>
                        <input type="text" class="input svg-input" placeholder="${currentLanguage === 'he' ? '◊î◊ì◊ë◊ß◊™ ◊ß◊ï◊ì SVG ◊õ◊ê◊ü' : 'Paste SVG code here'}" 
                               onchange="updateSocialMediaItem(${index}, 'svg', this.value)" 
                               onpaste="handleSvgPaste(event, ${index})">
                        <div class="social-media-icon-preview" id="iconPreview_${index}">
                            ${link.svg}
                        </div>
                    </div>
                    
                    <small style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.25rem; display: ${selectedType === 'other' ? 'block' : 'none'};" id="svgHelp_${index}">
                        ${currentLanguage === 'he' ? '◊†◊ô◊™◊ü ◊ú◊û◊¶◊ï◊ê ◊ú◊ï◊í◊ï◊ê◊ô◊ù SVG ◊ë:' : 'Find SVG logos at:'} <a href="https://simpleicons.org" target="_blank">Simple Icons</a>, <a href="https://heroicons.com" target="_blank">Hero Icons</a>
                    </small>
                </div>
                
                <button class="social-media-save-btn" onclick="saveSocialMediaItem(${index})">
                    ${currentLanguage === 'he' ? 'üíæ ◊©◊û◊ô◊®◊î' : 'üíæ Save'}
                </button>
            `;
            
            // Set the SVG input value after creating the element to avoid HTML attribute issues
            const svgInput = expandedForm.querySelector('.svg-input');
            if (svgInput) {
                svgInput.value = link.svg;
            }
            
            // Add drag and drop event listeners to collapsed item
            collapsedItem.draggable = true;
            collapsedItem.ondragstart = (e) => handleSocialMediaDragStart(e, index);
            collapsedItem.ondragover = (e) => handleSocialMediaDragOver(e);
            collapsedItem.ondrop = (e) => handleSocialMediaDrop(e, index);
            collapsedItem.ondragend = handleSocialMediaDragEnd;
            
            container.appendChild(collapsedItem);
            container.appendChild(expandedForm);
            
            return container;
        }

        // Function to handle SVG paste and extract SVG code
        function handleSvgPaste(event, index) {
            event.preventDefault();
            const pastedText = (event.clipboardData || window.clipboardData).getData('text');
            
            // Check if it's a URL
            if (pastedText.startsWith('http://') || pastedText.startsWith('https://')) {
                // Extract SVG from URL content
                extractSvgFromUrl(pastedText, index);
                return;
            }
            
            // Extract SVG code from pasted content
            const svgMatch = pastedText.match(/<svg[^>]*>.*?<\/svg>/s);
            if (svgMatch) {
                const svgCode = svgMatch[0];
                const input = event.target;
                input.value = svgCode;
                updateSocialMediaItem(index, 'svg', svgCode);
            } else {
                // If no SVG found, just paste the text as is
                const input = event.target;
                input.value = pastedText;
                updateSocialMediaItem(index, 'svg', pastedText);
            }
        }

        // Function to extract SVG from URL
        async function extractSvgFromUrl(url, index) {
            try {
                const response = await fetch(url);
                const html = await response.text();
                
                // Extract SVG code from the HTML
                const svgMatch = html.match(/<svg[^>]*>.*?<\/svg>/s);
                if (svgMatch) {
                    const svgCode = svgMatch[0];
                    const input = document.querySelector(`#socialMediaList .social-media-item[data-index="${index}"] .svg-input`);
                    if (input) {
                        input.value = svgCode;
                        updateSocialMediaItem(index, 'svg', svgCode);
                    }
                } else {
                    // If no SVG found in the URL, show error
                    alert('No SVG found in the provided URL');
                }
            } catch (error) {
                console.error('Error fetching SVG from URL:', error);
                alert('Error fetching SVG from URL. Please check the URL and try again.');
            }
        }

        // Function to validate and sanitize SVG content
        function validateAndSanitizeSvg(svgContent) {
            if (!svgContent || typeof svgContent !== 'string') {
                return '';
            }
            
            // Basic SVG validation - check if it starts with <svg and ends with </svg>
            if (!svgContent.trim().startsWith('<svg') || !svgContent.trim().includes('</svg>')) {
                console.warn('‚ö†Ô∏è Invalid SVG content:', svgContent.substring(0, 100));
                return '';
            }
            
            // Remove dangerous elements and attributes
            let sanitizedSvg = svgContent
                .replace(/<script[^>]*>.*?<\/script>/gi, '') // Remove script tags
                .replace(/<iframe[^>]*>.*?<\/iframe>/gi, '') // Remove iframe tags
                .replace(/<object[^>]*>.*?<\/object>/gi, '') // Remove object tags
                .replace(/<embed[^>]*>/gi, '') // Remove embed tags
                .replace(/on\w+\s*=/gi, '') // Remove event handlers
                .replace(/javascript:/gi, '') // Remove javascript: protocol
                .replace(/data:text\/html/gi, '') // Remove data:text/html
                .replace(/<a[^>]*>/gi, '') // Remove anchor tags
                .replace(/<\/a>/gi, ''); // Remove closing anchor tags
            
            // Only allow safe SVG attributes
            sanitizedSvg = sanitizedSvg.replace(/<svg([^>]*)>/gi, (match, attributes) => {
                const safeAttributes = attributes.match(/(viewBox|width|height|fill|stroke|stroke-width|class|id|style|xmlns|xmlns:xlink)=["'][^"']*["']/gi);
                return '<svg' + (safeAttributes ? ' ' + safeAttributes.join(' ') : '') + '>';
            });
            
            return sanitizedSvg;
        }

        // Enhanced secure JSON parsing function with comprehensive error handling
        function secureJsonParse(jsonString, maxSize = 1024 * 1024) {
            try {
                // Input validation
                if (!jsonString || typeof jsonString !== 'string') {
                    throw new Error('Invalid input: JSON string required');
                }
                
                // Check size limit with detailed logging
                if (jsonString.length > maxSize) {
                    console.warn('secureJsonParse: Data too large', jsonString.length, 'bytes >', maxSize, 'bytes');
                    throw new Error(`JSON data too large: ${jsonString.length} bytes (max: ${maxSize} bytes)`);
                }
                
                // Enhanced validation - check for common attack patterns
                const dangerousPatterns = [
                    '__proto__',
                    'constructor',
                    'prototype',
                    'toString',
                    'valueOf',
                    'hasOwnProperty',
                    'isPrototypeOf',
                    'propertyIsEnumerable',
                    'toLocaleString'
                ];
                
                for (const pattern of dangerousPatterns) {
                    if (jsonString.includes(pattern)) {
                        console.warn('secureJsonParse: Dangerous pattern detected', pattern);
                        throw new Error(`Potentially malicious JSON content: ${pattern}`);
                    }
                }
                
                // Check for circular references (basic check)
                if (jsonString.includes('"__proto__"') || jsonString.includes('"constructor"')) {
                    console.warn('secureJsonParse: Circular reference pattern detected');
                    throw new Error('Circular reference detected in JSON');
                }
                
                const parsed = JSON.parse(jsonString);
                
                // Enhanced validation for expected structure
                if (parsed && typeof parsed === 'object') {
                    // Additional check for excessive nesting
                    const jsonStr = JSON.stringify(parsed);
                    if (jsonStr.split('{').length > 1000) {
                        console.warn('secureJsonParse: Excessive nesting detected');
                        throw new Error('JSON structure too complex (excessive nesting)');
                    }
                    
                    return parsed;
                }
                
                throw new Error('Invalid JSON structure: Expected object');
            } catch (error) {
                console.error('secureJsonParse: JSON parsing failed:', error.message);
                // Return null instead of throwing to prevent app crashes
                return null;
            }
        }
        // Modal template functions
        function createModalTemplate(modalId, title, content, actions, showCloseButton = true, showDeleteButton = false, deleteButtonId = null, deleteButtonTitle = null) {
            const closeButton = showCloseButton ? `<button class="btn btn-ghost" onclick="hide${modalId.charAt(0).toUpperCase() + modalId.slice(1)}Modal()" title="◊°◊í◊ô◊®◊î">‚úï</button>` : '';
            const deleteButton = showDeleteButton ? `<button class="btn btn-danger" onclick="${deleteButtonId}()" style="background: #ef4444; color: white; border: 1px solid #ef4444; padding: 0.5rem; min-width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center;" id="${deleteButtonId}" title="${deleteButtonTitle}">üóëÔ∏è</button>` : '';
            const spacer = showDeleteButton ? '<div style="width: 2rem;"></div>' : '';
            
            return `
                <div id="${modalId}Modal" class="modal-overlay hidden" onmousedown="handleModalMouseDown(event, '${modalId}Modal')" onmouseup="handleModalMouseUp(event, '${modalId}Modal')">
                    <div class="modal" onclick="event.stopPropagation()" dir="auto">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            ${closeButton}
                            <h3>${title}</h3>
                            ${deleteButton}
                            ${spacer}
                        </div>
                        ${content}
                        <div class="modal-actions">
                            ${actions}
                        </div>
                    </div>
                </div>
            `;
        }

        // Reusable color picker component
        function createColorPicker(selectedColor, onColorSelect, inputId) {
            const colors = [
                '#3b82f6', '#ef4444', '#22c55e', '#f97316', '#8b5cf6', 
                '#ec4899', '#06b6d4', '#84cc16', '#f59e0b', '#10b981', 
                '#6366f1', '#8b5a2b', '#6b7280', '#000000', '#ffffff'
            ];
            
            let html = '<div class="color-picker">';
            
            colors.forEach(color => {
                const isSelected = color === selectedColor;
                const borderStyle = color === '#ffffff' ? 'border: 2px solid #ccc;' : '';
                const selectedClass = isSelected ? 'selected' : '';
                
                html += `<div class="color-option ${selectedClass}" style="background: ${color}; ${borderStyle}" data-color="${color}" onclick="${onColorSelect}('${color}')"></div>`;
            });
            
            html += '</div>';
            html += `<input type="hidden" id="${inputId}" value="${selectedColor}">`;
            
            return html;
        }

        // Generate all modals dynamically
        function generateModals() {
            const modalContainer = document.getElementById('modalContainer');
            if (!modalContainer) return;
            
            // Add Category Modal
            const addCategoryContent = `
                <div class="form-group">
                    <label>Category Name:</label>
                    <input type="text" id="categoryName" class="input" placeholder="">
                </div>
                <div class="form-group">
                    <label>Category Icon:</label>
                    <div id="categoryIconPicker" style="display: block; margin-top: 0.5rem;">
                        <div id="categoryIconGrid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; max-height: 300px; overflow-y: auto; padding: 0.5rem; border: 1px solid var(--card-border); border-radius: 0.5rem; background: var(--card-bg);">
                            <!-- Icons will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="category-border-color-label">Category Border Color:</label>
                    <div id="addCategoryColorPicker"></div>
                    <input type="hidden" id="categoryBorderColor" value="#3b82f6">
                </div>
            `;
            
            const addCategoryActions = `<button class="btn btn-primary" onclick="addCategory()" id="addCategoryBtn">‚ûï Add Category</button>`;
            
            // Edit Category Modal
            const editCategoryContent = `
                <div class="form-group">
                    <label>Category Name:</label>
                    <input type="text" id="editCategoryName" class="input" placeholder="◊ú◊û◊©◊ú, ◊©◊®◊™◊ô ◊û◊ì◊ô◊î">
                </div>
                <div class="form-group">
                    <label>Category Icon:</label>
                    <div id="editCategoryIconPicker" style="display: block; margin-top: 0.5rem;">
                        <div id="editCategoryIconGrid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; max-height: 300px; overflow-y: auto; padding: 0.5rem; border: 1px solid var(--card-border); border-radius: 0.5rem; background: var(--card-bg);">
                            <!-- Icons will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="edit-category-border-color-label">Category Border Color:</label>
                    <div id="editCategoryColorPicker"></div>
                    <input type="hidden" id="editCategoryBorderColor" value="#3b82f6">
                </div>
            `;
            
            const editCategoryActions = `<button class="btn btn-primary" onclick="saveEditCategory()">Save Changes</button>`;
            
            // Edit Server Modal
            const editServerContent = `
                <div class="form-group">
                    <label>Server Name:</label>
                    <input type="text" id="editServerName" class="input" placeholder="">
                </div>
                <div class="form-group">
                    <label>Server URL:</label>
                    <input type="text" id="editServerUrl" class="input" placeholder="">
                </div>
                <div class="form-group">
                    <label class="server-border-color-label">Server Border Color:</label>
                    <div id="editServerColorPicker"></div>
                    <input type="hidden" id="editServerBorderColor" value="#94a3b8">
                </div>
            `;
            
            const editServerActions = `<button class="btn btn-primary" onclick="saveServerEdit()">Save Changes</button>`;
            
            // Edit Title Modal
            const editTitleContent = `
                <div class="form-group">
                    <label>Title Text:</label>
                    <input type="text" id="editTitleText" class="input" placeholder="">
                </div>
                <div class="form-group">
                    <label class="title-text-color-label">Title Text Color:</label>
                    <div id="editTitleColorPicker"></div>
                    <input type="hidden" id="editTitleTextColor" value="#1e293b">
                </div>
            `;
            
            const editTitleActions = `<button class="btn btn-primary" onclick="saveTitleEdit()">Save Changes</button>`;
            
            // Edit Header Modal
            const editHeaderContent = `
                <div class="form-group">
                    <label id="headerIconLabel">Header Icon:</label>
                    <div id="headerIconPicker" class="icon-picker-grid">
                        <!-- Icons will be generated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Title:</label>
                    <input type="text" id="editHeaderTitle" class="input" placeholder="◊ú◊û◊©◊ú, ◊î◊í◊ì◊®◊ï◊™ ◊©◊®◊™◊ô◊ù ◊ë◊ô◊™◊ô◊ô◊ù">
                </div>
                <div class="form-group">
                    <label>Subtitle:</label>
                    <input type="text" id="editHeaderSubtitle" class="input" placeholder="◊ú◊û◊©◊ú, ◊†◊ô◊î◊ï◊ú ◊©◊®◊™◊ô◊ù ◊ï◊©◊ô◊®◊ï◊™◊ô◊ù ◊û◊ß◊ï◊û◊ô◊ô◊ù">
                </div>
                <div class="form-group">
                    <label class="header-title-color-label">Title Color:</label>
                    <div id="headerTitleColorPicker"></div>
                    <input type="hidden" id="headerTitleColor" value="#3b82f6">
                </div>
                <div class="form-group">
                    <label class="header-subtitle-color-label">Subtitle Color:</label>
                    <div id="headerSubtitleColorPicker"></div>
                    <input type="hidden" id="headerSubtitleColor" value="#6b7280">
                </div>
            `;
            
            const editHeaderActions = `<button class="btn btn-primary" onclick="saveHeaderEdit()">Save Changes</button>`;
            
            // Protocol Selection Modal
            const protocolContent = `
                <p id="protocolModalDesc">Please select a protocol for your URL:</p>
                <div class="protocol-options">
                    <button class="protocol-option" onclick="selectProtocol('http://')">
                        <span class="protocol-icon">üåê</span>
                        <span class="protocol-name" data-key="protocolHttp">HTTP</span>
                        <span class="protocol-desc" data-key="protocolHttpDesc">Standard web protocol</span>
                    </button>
                    <button class="protocol-option" onclick="selectProtocol('https://')">
                        <span class="protocol-icon">üîí</span>
                        <span class="protocol-name" data-key="protocolHttps">HTTPS</span>
                        <span class="protocol-desc" data-key="protocolHttpsDesc">Secure web protocol</span>
                    </button>
                    <button class="protocol-option" onclick="selectProtocol('ftp://')">
                        <span class="protocol-icon">üìÅ</span>
                        <span class="protocol-name" data-key="protocolFtp">FTP</span>
                        <span class="protocol-desc" data-key="protocolFtpDesc">File transfer protocol</span>
                    </button>
                    <button class="protocol-option" onclick="selectProtocol('sftp://')">
                        <span class="protocol-icon">üîê</span>
                        <span class="protocol-name" data-key="protocolSftp">SFTP</span>
                        <span class="protocol-desc" data-key="protocolSftpDesc">Secure file transfer</span>
                    </button>
                    <button class="protocol-option" onclick="selectProtocol('file://')">
                        <span class="protocol-icon">üíæ</span>
                        <span class="protocol-name" data-key="protocolFile">FILE</span>
                        <span class="protocol-desc" data-key="protocolFileDesc">Local file system</span>
                    </button>
                </div>
            `;
            
            const protocolActions = `<!-- No buttons needed for protocol selection -->`;
            
            // Generate all modals
            const modals = [
                createModalTemplate('addCategory', 'Add New Category', addCategoryContent, addCategoryActions),
                createModalTemplate('editCategory', 'Edit Category', editCategoryContent, editCategoryActions, true, true, 'deleteCategoryFromModal', '◊û◊ó◊ô◊ß◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î'),
                createModalTemplate('editServer', 'Edit Server', editServerContent, editServerActions, true, true, 'deleteServerFromModal', '◊û◊ó◊ô◊ß◊™ ◊©◊®◊™'),
                createModalTemplate('editTitle', 'Edit Title', editTitleContent, editTitleActions, true, true, 'deleteTitleFromModal', '◊û◊ó◊ô◊ß◊™ ◊õ◊ï◊™◊®◊™'),
                createModalTemplate('editHeader', 'Edit Header', editHeaderContent, editHeaderActions),
                createModalTemplate('protocolSelection', 'Select Protocol', protocolContent, protocolActions)
            ];
            
            modalContainer.innerHTML = modals.join('\n');
        }

        // Function to validate and format URLs with email detection
        // Automatically adds mailto: protocol for valid email addresses
        function validateAndFormatUrl(url) {
            if (!url || typeof url !== 'string') {
                return '';
            }
            
            // Trim whitespace
            url = url.trim();
            
            // If empty, return empty
            if (url === '') {
                return '';
            }
            
            // Check if it already has a protocol
            if (url.match(/^https?:\/\//)) {
                // If it has http://, convert to https://
                if (url.startsWith('http://')) {
                    url = url.replace('http://', 'https://');
                }
                return url;
            }
            
            // Check if it's an email address (contains @ and .)
            if (url.includes('@') && url.includes('.')) {
                // Basic email validation - ensures proper email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(url)) {
                    console.log('validateAndFormatUrl: Detected email address, adding mailto: protocol');
                    return 'mailto:' + url;
                }
            }
            
            // If it starts with www., add https://
            if (url.startsWith('www.')) {
                return 'https://' + url;
            }
            
            // For other cases, add https:// if no protocol is present
            // Check if it looks like a domain (contains dots and no spaces)
            if (url.includes('.') && !url.includes(' ')) {
                return 'https://' + url;
            }
            
            // If it doesn't look like a valid domain, return as is
            return url;
        }

        function updateSocialMediaItem(index, field, value) {
            if (socialMediaLinks[index]) {
                const link = socialMediaLinks[index];
                
                // Handle URL field with predefined social media logic
                if (field === 'url') {
                    const predefinedType = link.predefinedType;
                    const predefined = predefinedSocialMedia[predefinedType];
                    
                    if (predefinedType && predefinedType !== 'other' && predefined) {
                        // For predefined social media, construct the full URL
                        if (value.trim()) {
                            if (predefinedType === 'email') {
                                // For email, validate email format and use mailto: protocol
                                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                                if (emailRegex.test(value.trim())) {
                                    value = 'mailto:' + value.trim();
                                } else {
                                    // Invalid email format
                                    alert(currentLanguage === 'he' ? '◊ê◊†◊ê ◊î◊õ◊†◊° ◊õ◊™◊ï◊ë◊™ ◊ê◊ô◊û◊ô◊ô◊ú ◊™◊ß◊ô◊†◊î (◊ú◊û◊©◊ú: john@example.com)' : 'Please enter a valid email address (e.g., john@example.com)');
                                    return;
                                }
                            } else {
                                // For social media, combine base URL with username
                                value = predefined.baseUrl + value.trim();
                            }
                        } else {
                            value = '';
                        }
                    } else {
                        // For "other" type, use normal URL validation
                        value = validateAndFormatUrl(value);
                    }
                }
                
                // Update the field
                link[field] = value;
                
                // Update icon preview if SVG changed
                if (field === 'svg') {
                    const preview = document.getElementById(`iconPreview_${index}`);
                    if (preview) {
                        preview.innerHTML = value;
                    }
                }
                
                // Update the input field with the formatted URL
                if (field === 'url') {
                    const urlInput = document.querySelector(`#socialMediaList .social-media-item[data-index="${index}"] .social-media-url`);
                    if (urlInput) {
                        // Show only the username part for predefined types
                        const predefinedType = link.predefinedType;
                        const predefined = predefinedSocialMedia[predefinedType];
                        
                        if (predefinedType && predefinedType !== 'other' && predefined) {
                            if (predefinedType === 'email') {
                                urlInput.value = value.replace('mailto:', '');
                            } else {
                                urlInput.value = value.replace(predefined.baseUrl, '');
                            }
                        } else {
                            urlInput.value = value;
                        }
                    }
                }
                
                // Save changes immediately
                saveSocialMediaLinks();
            }
        }

        function addSocialMediaItem() {
            const newItem = {
                id: 'custom_' + Date.now(),
                name: '',
                url: '',
                title: '',
                predefinedType: 'facebook', // Start with Facebook as default
                svg: '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>'
            };
            
            socialMediaLinks.push(newItem);
            populateSocialMediaEditor();
            
            // Save changes after adding
            saveSocialMediaLinks();
            
            // Auto-open the new item in edit mode and scroll to it
            setTimeout(() => {
                const newIndex = socialMediaLinks.length - 1;
                editSocialMediaItem(newIndex);
                
                // Scroll to the new item
                const newForm = document.getElementById(`expandedForm_${newIndex}`);
                if (newForm) {
                    newForm.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }, 100);
        }

        function removeSocialMediaItem(index) {
            if (socialMediaLinks.length > 1) {
                socialMediaLinks.splice(index, 1);
                populateSocialMediaEditor();
                
                // Save changes after removing
                saveSocialMediaLinks();
                
                // Update the bottom social media bar without page refresh
                renderSocialMediaBar();
            } else {
                const message = currentLanguage === 'he' 
                    ? '◊ó◊ô◊ô◊ë ◊ú◊î◊ô◊ï◊™ ◊ú◊§◊ó◊ï◊™ ◊ß◊ô◊©◊ï◊® ◊ê◊ó◊ì'
                    : 'At least one link must remain';
                alert(message);
            }
        }

        function saveSocialMediaChanges() {
            // Validate that all required fields are filled
            let hasEmptyFields = false;
            let emptyFieldNames = [];
            let hasInvalidUrls = false;
            let invalidUrlNames = [];
            
            socialMediaLinks.forEach((link, index) => {
                // Handle URL validation based on type
                const predefinedType = link.predefinedType;
                const predefined = predefinedSocialMedia[predefinedType];
                
                // Only require name for "other" type
                if (predefinedType === 'other' && !link.name.trim()) {
                    hasEmptyFields = true;
                    emptyFieldNames.push(currentLanguage === 'he' ? `◊©◊ù (◊©◊ï◊®◊î ${index + 1})` : `Name (row ${index + 1})`);
                }
                
                if (!link.url.trim()) {
                    hasEmptyFields = true;
                    emptyFieldNames.push(currentLanguage === 'he' ? `◊õ◊™◊ï◊ë◊™ (◊©◊ï◊®◊î ${index + 1})` : `URL (row ${index + 1})`);
                } else {
                    // Validate URL format based on type
                    let isValidUrl = false;
                    
                    if (predefinedType && predefinedType !== 'other' && predefined) {
                        // For predefined types, check if URL starts with the correct base
                        if (predefinedType === 'email') {
                            isValidUrl = link.url.startsWith('mailto:');
                        } else {
                            isValidUrl = link.url.startsWith(predefined.baseUrl);
                        }
                    } else {
                        // For "other" type, use normal validation
                        const formattedUrl = validateAndFormatUrl(link.url);
                        isValidUrl = formattedUrl.startsWith('https://') || formattedUrl.startsWith('mailto:');
                        link.url = formattedUrl;
                    }
                    
                    if (!isValidUrl) {
                        hasInvalidUrls = true;
                        invalidUrlNames.push(`${link.name || (currentLanguage === 'he' ? `◊©◊ï◊®◊î ${index + 1}` : `row ${index + 1}`)}`);
                    }
                }
                
                // Only require SVG for "other" type
                if (predefinedType === 'other' && !link.svg.trim()) {
                    hasEmptyFields = true;
                    emptyFieldNames.push(currentLanguage === 'he' ? `◊ú◊ï◊í◊ï (◊©◊ï◊®◊î ${index + 1})` : `Logo (row ${index + 1})`);
                }
            });
            
            if (hasEmptyFields) {
                const message = currentLanguage === 'he' 
                    ? `◊ê◊†◊ê ◊û◊ú◊ê ◊ê◊™ ◊õ◊ú ◊î◊©◊ì◊ï◊™ ◊î◊†◊ì◊®◊©◊ô◊ù:\n${emptyFieldNames.join('\n')}`
                    : `Please fill in all required fields:\n${emptyFieldNames.join('\n')}`;
                alert(message);
                return;
            }
            
            if (hasInvalidUrls) {
                const message = currentLanguage === 'he'
                    ? `◊õ◊™◊ï◊ë◊ï◊™ URL ◊ú◊ê ◊™◊ß◊ô◊†◊ï◊™:\n${invalidUrlNames.join('\n')}\n\n◊ê◊†◊ê ◊î◊õ◊†◊° ◊õ◊™◊ï◊ë◊™ URL ◊™◊ß◊ô◊†◊î (◊ú◊û◊©◊ú: example.com ◊ê◊ï https://example.com) ◊ê◊ï ◊õ◊™◊ï◊ë◊™ ◊ê◊ô◊û◊ô◊ô◊ú (◊ú◊û◊©◊ú: user@domain.com)`
                    : `Invalid URLs:\n${invalidUrlNames.join('\n')}\n\nPlease enter a valid URL (e.g., example.com or https://example.com) or email address (e.g., user@domain.com)`;
                alert(message);
                return;
            }
            
            saveSocialMediaLinks();
            renderSocialMediaBar();
            hideSocialMediaModal();
            showChangesNotification();
        }

        // Drag and drop functions for social media items
        function handleSocialMediaDragStart(e, index) {
            e.dataTransfer.setData('text/plain', index);
            e.target.classList.add('dragging');
        }

        function handleSocialMediaDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleSocialMediaDrop(e, dropIndex) {
            e.preventDefault();
            const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
            
            if (dragIndex !== dropIndex) {
                const draggedItem = socialMediaLinks[dragIndex];
                socialMediaLinks.splice(dragIndex, 1);
                socialMediaLinks.splice(dropIndex, 0, draggedItem);
                populateSocialMediaEditor();
                
                // Save changes after reordering
                saveSocialMediaLinks();
            }
            
            e.currentTarget.classList.remove('drag-over');
        }

        function handleSocialMediaDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.social-media-collapsed-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        // New function to edit a social media item
        function editSocialMediaItem(index) {
            // Close any other open forms first
            document.querySelectorAll('.social-media-expanded-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Open the selected form
            const form = document.getElementById(`expandedForm_${index}`);
            if (form) {
                form.classList.add('active');
            }
        }

        // Global variable to track pending social media data
        let pendingSocialMediaData = null;
        let pendingSocialMediaIndex = null;

        // New function to save a social media item
        function saveSocialMediaItem(index) {
            const form = document.getElementById(`expandedForm_${index}`);
            if (!form) return;
            
            // Get the updated values from the form
            const nameInput = form.querySelector('.social-media-name');
            const urlInput = form.querySelector('.social-media-url');
            const svgInput = form.querySelector('.svg-input');
            
            if (nameInput && urlInput) {
                // Update the social media link
                const link = socialMediaLinks[index];
                if (link) {
                    // For predefined types, use the predefined name
                    const predefined = predefinedSocialMedia[link.predefinedType];
                    if (predefined && link.predefinedType !== 'other') {
                        link.name = predefined.name;
                        
                        // Construct the full URL for predefined types
                        const profileName = urlInput.value.trim();
                        if (profileName) {
                            link.url = predefined.baseUrl + profileName;
                        } else {
                            link.url = predefined.baseUrl;
                        }
                    } else {
                        link.name = nameInput.value;
                        const url = urlInput.value.trim();
                        
                        // Check if URL has a protocol for "other" type
                        if (!hasProtocol(url)) {
                            // Store pending data and show protocol selection modal
                            pendingSocialMediaData = { name: nameInput.value, url: url, svg: svgInput ? svgInput.value : '' };
                            pendingSocialMediaIndex = index;
                            showProtocolSelectionModal();
                            return;
                        }
                        
                        link.url = url;
                    }
                    
                    if (svgInput) {
                        link.svg = svgInput.value;
                    }
                    
                    // Update the collapsed view with correct name
                    updateCollapsedView(index, link);
                    
                    // Save to localStorage
                    saveSocialMediaLinks();
                    
                    // Update the bottom social media bar without page refresh
                    renderSocialMediaBar();
                    
                    // Close the form
                    form.classList.remove('active');
                }
            }
        }

        // Helper function to update the collapsed view
        function updateCollapsedView(index, link) {
            const container = document.querySelector(`[data-index="${index}"]`);
            if (!container) return;
            
            const collapsedItem = container.querySelector('.social-media-collapsed-item');
            if (collapsedItem) {
                const nameElement = collapsedItem.querySelector('.social-media-collapsed-name');
                const urlElement = collapsedItem.querySelector('.social-media-collapsed-url');
                const iconElement = collapsedItem.querySelector('.social-media-collapsed-icon');
                
                // Update name - use predefined name for predefined types
                if (nameElement) {
                    const predefined = predefinedSocialMedia[link.predefinedType];
                    if (predefined && link.predefinedType !== 'other') {
                        nameElement.textContent = predefined.name;
                    } else {
                        nameElement.textContent = link.name;
                    }
                }
                
                // Update URL - show full URL for predefined types
                if (urlElement) {
                    const predefined = predefinedSocialMedia[link.predefinedType];
                    if (predefined && link.predefinedType !== 'other') {
                        // For predefined types, show the full URL
                        urlElement.textContent = link.url;
                    } else {
                        // For custom types, show the URL as entered
                        urlElement.textContent = link.url;
                    }
                }
                
                // Update icon - use predefined icon for predefined types
                if (iconElement) {
                    const predefined = predefinedSocialMedia[link.predefinedType];
                    if (predefined && link.predefinedType !== 'other') {
                        iconElement.innerHTML = predefined.svg;
                    } else {
                        iconElement.innerHTML = link.svg;
                    }
                }
            }
        }

        // Function to delete a social media item
        function deleteSocialMediaItem(index) {
            const link = socialMediaLinks[index];
            if (!link) return;
            
            // Prevent deleting the last item
            if (socialMediaLinks.length <= 1) {
                const message = currentLanguage === 'he' 
                    ? '◊ú◊ê ◊†◊ô◊™◊ü ◊ú◊û◊ó◊ï◊ß ◊ê◊™ ◊î◊§◊®◊ô◊ò ◊î◊ê◊ó◊®◊ï◊ü. ◊ê◊ù ◊ë◊®◊¶◊ï◊†◊ö ◊ú◊î◊°◊™◊ô◊® ◊ê◊™ ◊°◊®◊í◊ú ◊î◊®◊©◊™◊ï◊™ ◊î◊ó◊ë◊®◊™◊ô◊ï◊™, ◊™◊ï◊õ◊ú ◊ú◊¢◊©◊ï◊™ ◊ñ◊ê◊™ ◊û◊î◊î◊í◊ì◊®◊ï◊™.'
                    : 'Cannot delete the last item. If you want to hide the social media bar, you can do so from the settings.';
                alert(message);
                return;
            }
            
            const message = currentLanguage === 'he' 
                ? `◊î◊ê◊ù ◊ê◊™◊î ◊ë◊ò◊ï◊ó ◊©◊ë◊®◊¶◊ï◊†◊ö ◊ú◊û◊ó◊ï◊ß ◊ê◊™ "${link.name}"?`
                : `Are you sure you want to delete "${link.name}"?`;
            
            if (confirm(message)) {
                // Remove the item from the array
                socialMediaLinks.splice(index, 1);
                
                // Re-populate the editor to update indices
                populateSocialMediaEditor();
                
                // Save changes
                saveSocialMediaLinks();
                
                // Update the bottom social media bar
                renderSocialMediaBar();
            }
        }
        // Function to render social media bar
        function renderSocialMediaBar() {
            const container = document.querySelector('.social-media-container');
            if (!container) {
                return;
            }

            container.innerHTML = '';
            
            // Check edit mode state
            const isEditMode = document.querySelector('.container').classList.contains('edit-mode');
            
            // Add pencil edit button if in edit mode
            if (isEditMode) {
                const pencilBtn = document.createElement('button');
                pencilBtn.className = 'social-media-btn edit-btn';
                pencilBtn.title = t('editSocialMedia');
                pencilBtn.onclick = showSocialMediaModal;
                pencilBtn.innerHTML = '<svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>';
                container.appendChild(pencilBtn);
            }
            
            socialMediaLinks.forEach(link => {
                const btn = document.createElement('a');
                btn.href = link.url;
                btn.target = '_blank';
                btn.className = 'social-media-btn';
                btn.title = link.name || link.title || '';
                btn.onclick = (e) => {
                    if (isEditMode) {
                        e.preventDefault();
                        showSocialMediaModal();
                    }
                };

                // Create icon container and set SVG content
                const iconContainer = document.createElement('div');
                iconContainer.className = 'social-icon';
                const sanitizedSvg = validateAndSanitizeSvg(link.svg);
                iconContainer.innerHTML = sanitizedSvg;
                btn.appendChild(iconContainer);

                container.appendChild(btn);
            });
        }



        // Function to save social media links to localStorage
        function saveSocialMediaLinks() {
            // Always save to main data structure
            try {
                const mainData = localStorage.getItem(getLocalStorageKey());
                let data;
                
                if (mainData) {
                    data = secureJsonParse(mainData);
                } else {
                    // Create new main data structure if it doesn't exist
                    data = {
                        categories: categories,
                        headerTitle: headerTitle,
                        headerSubtitle: headerSubtitle,
                        headerTitleColor: localStorage.getItem('headerTitleColor') || '#3b82f6',
                        headerSubtitleColor: localStorage.getItem('headerSubtitleColor') || '#6b7280',
                        currentLanguage: currentLanguage
                    };
                }
                
                data.socialMediaLinks = socialMediaLinks;
                localStorage.setItem(getLocalStorageKey(), JSON.stringify(data));
            } catch (error) {
                // Fallback to separate storage
                localStorage.setItem('socialMediaLinks', JSON.stringify(socialMediaLinks));
            }
        }

        // Function to load social media links from localStorage
        function loadSocialMediaLinks() {
            // Try to load from the main data structure first
            const mainData = localStorage.getItem(getLocalStorageKey());
            if (mainData) {
                try {
                    const data = secureJsonParse(mainData);
                    if (data.socialMediaLinks) {
                        socialMediaLinks = data.socialMediaLinks;
                        console.log('‚úÖ Loaded social media links from main data');
                        return;
                    }
                } catch (error) {
                    console.log('‚ùå Failed to load social media links from main data:', error);
                }
            }
            
            // Fallback to separate social media links storage (legacy)
            const saved = localStorage.getItem('socialMediaLinks');
            if (saved) {
                try {
                    socialMediaLinks = secureJsonParse(saved);
                    console.log('‚úÖ Loaded social media links from legacy storage');
                } catch (error) {
                    console.log('‚ùå Failed to load social media links:', error);
                }
            }
        }

        // Get the JSON filename based on current HTML filename
        function getJsonFilename() {
            let currentFilename = window.location.pathname.split('/').pop();
            // Handle root domain serving index.html
            if (!currentFilename || currentFilename === '') {
                currentFilename = 'index.html';
            }
            return currentFilename.replace('.html', '.json');
        }

        // Get localStorage key based on current HTML filename
        function getLocalStorageKey() {
            let currentFilename = window.location.pathname.split('/').pop();
            // Handle root domain serving index.html
            if (!currentFilename || currentFilename === '') {
                currentFilename = 'index.html';
            }
            const baseName = currentFilename.replace('.html', '');
            return `personalServicesIndex_${baseName}`;
        }
        // Load setup from localStorage first, fallback to JSON file
        async function loadData() {
            // Load social media links
            loadSocialMediaLinks();
            
            // Check for shared parameters first
            if (checkForSharedParameters()) {
                return;
            }
            
            // Check for reset parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const hasResetParam = urlParams.has('reset') || window.location.pathname.includes('/?reset');
            
            if (hasResetParam) {
                // Clear localStorage to force loading from JSON file
                localStorage.removeItem(getLocalStorageKey());
                // Remove reset parameter from URL without page reload
                const newUrl = window.location.pathname + window.location.search.replace(/[?&]reset/, '').replace(/^&/, '?');
                window.history.replaceState({}, '', newUrl);
                // Reset to language-appropriate defaults
                resetToLanguageDefaults();
            }
            
            // Try to load from localStorage first (unless reset was requested)
            const saved = localStorage.getItem(getLocalStorageKey());
            if (saved && !hasResetParam) {
                try {
                    const data = secureJsonParse(saved);
                    
                    // Validate the data structure
                    if (validateImportedData(data)) {
                        categories = data.categories || categories;
                        headerTitle = data.headerTitle || headerTitle;
                        headerSubtitle = data.headerSubtitle || headerSubtitle;
                        
                        // Initialize status indicators for all services (default to offline)
                        categories.forEach(category => {
                            category.servers.forEach(server => {
                                if (!server.status) {
                                    server.status = 'offline';
                                }
                            });
                        });
                        
                        // Apply header colors if they exist
                        if (data.headerTitleColor) {
                            localStorage.setItem('headerTitleColor', data.headerTitleColor);
                        }
                        if (data.headerSubtitleColor) {
                            localStorage.setItem('headerSubtitleColor', data.headerSubtitleColor);
                        }
                        if (data.currentLanguage) {
                            setLanguage(data.currentLanguage);
                        }
                        
                        // Load social media links if they exist
                        if (data.socialMediaLinks) {
                            socialMediaLinks = data.socialMediaLinks;
                        }
                        
                        // Store initial data for comparison (only categories and services)
                        initialData = {
                            categories: categories,
                            headerTitle: headerTitle,
                            headerSubtitle: headerSubtitle,
                            socialMediaLinks: socialMediaLinks
                        };
                        return;
                    }
                } catch (error) {
                    // Silent fail for localStorage errors
                }
            }
            
            // Fallback to JSON file
            const jsonFilename = getJsonFilename();
            try {
                // Try to load from JSON file
                const response = await fetch(jsonFilename);
                if (response.ok) {
                    let fileData;
                    try {
                        fileData = await response.json();
                        console.log('üìÑ Raw JSON data received:', fileData);
                        console.log('üìÑ JSON data type:', typeof fileData);
                        console.log('üìÑ JSON data keys:', Object.keys(fileData || {}));
                    } catch (jsonError) {
                        console.log('‚ùå JSON parsing failed:', jsonError);
                        const responseText = await response.text();
                        console.log('üìÑ Response text:', responseText);
                        throw jsonError;
                    }
                    
                    // Validate the data structure
                    // Check if fileData is null, undefined, or empty
                    if (!fileData) {
                        throw new Error('JSON data is null or undefined');
                    }
                    
                    const validationResult = validateImportedData(fileData);
                    if (validationResult) {
                        categories = fileData.categories || categories;
                        headerTitle = fileData.headerTitle || headerTitle;
                        headerSubtitle = fileData.headerSubtitle || headerSubtitle;
                        
                        // Initialize status indicators for all services (default to offline)
                        categories.forEach(category => {
                            category.servers.forEach(server => {
                                if (!server.status) {
                                    server.status = 'offline';
                                }
                            });
                        });
                        
                        // Apply header colors if they exist
                        if (fileData.headerTitleColor) {
                            localStorage.setItem('headerTitleColor', fileData.headerTitleColor);
                        }
                        if (fileData.headerSubtitleColor) {
                            localStorage.setItem('headerSubtitleColor', fileData.headerSubtitleColor);
                        }
                        if (fileData.currentLanguage) {
                            setLanguage(fileData.currentLanguage);
                        }
                        
                        // Load social media links if they exist
                        if (fileData.socialMediaLinks) {
                            socialMediaLinks = fileData.socialMediaLinks;
                        }
                        
                        // Store initial data for comparison (only categories and services)
                        initialData = {
                            categories: categories,
                            headerTitle: headerTitle,
                            headerSubtitle: headerSubtitle,
                            socialMediaLinks: socialMediaLinks
                        };
                        return;
                    }
                }
            } catch (error) {
                // Silent fail for file loading errors
            }
            
            // If both localStorage and file fail, use default data with language detection
            detectLanguageAndSetDefaults();
            
            // Store initial data for comparison (only categories and services)
            initialData = {
                categories: categories,
                headerTitle: headerTitle,
                headerSubtitle: headerSubtitle,
                socialMediaLinks: socialMediaLinks
            };
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const hamburger = document.querySelector('.hamburger-menu');
            const overlay = document.querySelector('.mobile-menu-overlay');
            const menu = document.querySelector('.mobile-menu');
            
            hamburger.classList.toggle('active');
            overlay.classList.toggle('active');
            menu.classList.toggle('active');
            
            // Load settings when menu opens
            if (menu.classList.contains('active')) {
                loadMobileSettings();
                updateMobileMenuLanguage();
            }
            
            // Prevent body scroll when menu is open
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        }

        function closeMobileMenu() {
            const hamburger = document.querySelector('.hamburger-menu');
            const overlay = document.querySelector('.mobile-menu-overlay');
            const menu = document.querySelector('.mobile-menu');
            
            hamburger.classList.remove('active');
            overlay.classList.remove('active');
            menu.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Initialize theme
        function initTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateDarkModeIcon();
            updateLanguageIcon();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('dashboardTheme', currentTheme);
            updateDarkModeIcon();
            updateMobileMenuLanguage();
            updateDesktopMenuLanguage();
        }

        // Update dark mode icon
        function updateDarkModeIcon() {
            const icon = document.querySelector('.dark-mode-icon');
            if (icon) {
                icon.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }
        }

        // Toggle language
        function toggleLanguage() {
            const newLang = currentLanguage === 'en' ? 'he' : 'en';
            setLanguage(newLang);
            updateLanguageIcon();
        }

        // Toggle language in desktop menu (keeps menu open)
        function toggleLanguageInDesktopMenu() {
            const newLang = currentLanguage === 'en' ? 'he' : 'en';
            setLanguage(newLang);
            updateLanguageIcon();
            
            // Update the desktop menu language without closing it
            updateDesktopMenuLanguage();
            
            // Update menu direction for RTL/LTR
            const menu = document.getElementById('desktopMenu');
            if (menu) {
                menu.setAttribute('dir', currentLanguage === 'he' ? 'rtl' : 'ltr');
            }
            
            // Update button positions for the new language direction
            updateGoogleAnalyticsClearButton();
        }

        // Toggle edit mode
        function toggleEditMode() {
            const container = document.querySelector('.container');
            const toggleBtn = document.getElementById('editModeToggle');
            
            if (container.classList.contains('edit-mode')) {
                // Exiting edit mode - check for unsaved changes
                if (hasDataChanged()) {
                    showChangesNotification();
                }
                
                container.classList.remove('edit-mode');
                toggleBtn.style.background = 'var(--btn-secondary-bg)';
                toggleBtn.style.color = 'var(--text-muted)';
            } else {
                // Entering edit mode
                container.classList.add('edit-mode');
                toggleBtn.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
                toggleBtn.style.color = 'white';
            }
            
            // Refresh header text to show/hide edit buttons
            updateTexts();
            
            // Re-render categories to update click handlers
            renderCategories();
            
            // Re-render social media bar to update edit mode
            renderSocialMediaBar();
        }

        // Update language icon
        function updateLanguageIcon() {
            const langBtn = document.querySelector('.lang-toggle-btn');
            if (langBtn) {
                langBtn.title = currentLanguage === 'en' ? '◊¢◊ë◊®◊ô◊™' : 'English';
            }
        }

        // Save data to both localStorage and JSON file
        async function saveData() {
            // Strip status indicators before saving to localStorage
            const dataToSave = stripStatusIndicators({
                categories,
                headerTitle,
                headerSubtitle,
                headerTitleColor: localStorage.getItem('headerTitleColor') || '#3b82f6',
                headerSubtitleColor: localStorage.getItem('headerSubtitleColor') || '#6b7280',
                currentLanguage: currentLanguage,
                socialMediaLinks: socialMediaLinks
            });
            
            // Always save to localStorage first
            localStorage.setItem(getLocalStorageKey(), JSON.stringify(dataToSave));
            
            // Note: JSON file saving is now manual via export function
            // This prevents automatic popup downloads
        }

        // Store initial data for comparison
        let initialData = null;

        // Helper function to strip status indicators from data for comparison (including social media)
        function stripStatusIndicators(data) {
            if (!data || !data.categories) {
                return data;
            }
            
            const strippedData = {
                categories: data.categories.map(category => ({
                    id: category.id,
                    name: category.name,
                    borderColor: category.borderColor,
                    customIcon: category.customIcon,
                    servers: category.servers.map(server => ({
                        id: server.id,
                        name: server.name,
                        url: server.url,
                        borderColor: server.borderColor
                        // status is intentionally excluded
                    })),
                    titles: category.titles ? category.titles.map(title => ({
                        id: title.id,
                        text: title.text,
                        textColor: title.textColor
                    })) : [],
                    itemOrder: category.itemOrder || []
                })),
                headerTitle: data.headerTitle,
                headerSubtitle: data.headerSubtitle,
                socialMediaLinks: data.socialMediaLinks || []
            };
            
            return strippedData;
        }
        // Compare current data with initial data to detect actual changes
        function hasDataChanged() {
            if (!initialData) {
                return false; // No initial data to compare
            }
            
            try {
                // Compare only categories and servers (ignore language, theme, status indicators, etc.)
                const currentData = {
                    categories: categories,
                    headerTitle: headerTitle,
                    headerSubtitle: headerSubtitle,
                    socialMediaLinks: socialMediaLinks
                };
                
                // Strip status indicators from both current and initial data before comparison
                const strippedCurrentData = stripStatusIndicators(currentData);
                const strippedInitialData = stripStatusIndicators(initialData);
                
                // Deep comparison of categories and servers (excluding status indicators)
                return JSON.stringify(strippedCurrentData) !== JSON.stringify(strippedInitialData);
            } catch (error) {
                console.log('Error comparing data:', error);
                return false;
            }
        }

        // Show notification for unsaved changes
        function showChangesNotification() {
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            const notification = document.getElementById('changesNotification');
            if (notification) {
                // Clear existing content and add close button
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + t('changesNotSaved');
                notification.classList.add('show');
            }
        }

        // Close both mobile and desktop menus
        function closeAllMenus() {
            closeMobileMenu();
            const desktopMenu = document.getElementById('desktopMenu');
            if (desktopMenu) {
                desktopMenu.classList.remove('show');
                document.removeEventListener('click', handleDesktopMenuClickOutside);
                document.removeEventListener('mousedown', handleDesktopMenuMouseDown);
            }
        }

        // Hide notification
        function hideChangesNotification() {
            const notification = document.getElementById('changesNotification');
            if (notification) {
                notification.classList.remove('show');
            }
        }

        // Get icon for category
        function getCategoryIcon(customIcon = null) {
            // Return custom icon if provided, otherwise default folder icon
            return customIcon || 'üìÅ';
        }

        // Get mixed order of items (servers and titles) for a category
        function getMixedItems(category) {
            const mixedItems = [];
            
            // Initialize itemOrder if it doesn't exist (for backward compatibility)
            if (!category.itemOrder) {
                category.itemOrder = [];
                
                // Add existing servers and titles to itemOrder
                if (category.servers) {
                    category.servers.forEach(server => {
                        category.itemOrder.push({ type: 'server', id: server.id });
                    });
                }
                if (category.titles) {
                    category.titles.forEach(title => {
                        category.itemOrder.push({ type: 'title', id: title.id });
                    });
                }
            }
            
            // Build mixed items array based on itemOrder
            category.itemOrder.forEach(orderItem => {
                if (orderItem.type === 'server') {
                    const server = category.servers.find(s => s.id === orderItem.id);
                    if (server) {
                        mixedItems.push({ type: 'server', data: server });
                    }
                } else if (orderItem.type === 'title') {
                    const title = category.titles.find(t => t.id === orderItem.id);
                    if (title) {
                        mixedItems.push({ type: 'title', data: title });
                    }
                }
            });
            
            // Add any items that might not be in itemOrder (for backward compatibility)
            if (category.servers) {
                category.servers.forEach(server => {
                    const exists = mixedItems.some(item => item.type === 'server' && item.data.id === server.id);
                    if (!exists) {
                        mixedItems.push({ type: 'server', data: server });
                    }
                });
            }
            if (category.titles) {
                category.titles.forEach(title => {
                    const exists = mixedItems.some(item => item.type === 'title' && item.data.id === title.id);
                    if (!exists) {
                        mixedItems.push({ type: 'title', data: title });
                    }
                });
            }
            
            return mixedItems;
        }
        // Translations
        const translations = {
            en: {
                title: "Home Server Configuration",
                subtitle: "Manage your local servers and services",
                addCategory: "‚ûï Add Category",
                exportConfig: "üíæ Export Config",
                importConfig: "Import Config",
                addServer: "‚ûï Add URL",
                addTitle: "‚úçÔ∏è Add Title",
                filterPlaceholder: "Filter...",
                editCategory: "Edit category",
                deleteCategory: "Delete category",
                editServer: "Edit URL",
                editTitle: "Edit title",
                openServer: "Open server",
                deleteServer: "Delete server",
                deleteTitle: "Delete title",
                addNewCategory: "Add New Category",
                addNewServer: "Add New Server",
                addNewTitle: "Add New Title",
                categoryName: "Category Name:",
                categoryIcon: "Category Icon:",
                selectCategoryIcon: "Please select a category icon",
                categoryBorderColor: "Category Border Color:",
                cancel: "Cancel",
                editServerTitle: "Edit Server",
                serverName: "Server Name:",
                titleText: "Title Text:",
                serverUrl: "URL:",
                status: "Title Border Color:",
                serverBorderColor: "Server Border Color:",
                titleTextColor: "Title Text Color:",
                online: "üü¢ Online",
                warning: "üü° Warning",
                offline: "üî¥ Offline",
                saveChanges: "Save Changes",
                deleteConfirm: "Delete this URL?",
                deleteTitleConfirm: "Delete this title?",
                deleteCategoryConfirm: "Delete this entire category?",
                importConfirm: "This will replace your current configuration. Continue?",
                invalidConfig: "Invalid configuration file",
                serverNotFound: "Server not found. Please try again.",
                titleNotFound: "Title not found. Please try again.",
                fillRequiredFields: "Please fill in all required fields.",
                checkingStatus: "Checking server status...",
                statusCheckFailed: "Status check failed",
                checkStatus: "Check Status",
                // Tooltips
                clearSearch: "Clear search",

                exportConfigTooltip: "Export Config",
                importConfigTooltip: "Import Config",
                addCategoryTooltip: "Add Category",
                toggleLanguage: "Toggle language",
                toggleDarkMode: "Dark \\ Light mode",
                toggleEditMode: "Edit",
                clickToEdit: "Click to edit",
                clickToCheckStatus: "Click to check status",
                showUrl: "Show URL",

                editHeader: "Edit header",
                editHeaderTitle: "Edit Header",
                headerTitleLabel: "Title:",
                headerSubtitleLabel: "Subtitle:",
                headerTitleColorLabel: "Title Color:",
                headerIconLabel: "Header Icon:",
                headerSubtitleColorLabel: "Subtitle Color:",
                // Placeholders
                categoryNamePlaceholder: "e.g., Media Servers",
                serverNamePlaceholder: "e.g., Plex Server",
                serverUrlPlaceholder: "e.g., http://192.168.1.100:8080",
                headerTitlePlaceholder: "e.g., Home Server Configuration",
                headerSubtitlePlaceholder: "e.g., Manage your local servers and services",
                titleTextPlaceholder: "Enter title text...",
                // Delete buttons
                deleteCategoryBtn: "üóëÔ∏è",
                deleteServerBtn: "üóëÔ∏è",
                // Category types
                media: "Media",
                network: "Network",
                storage: "Storage",
                services: "Services",
                development: "Development",
                monitoring: "Monitoring",
                security: "Security",
                communication: "Communication",
                productivity: "Productivity",
                gaming: "Gaming",
                database: "Database",
                automation: "Automation",
                // Alert messages
                changesNotSaved: "‚ö†Ô∏è Changes detected! These changes are saved and used locally only. To back up your config to a file, click <a href='#' onclick='exportConfig(); return false;' style='color: white; text-decoration: underline; font-weight: bold;'>here</a>.",
                loadingFromFile: "üìÅ Loading configuration from file...",
                fileLoadFailed: "‚ùå Failed to load from file, using local storage",
                fileLoadSuccess: "‚úÖ Configuration loaded from file successfully",
                savingToFile: "üíæ Saving configuration to file...",
                fileSaveSuccess: "‚úÖ Configuration saved to file successfully",
                fileSaveFailed: "‚ùå Failed to save to file, saved to local storage only",
                // Drag and drop
                dragToReorderCategory: "Drag to reorder category",
                dragToReorderServer: "Drag to reorder server",
                dragToReorderTitle: "Drag to reorder title",
                // Validation messages
                invalidUrl: "Please enter a valid URL (http:// or https://)",
                titleTooLong: "Title is too long. Maximum 100 characters allowed.",
                subtitleTooLong: "Subtitle is too long. Maximum 200 characters allowed.",
                serverNameRequired: "Server name is required and must be less than 50 characters.",
                titleTextRequired: "Title text is required and must be less than 50 characters.",
                invalidUrlFormat: "Invalid URL format",
                categoryNameRequired: "Category name is required and must be less than 50 characters.",
                invalidConfigFormat: "Invalid configuration format. Please check your JSON file.",
                // Protocol selection
                selectProtocol: "Select Protocol",
                selectProtocolDesc: "Please select a protocol for your URL:",
                protocolHttp: "HTTP",
                protocolHttpDesc: "Standard web protocol",
                protocolHttps: "HTTPS", 
                protocolHttpsDesc: "Secure web protocol",
                protocolFtp: "FTP",
                protocolFtpDesc: "File transfer protocol",
                protocolSftp: "SFTP",
                protocolSftpDesc: "Secure file transfer",
                protocolFile: "FILE",
                protocolFileDesc: "Local file system",
                // URL popup
                copyUrl: "üìã Copy",
                openUrl: "üîó Open",
                copiedUrl: "Copied!",
                // Share functionality
                shareDashboard: "Share Setup",
                saveToLocal: "Save to Local Storage",
                saveLocally: "Save locally",
                shareOptionsModalTitle: "Share Configuration",
                shareOptionsModalText: "Choose how you want to share your current unique configuration:",
                shareUrlLabel: "Share URL:",
                saveConfiguration: "üíæ Save to File",
                copyShareUrl: "Copy Unique URL",
                shareUrl: "üì§ Share Unique URL",
                savedToLocalSuccess: "‚úÖ Saved to local storage successfully!",
                sharingWarning: "‚ö†Ô∏è Sharing your configuration will reveal your list to others",
                shareErrorHttps: "‚ùå This browser only supports sharing secure protocol like HTTPS. You can copy the URL and send it manually instead.",
                sharedModeWarning: "‚ö†Ô∏è This view is temporary. If you like it, <a href='#' onclick='saveSharedDataToLocal(); return false;' style='color: white; text-decoration: underline; font-weight: bold;'>save it</a>; otherwise, simply click <a href='ORIGINAL_URL' style='color: white; text-decoration: underline; font-weight: bold;'>here</a>.",
                close: "Close",
                deleteServer: "Delete URL",
                deleteCategory: "Delete category",
                deleteTitle: "Delete title",
                // Mobile menu translations

                mobileImportConfig: "Import Config",
                mobileAddCategory: "Add Category",
                mobileToggleEditMode: "Edit",
                mobileShareConfiguration: "Share Configuration",
                mobileToggleLanguage: "Toggle Language",
                mobileToggleDarkMode: "Dark \\ Light Mode",
                mobileActions: "Actions",
                mobileSettings: "Settings",
                mobileSearchPlaceholder: "Search servers...",
                mobileMenuTitle: "Menu",
                mobileHelp: "Help",
                desktopServerStatusCheck: "Check Server Status",
                mobileServerStatusCheck: "Check Server Status",
                showMostUsedWebsites: "Show Most Used Websites",
                hideMostUsedWebsites: "Hide Most Used Websites",
                mostUsedWebsitesTooltip: "Show a category with your most frequently visited websites",
                mostRecentWebsites: "Most Recent Websites",
                mostPopularWebsites: "Most Popular Websites",
                openLinksInNewTab: "Open Links in New Tab",
                openLinksInSameTab: "Open Links in Same Tab",
                openLinksInNewTabTooltip: "Toggle whether links open in a new tab or the same tab",
                showWebsitesStatus: "Enable websites checks",
                disableWebsiteCheck: "Disable websites checks",
                serverStatusCheckTooltip: "Check the websites status when loading the page",
                showMostUsedWebsites: "Show Most Used Websites",
                hideMostUsedWebsites: "Hide Most Used Websites",
                mostUsedWebsitesTooltip: "Show a category with your most frequently visited websites",
                mostRecentWebsites: "Most Recent Websites",
                mostPopularWebsites: "Most Popular Websites",
                openLinksInNewTab: "Open Links in New Tab",
                openLinksInSameTab: "Open Links in Same Tab",
                openLinksInNewTabTooltip: "Toggle whether links open in a new tab or the same tab",
                // Social Media Editor
                editSocialMedia: "Edit Social Media",
                socialMediaName: "Social Media Name",
                url: "URL",
                svgCode: "SVG code for logo",
                findSvgLogos: "Find SVG logos at:",
                dragToReorder: "Drag to reorder",
                remove: "Remove",
                addSocialMedia: "Add Social Media",
                saveChanges: "Save Changes",
                cancel: "Cancel",
                atLeastOneLink: "At least one link must remain",
                newSocialMedia: "New Social Media"
            },
            he: {
                title: "◊î◊í◊ì◊®◊ï◊™ ◊ê◊™◊®◊ô◊ù ◊ë◊ô◊™◊ô◊ô◊ù",
                subtitle: "◊†◊î◊ú ◊ê◊™ ◊î◊ê◊™◊®◊ô◊ù ◊î◊û◊ß◊ï◊û◊ô◊ô◊ù ◊©◊ú◊ö",
                addCategory: "‚ûï ◊î◊ï◊°◊§◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                exportConfig: "üíæ ◊ô◊ô◊¶◊ê ◊î◊í◊ì◊®◊ï◊™",
                importConfig: "◊ô◊ë◊ï◊ê ◊î◊í◊ì◊®◊ï◊™",
                addServer: "‚ûï ◊î◊ï◊°◊§◊™ ◊ê◊™◊®",
                addTitle: "‚úçÔ∏è ◊î◊ï◊°◊§◊™ ◊õ◊ï◊™◊®◊™",
                filterPlaceholder: "◊°◊ô◊†◊ï◊ü...",
                editCategory: "◊¢◊®◊ô◊õ◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                deleteCategory: "◊û◊ó◊ô◊ß◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                editServer: "◊¢◊®◊ô◊õ◊™ ◊õ◊™◊ï◊ë◊™",
                editTitle: "◊¢◊®◊ô◊õ◊™ ◊õ◊ï◊™◊®◊™",
                openServer: "◊§◊™◊ó ◊ê◊™◊®",
                deleteServer: "◊û◊ó◊ô◊ß◊™ ◊õ◊™◊ï◊ë◊™",
                deleteTitle: "◊û◊ó◊ô◊ß◊™ ◊õ◊ï◊™◊®◊™",
                addNewCategory: "◊î◊ï◊°◊§◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î ◊ó◊ì◊©◊î",
                addNewServer: "◊î◊ï◊°◊§◊™ ◊õ◊™◊ï◊ë◊™ ◊ó◊ì◊©◊î",
                addNewTitle: "◊î◊ï◊°◊§◊™ ◊õ◊ï◊™◊®◊™ ◊ó◊ì◊©◊î",
                categoryName: "◊©◊ù ◊ß◊ò◊í◊ï◊®◊ô◊î:",
                categoryIcon: "◊°◊û◊ú ◊ß◊ò◊í◊ï◊®◊ô◊î:",
                selectCategoryIcon: "◊ô◊© ◊ú◊ë◊ó◊ï◊® ◊°◊û◊ú ◊ß◊ò◊í◊ï◊®◊ô◊î",
                categoryBorderColor: "◊¶◊ë◊¢ ◊í◊ë◊ï◊ú ◊ß◊ò◊í◊ï◊®◊ô◊î:",
                cancel: "◊ë◊ô◊ò◊ï◊ú",
                editServerTitle: "◊¢◊®◊ô◊õ◊™ ◊õ◊™◊ï◊ë◊™",
                serverName: "◊©◊ù ◊ê◊™◊®:",
                titleText: "◊ò◊ß◊°◊ò ◊õ◊ï◊™◊®◊™:",
                serverUrl: "◊õ◊™◊ï◊ë◊™ ◊ê◊™◊®:",
                status: "◊¶◊ë◊¢ ◊í◊ë◊ï◊ú ◊õ◊ï◊™◊®◊™:",
                serverBorderColor: "◊¶◊ë◊¢ ◊í◊ë◊ï◊ú ◊ê◊™◊®:",
                titleTextColor: "◊¶◊ë◊¢ ◊ò◊ß◊°◊ò ◊õ◊ï◊™◊®◊™:",
                online: "üü¢ ◊û◊ß◊ï◊ï◊ü",
                warning: "üü° ◊ê◊ñ◊î◊®◊î",
                offline: "üî¥ ◊ú◊ê ◊û◊ß◊ï◊ï◊ü",
                saveChanges: "◊©◊û◊ô◊®◊™ ◊©◊ô◊†◊ï◊ô◊ô◊ù",
                deleteConfirm: "◊û◊ó◊ô◊ß◊™ ◊õ◊™◊ï◊ë◊™ ◊ñ◊ï?",
                deleteTitleConfirm: "◊û◊ó◊ß ◊õ◊ï◊™◊®◊™ ◊ñ◊ï?",
                deleteCategoryConfirm: "◊û◊ó◊ô◊ß◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î ◊©◊ú◊û◊î ◊ñ◊ï?",
                importConfirm: "◊ñ◊î ◊ô◊ó◊ú◊ô◊£ ◊ê◊™ ◊î◊î◊í◊ì◊®◊ï◊™ ◊î◊†◊ï◊õ◊ó◊ô◊ï◊™ ◊©◊ú◊ö. ◊ú◊î◊û◊©◊ô◊ö?",
                invalidConfig: "◊ß◊ï◊ë◊• ◊î◊í◊ì◊®◊ï◊™ ◊ú◊ê ◊™◊ß◊ô◊ü",
                serverNotFound: "◊ê◊™◊® ◊ú◊ê ◊†◊û◊¶◊ê. ◊†◊°◊î ◊©◊ï◊ë.",
                titleNotFound: "◊õ◊ï◊™◊®◊™ ◊ú◊ê ◊†◊û◊¶◊ê◊î. ◊†◊°◊î ◊©◊ï◊ë.",
                fillRequiredFields: "◊ô◊© ◊ú◊û◊ú◊ê ◊ê◊™ ◊õ◊ú ◊î◊©◊ì◊ï◊™ ◊î◊†◊ì◊®◊©◊ô◊ù.",
                checkingStatus: "◊ë◊ï◊ì◊ß ◊°◊ò◊ò◊ï◊° ◊ê◊™◊®...",
                statusCheckFailed: "◊ë◊ì◊ô◊ß◊™ ◊°◊ò◊ò◊ï◊° ◊†◊õ◊©◊ú◊î",
                checkStatus: "◊ë◊ì◊ï◊ß ◊°◊ò◊ò◊ï◊°",
                // Tooltips
                clearSearch: "◊†◊ô◊ß◊ï◊ô ◊ó◊ô◊§◊ï◊©",

                exportConfigTooltip: "◊ô◊ô◊¶◊ï◊ê ◊î◊í◊ì◊®◊ï◊™",
                importConfigTooltip: "◊ô◊ô◊ë◊ï◊ê ◊î◊í◊ì◊®◊ï◊™",
                addCategoryTooltip: "◊î◊ï◊°◊§◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                toggleLanguage: "◊î◊ó◊ú◊§◊™ ◊©◊§◊î",
                toggleDarkMode: "◊û◊¶◊ë ◊õ◊î◊î / ◊ë◊î◊ô◊®",
                toggleEditMode: "◊¢◊®◊ô◊õ◊î",
                clickToEdit: "◊ú◊ó◊ô◊¶◊î ◊ú◊¢◊®◊ô◊õ◊î",
                clickToCheckStatus: "◊ú◊ó◊• ◊ú◊ë◊ì◊ô◊ß◊™ ◊°◊ò◊ò◊ï◊°",
                showUrl: "◊î◊¶◊í◊™ ◊õ◊™◊ï◊ë◊™",

                editHeader: "◊¢◊®◊ô◊õ◊™ ◊õ◊ï◊™◊®◊™",
                editHeaderTitle: "◊¢◊®◊ô◊õ◊™ ◊õ◊ï◊™◊®◊™",
                headerTitleLabel: "◊õ◊ï◊™◊®◊™:",
                headerSubtitleLabel: "◊õ◊ï◊™◊®◊™ ◊û◊©◊†◊î:",
                headerTitleColorLabel: "◊¶◊ë◊¢ ◊õ◊ï◊™◊®◊™:",
                headerIconLabel: "◊°◊û◊ú ◊õ◊ï◊™◊®◊™:",
                headerSubtitleColorLabel: "◊¶◊ë◊¢ ◊õ◊ï◊™◊®◊™ ◊û◊©◊†◊î:",
                // Placeholders
                categoryNamePlaceholder: "◊ú◊û◊©◊ú, ◊ê◊™◊®◊ô ◊û◊ì◊ô◊î",
                serverNamePlaceholder: "◊ú◊û◊©◊ú, ◊©◊®◊™ Plex",
                serverUrlPlaceholder: "◊ú◊û◊©◊ú, http://192.168.1.100:8080",
                headerTitlePlaceholder: "◊ú◊û◊©◊ú, ◊î◊í◊ì◊®◊ï◊™ ◊ê◊™◊®◊ô◊ù ◊ë◊ô◊™◊ô◊ô◊ù",
                headerSubtitlePlaceholder: "◊ú◊û◊©◊ú, ◊†◊ô◊î◊ï◊ú ◊ê◊™◊®◊ô◊ù ◊ë◊ô◊™◊ô◊ô◊ù",
                titleTextPlaceholder: "◊î◊õ◊†◊° ◊ò◊ß◊°◊ò ◊õ◊ï◊™◊®◊™...",
                // Delete buttons
                deleteCategoryBtn: "üóëÔ∏è",
                deleteServerBtn: "üóëÔ∏è",
                // Category types
                media: "◊û◊ì◊ô◊î",
                network: "◊®◊©◊™",
                storage: "◊ê◊ó◊°◊ï◊ü",
                services: "◊©◊ô◊®◊ï◊™◊ô◊ù",
                development: "◊§◊ô◊™◊ï◊ó",
                monitoring: "◊†◊ô◊ò◊ï◊®",
                security: "◊ê◊ë◊ò◊ó◊î",
                communication: "◊™◊ß◊©◊ï◊®◊™",
                productivity: "◊§◊®◊ï◊ì◊ï◊ß◊ò◊ô◊ë◊ô◊ï◊™",
                gaming: "◊û◊©◊ó◊ß◊ô◊ù",
                database: "◊û◊°◊ì ◊†◊™◊ï◊†◊ô◊ù",
                automation: "◊ê◊ï◊ò◊ï◊û◊¶◊ô◊î",
                // Alert messages
                changesNotSaved: "‚ö†Ô∏è ◊ñ◊ï◊î◊ï ◊©◊ô◊†◊ï◊ô◊ô◊ù! ◊©◊ô◊†◊ï◊ô◊ô◊ù ◊ê◊ú◊î ◊†◊©◊û◊®◊ô◊ù ◊ï◊¢◊ï◊ë◊ì◊ô◊ù ◊®◊ß ◊û◊ß◊ï◊û◊ô◊™. ◊ú◊í◊ô◊ë◊ï◊ô ◊î◊î◊í◊ì◊®◊ï◊™ ◊ú◊ß◊ï◊ë◊•, ◊†◊ô◊™◊ü ◊ú◊ú◊ó◊ï◊• <a href='#' onclick='exportConfig(); return false;' style='color: white; text-decoration: underline; font-weight: bold;'>◊õ◊ê◊ü</a>.",
                loadingFromFile: "üìÅ ◊ò◊ï◊¢◊ü ◊î◊í◊ì◊®◊ï◊™ ◊û◊ß◊ï◊ë◊•...",
                fileLoadFailed: "‚ùå ◊†◊õ◊©◊ú ◊ë◊ò◊¢◊ô◊†◊î ◊û◊ß◊ï◊ë◊•, ◊û◊©◊™◊û◊© ◊ë◊ê◊ó◊°◊ï◊ü ◊û◊ß◊ï◊û◊ô",
                fileLoadSuccess: "‚úÖ ◊î◊í◊ì◊®◊ï◊™ ◊†◊ò◊¢◊†◊ï ◊û◊ß◊ï◊ë◊• ◊ë◊î◊¶◊ú◊ó◊î",
                savingToFile: "üíæ ◊©◊ï◊û◊® ◊î◊í◊ì◊®◊ï◊™ ◊ú◊ß◊ï◊ë◊•...",
                fileSaveSuccess: "‚úÖ ◊î◊í◊ì◊®◊ï◊™ ◊†◊©◊û◊®◊ï ◊ú◊ß◊ï◊ë◊• ◊ë◊î◊¶◊ú◊ó◊î",
                fileSaveFailed: "‚ùå ◊†◊õ◊©◊ú ◊ë◊©◊û◊ô◊®◊î ◊ú◊ß◊ï◊ë◊•, ◊†◊©◊û◊® ◊ú◊ê◊ó◊°◊ï◊ü ◊û◊ß◊ï◊û◊ô ◊ë◊ú◊ë◊ì",
                // Drag and drop
                dragToReorderCategory: "◊í◊®◊ô◊®◊î ◊ú◊°◊ô◊ì◊ï◊® ◊û◊ó◊ì◊© ◊©◊ú ◊ß◊ò◊í◊ï◊®◊ô◊î",
                dragToReorderServer: "◊í◊®◊ô◊®◊î ◊ú◊°◊ô◊ì◊ï◊® ◊û◊ó◊ì◊© ◊©◊ú ◊ê◊™◊®",
                dragToReorderTitle: "◊í◊®◊ô◊®◊î ◊ú◊°◊ô◊ì◊ï◊® ◊û◊ó◊ì◊© ◊©◊ú ◊õ◊ï◊™◊®◊™",
                // Validation messages
                invalidUrl: "◊ô◊© ◊ú◊î◊õ◊†◊ô◊° ◊õ◊™◊ï◊ë◊™ URL ◊™◊ß◊ô◊†◊î (http:// ◊ê◊ï https://)",
                titleTooLong: "◊î◊õ◊ï◊™◊®◊™ ◊ê◊®◊ï◊õ◊î ◊û◊ì◊ô. ◊û◊ï◊™◊® ◊¢◊ì 100 ◊™◊ï◊ï◊ô◊ù.",
                subtitleTooLong: "◊õ◊ï◊™◊®◊™ ◊î◊û◊©◊†◊î ◊ê◊®◊ï◊õ◊î ◊û◊ì◊ô. ◊û◊ï◊™◊® ◊¢◊ì 200 ◊™◊ï◊ï◊ô◊ù.",
                serverNameRequired: "◊©◊ù ◊î◊ê◊™◊® ◊†◊ì◊®◊© ◊ï◊ó◊ô◊ô◊ë ◊ú◊î◊ô◊ï◊™ ◊§◊ó◊ï◊™ ◊û-50 ◊™◊ï◊ï◊ô◊ù.",
                titleTextRequired: "◊ò◊ß◊°◊ò ◊î◊õ◊ï◊™◊®◊™ ◊†◊ì◊®◊© ◊ï◊ó◊ô◊ô◊ë ◊ú◊î◊ô◊ï◊™ ◊§◊ó◊ï◊™ ◊û-50 ◊™◊ï◊ï◊ô◊ù.",
                invalidUrlFormat: "◊§◊ï◊®◊û◊ò ◊õ◊™◊ï◊ë◊™ URL ◊ú◊ê ◊™◊ß◊ô◊ü",
                categoryNameRequired: "◊©◊ù ◊î◊ß◊ò◊í◊ï◊®◊ô◊î ◊†◊ì◊®◊© ◊ï◊ó◊ô◊ô◊ë ◊ú◊î◊ô◊ï◊™ ◊§◊ó◊ï◊™ ◊û-50 ◊™◊ï◊ï◊ô◊ù.",
                invalidConfigFormat: "◊§◊ï◊®◊û◊ò ◊î◊í◊ì◊®◊ï◊™ ◊ú◊ê ◊™◊ß◊ô◊ü. ◊ô◊© ◊ú◊ë◊ì◊ï◊ß ◊ê◊™ ◊ß◊ï◊ë◊• ◊î-JSON ◊©◊ú◊ö.",
                // Protocol selection
                selectProtocol: "◊ë◊ó◊ô◊®◊™ ◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú",
                selectProtocolDesc: "◊ô◊© ◊ú◊ë◊ó◊ï◊® ◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú ◊¢◊ë◊ï◊® ◊î-URL ◊©◊ú◊ö:",
                protocolHttp: "HTTP",
                protocolHttpDesc: "◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú ◊ê◊ô◊†◊ò◊®◊†◊ò ◊°◊ò◊†◊ì◊®◊ò◊ô",
                protocolHttps: "HTTPS",
                protocolHttpsDesc: "◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú ◊ê◊ô◊†◊ò◊®◊†◊ò ◊û◊ê◊ï◊ë◊ò◊ó",
                protocolFtp: "FTP",
                protocolFtpDesc: "◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú ◊î◊¢◊ë◊®◊™ ◊ß◊ë◊¶◊ô◊ù",
                protocolSftp: "SFTP",
                protocolSftpDesc: "◊î◊¢◊ë◊®◊™ ◊ß◊ë◊¶◊ô◊ù ◊û◊ê◊ï◊ë◊ò◊ó◊™",
                protocolFile: "FILE",
                protocolFileDesc: "◊û◊¢◊®◊õ◊™ ◊ß◊ë◊¶◊ô◊ù ◊û◊ß◊ï◊û◊ô◊™",
                // URL popup
                copyUrl: "üìã ◊î◊¢◊™◊ß◊î",
                openUrl: "üîó ◊§◊™◊ô◊ó◊î",
                copiedUrl: "◊î◊ï◊¢◊™◊ß!",
                // Share functionality
                shareDashboard: "◊©◊ô◊™◊ï◊£ ◊î◊í◊ì◊®◊î",
                saveToLocal: "◊©◊û◊ô◊®◊î ◊ú◊ê◊ó◊°◊ï◊ü ◊û◊ß◊ï◊û◊ô",
                saveLocally: "◊©◊û◊ô◊®◊î ◊û◊ß◊ï◊û◊ô◊™",
                shareOptionsModalTitle: "◊©◊ô◊™◊ï◊£ ◊î◊í◊ì◊®◊ï◊™",
                shareOptionsModalText: "◊ë◊ó◊ô◊®◊î ◊õ◊ô◊¶◊ì ◊ú◊©◊™◊£ ◊ê◊™ ◊î◊î◊í◊ì◊®◊ï◊™ ◊î◊†◊ï◊õ◊ó◊ô◊ï◊™:",
                shareUrlLabel: "◊õ◊™◊ï◊ë◊™ ◊©◊ô◊™◊ï◊£:",
                saveConfiguration: "üíæ ◊©◊û◊ô◊®◊î ◊ú◊ß◊ï◊ë◊•",
                copyShareUrl: "◊î◊¢◊™◊ß◊™ ◊õ◊™◊ï◊ë◊™ ◊ô◊ó◊ï◊ì◊ô◊™",
                shareUrl: "üì§ ◊©◊ô◊™◊ï◊£ ◊õ◊™◊ï◊ë◊™ ◊ô◊ó◊ï◊ì◊ô◊™",
                savedToLocalSuccess: "‚úÖ ◊†◊©◊û◊® ◊ú◊ê◊ó◊°◊ï◊ü ◊û◊ß◊ï◊û◊ô ◊ë◊î◊¶◊ú◊ó◊î!",
                sharingWarning: "‚ö†Ô∏è ◊©◊ô◊™◊ï◊£ ◊î◊î◊í◊ì◊®◊ï◊™ ◊©◊ú◊ö ◊ô◊ó◊©◊ï◊£ ◊ê◊™ ◊î◊®◊©◊ô◊û◊î ◊©◊ú◊ö ◊ú◊ê◊ó◊®◊ô◊ù",
                shareErrorHttps: "‚ùå ◊ì◊§◊ì◊§◊ü ◊ñ◊î ◊™◊ï◊û◊ö ◊®◊ß ◊ë◊©◊ô◊™◊ï◊£ ◊§◊®◊ï◊ò◊ï◊ß◊ï◊ú ◊û◊ê◊ï◊ë◊ò◊ó ◊õ◊û◊ï HTTPS. ◊†◊ô◊™◊ü ◊ú◊î◊¢◊™◊ô◊ß ◊ê◊™ ◊î◊õ◊™◊ï◊ë◊™ ◊ï◊ú◊©◊ú◊ï◊ó ◊ê◊ï◊™◊î ◊ô◊ì◊†◊ô◊™ ◊ë◊û◊ß◊ï◊ù.",
                sharedModeWarning: "‚ö†Ô∏è ◊™◊¶◊ï◊í◊î ◊ñ◊ï ◊ñ◊û◊†◊ô◊™. ◊ê◊î◊ë◊™◊ù ◊ê◊ï◊™◊î? <a href='#' onclick='saveSharedDataToLocal(); return false;' style='color: white; text-decoration: underline; font-weight: bold;'>◊©◊û◊®◊ï ◊ê◊ï◊™◊î</a>; ◊ê◊ó◊®◊™, ◊§◊©◊ï◊ò ◊ú◊ó◊¶◊ï <a href='ORIGINAL_URL' style='color: white; text-decoration: underline; font-weight: bold;'>◊õ◊ê◊ü</a>.",
                close: "◊°◊í◊ô◊®◊î",
                deleteServer: "◊û◊ó◊ô◊ß◊™ ◊õ◊™◊ï◊ë◊™",
                deleteCategory: "◊û◊ó◊ô◊ß◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                deleteTitle: "◊û◊ó◊ô◊ß◊™ ◊õ◊ï◊™◊®◊™",
                // Mobile menu translations

                mobileImportConfig: "◊ô◊ë◊ï◊ê ◊î◊í◊ì◊®◊ï◊™",
                mobileAddCategory: "◊î◊ï◊°◊§◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î",
                mobileToggleEditMode: "◊¢◊®◊ô◊õ◊î",
                mobileShareConfiguration: "◊©◊ô◊™◊ï◊£ ◊î◊í◊ì◊®◊ï◊™",
                mobileToggleLanguage: "◊î◊ó◊ú◊§◊™ ◊©◊§◊î",
                mobileToggleDarkMode: "◊û◊¶◊ë ◊õ◊î◊î / ◊ë◊î◊ô◊®",
                mobileActions: "◊§◊¢◊ï◊ú◊ï◊™",
                mobileSettings: "◊î◊í◊ì◊®◊ï◊™",
                mobileSearchPlaceholder: "◊°◊ô◊†◊ï◊ü...",
                mobileMenuTitle: "◊™◊§◊®◊ô◊ò",
                mobileHelp: "◊¢◊ñ◊®◊î",
                desktopServerStatusCheck: "◊ë◊ì◊ô◊ß◊™ ◊°◊ò◊ò◊ï◊° ◊©◊®◊™◊ô◊ù",
                mobileServerStatusCheck: "◊ë◊ì◊ô◊ß◊™ ◊°◊ò◊ò◊ï◊° ◊©◊®◊™◊ô◊ù",
                showWebsitesStatus: "◊î◊§◊¢◊ú◊™ ◊ë◊ì◊ô◊ß◊ï◊™ ◊ê◊™◊®◊ô◊ù",
                disableWebsiteCheck: "◊ë◊ô◊ò◊ï◊ú ◊ë◊ì◊ô◊ß◊ï◊™ ◊ê◊™◊®◊ô◊ù",
                serverStatusCheckTooltip: "◊ë◊ì◊ô◊ß◊™ ◊°◊ò◊ò◊ï◊° ◊î◊ê◊™◊®◊ô◊ù ◊ë◊¢◊™ ◊ò◊¢◊ô◊†◊™ ◊î◊ì◊£",
                // Social Media Editor
                editSocialMedia: "◊¢◊®◊ô◊õ◊™ ◊®◊©◊™◊ï◊™ ◊ó◊ë◊®◊™◊ô◊ï◊™",
                socialMediaName: "◊©◊ù ◊î◊®◊©◊™ ◊î◊ó◊ë◊®◊™◊ô◊™",
                url: "◊õ◊™◊ï◊ë◊™ URL",
                svgCode: "◊ß◊ï◊ì SVG ◊ú◊ú◊ï◊í◊ï",
                findSvgLogos: "◊û◊¶◊ô◊ê◊™ ◊ú◊ï◊í◊ï◊ê◊ô◊ù SVG ◊ë:",
                dragToReorder: "◊í◊®◊ô◊®◊î ◊ú◊°◊ô◊ì◊ï◊® ◊û◊ó◊ì◊©",
                remove: "◊î◊°◊®",
                addSocialMedia: "◊î◊ï◊°◊§◊™ ◊®◊©◊™ ◊ó◊ë◊®◊™◊ô◊™",
                saveChanges: "◊©◊û◊ô◊®◊™ ◊©◊ô◊†◊ï◊ô◊ô◊ù",
                cancel: "◊ë◊ô◊ò◊ï◊ú",
                atLeastOneLink: "◊ó◊ô◊ô◊ë ◊ú◊î◊ô◊ï◊™ ◊ú◊§◊ó◊ï◊™ ◊ß◊ô◊©◊ï◊® ◊ê◊ó◊ì",
                newSocialMedia: "◊®◊©◊™ ◊ó◊ë◊®◊™◊ô◊™ ◊ó◊ì◊©◊î",
                showMostUsedWebsites: "◊î◊¶◊í◊™ ◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù",
                hideMostUsedWebsites: "◊î◊°◊™◊®◊™ ◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù",
                mostUsedWebsitesTooltip: "◊î◊¶◊í ◊ß◊ò◊í◊ï◊®◊ô◊î ◊¢◊ù ◊î◊ê◊™◊®◊ô◊ù ◊©◊ë◊ô◊ß◊®◊™ ◊ë◊î◊ù ◊î◊õ◊ô ◊î◊®◊ë◊î",
                mostRecentWebsites: "◊ë◊©◊ô◊û◊ï◊© ◊ú◊ê◊ó◊®◊ï◊†◊î",
                mostPopularWebsites: "◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù",
                openLinksInNewTab: "◊§◊™◊ô◊ó◊™ ◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ë◊ò◊ê◊ë ◊ó◊ì◊©",
                openLinksInSameTab: "◊§◊™◊ô◊ó◊™ ◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ë◊ê◊ï◊™◊ï ◊ò◊ê◊ë",
                openLinksInNewTabTooltip: "◊î◊ó◊ú◊£ ◊ë◊ô◊ü ◊§◊™◊ô◊ó◊™ ◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ë◊ò◊ê◊ë ◊ó◊ì◊© ◊ê◊ï ◊ë◊ê◊ï◊™◊ï ◊ò◊ê◊ë"
            }
        };

        // Get translation
        function t(key) {
            return translations[currentLanguage][key] || translations.en[key] || key;
        }
        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'he' ? 'rtl' : 'ltr';
            
            updateTexts();
            updateDesktopMenuLanguage();
            updateMobileMenuLanguage();
            renderCategories();
            localStorage.setItem('dashboardLanguage', lang);
        }

        // Toggle desktop menu
        function toggleDesktopMenu() {
            const menu = document.getElementById('desktopMenu');
            if (menu) {
                // Set direction based on current language
                menu.setAttribute('dir', currentLanguage === 'he' ? 'rtl' : 'ltr');
                
                menu.classList.toggle('show');
                if (menu.classList.contains('show')) {
                    loadDesktopSettings();
                    // Add click outside listener when menu opens
                    setTimeout(() => {
                        document.addEventListener('click', handleDesktopMenuClickOutside);
                        document.addEventListener('mousedown', handleDesktopMenuMouseDown);
                    }, 0);
                } else {
                    // Remove click outside listener when menu closes
                    document.removeEventListener('click', handleDesktopMenuClickOutside);
                    document.removeEventListener('mousedown', handleDesktopMenuMouseDown);
                }
                updateDesktopMenuLanguage();
            }
        }

        // Track mouse state for desktop menu
        let desktopMenuMouseDownInside = false;

        // Handle mouse down inside desktop menu
        function handleDesktopMenuMouseDown(event) {
            const menu = document.getElementById('desktopMenu');
            if (menu && menu.contains(event.target)) {
                desktopMenuMouseDownInside = true;
            }
        }

        // Handle clicks outside the desktop menu
        function handleDesktopMenuClickOutside(event) {
            const menu = document.getElementById('desktopMenu');
            const settingsButton = document.querySelector('.header-icon-btn[onclick*="toggleDesktopMenu"]');
            
            // Only close if mouse wasn't pressed inside the menu
            if (menu && !menu.contains(event.target) && !settingsButton.contains(event.target) && !desktopMenuMouseDownInside) {
                menu.classList.remove('show');
                document.removeEventListener('click', handleDesktopMenuClickOutside);
                document.removeEventListener('mousedown', handleDesktopMenuMouseDown);
            }
            
            // Reset the flag
            desktopMenuMouseDownInside = false;
        }

        // Load current settings into desktop menu
        function loadDesktopSettings() {
            const analyticsCode = localStorage.getItem('googleAnalyticsCode') || '';
            
            document.getElementById('desktopGoogleAnalyticsCode').value = analyticsCode;
            updateGoogleAnalyticsClearButton();
            updateGoogleAnalyticsInputFields();
            
            // Update menu language items
            const mostUsedWebsitesEnabled = localStorage.getItem('mostUsedWebsitesEnabled') !== 'false';
            const openLinksInNewTab = localStorage.getItem('openLinksInNewTab') !== 'false';
            updateMostUsedWebsitesToggle(mostUsedWebsitesEnabled);
            updateOpenLinksInNewTabToggle(openLinksInNewTab);
        }

        // Load current settings into mobile menu
        function loadMobileSettings() {
            const analyticsCode = localStorage.getItem('googleAnalyticsCode') || '';
            
            const mobileInput = document.getElementById('mobileGoogleAnalyticsCode');
            if (mobileInput) {
                mobileInput.value = analyticsCode;
                updateMobileGoogleAnalyticsClearButton();
            }
            updateGoogleAnalyticsInputFields();
            
            // Update menu language items
            const mostUsedWebsitesEnabled = localStorage.getItem('mostUsedWebsitesEnabled') !== 'false';
            const openLinksInNewTab = localStorage.getItem('openLinksInNewTab') !== 'false';
            updateMostUsedWebsitesToggle(mostUsedWebsitesEnabled);
            updateOpenLinksInNewTabToggle(openLinksInNewTab);
        }
        // Toggle social media bar from mobile menu
        function toggleMobileSocialMedia() {
            const currentState = localStorage.getItem('showSocialMediaBar') === 'true';
            const newState = !currentState;
            
            // Apply the change immediately
            updateSocialMediaBarVisibility(newState);
            
            // Save to localStorage immediately
            localStorage.setItem('showSocialMediaBar', newState ? 'true' : 'false');
            
            // Update the menu text and icon
            updateMobileMenuLanguage();
            
            // Update icon styling
            updateSocialMediaIconToggle(newState);
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show immediate feedback
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = newState ? 
                    (currentLanguage === 'he' ? '◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü ◊û◊ï◊¶◊í' : 'Bottom bar shown') :
                    (currentLanguage === 'he' ? '◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü ◊û◊ï◊°◊™◊®' : 'Bottom bar hidden');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                // Auto-hide notification after 2 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        // Toggle social media bar from desktop menu
        function toggleDesktopSocialMedia() {
            const currentState = localStorage.getItem('showSocialMediaBar') === 'true';
            const newState = !currentState;
            
            // Apply the change immediately
            updateSocialMediaBarVisibility(newState);
            
            // Save to localStorage immediately
            localStorage.setItem('showSocialMediaBar', newState ? 'true' : 'false');
            
            // Update the menu text and icon
            updateDesktopMenuLanguage();
            
            // Update icon styling
            updateSocialMediaIconToggle(newState);
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show immediate feedback
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = newState ? 
                    (currentLanguage === 'he' ? '◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü ◊û◊ï◊¶◊í' : 'Bottom bar shown') :
                    (currentLanguage === 'he' ? '◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü ◊û◊ï◊°◊™◊®' : 'Bottom bar hidden');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                // Auto-hide notification after 2 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        // Update mobile Google Analytics clear button visibility and position
        function updateMobileGoogleAnalyticsClearButton() {
            updateGoogleAnalyticsClearButton(true);
        }

        // Unified Google Analytics functions that accept a parameter to determine mobile vs desktop behavior
        
        // Unified validate and save Google Analytics code
        function validateAndSaveGoogleAnalyticsUnified(isMobile = false) {
            const inputId = isMobile ? 'mobileGoogleAnalyticsCode' : 'desktopGoogleAnalyticsCode';
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            // Check if input is masked (showing asterisks)
            const isMasked = input.getAttribute('data-masked') === 'true';
            if (isMasked) {
                // If masked, don't validate - just update the display
                updateGoogleAnalyticsInputFields();
                return;
            }
            
            // Allow empty value (to disable GA)
            if (value === '') {
                saveGoogleAnalyticsImmediately();
                return;
            }
            
            // Validate Google Analytics format
            const ga4Pattern = /^G-[A-Z0-9]{10}$/;  // G-XXXXXXXXXX format
            const uaPattern = /^UA-\d{4,}-\d{1,2}$/; // UA-XXXXXX-X format
            
            if (ga4Pattern.test(value) || uaPattern.test(value)) {
                // Valid format - save it
                saveGoogleAnalyticsImmediately();
                
                // Update the other input to stay synchronized
                const otherInputId = isMobile ? 'desktopGoogleAnalyticsCode' : 'mobileGoogleAnalyticsCode';
                const otherInput = document.getElementById(otherInputId);
                if (otherInput) {
                    otherInput.value = value;
                }
                
                input.style.borderColor = 'var(--success-color, #22c55e)';
                input.style.boxShadow = '0 0 0 1px var(--success-color, #22c55e)';
            } else {
                // Invalid format - revert to last valid value
                const lastValidValue = localStorage.getItem('googleAnalyticsCode') || '';
                input.value = lastValidValue;
                input.style.borderColor = 'var(--error-color, #ef4444)';
                input.style.boxShadow = '0 0 0 1px var(--error-color, #ef4444)';
                
                // Close both mobile and desktop menus so the user can see the alert
                closeAllMenus();
                
                // Show error notification
                const notification = document.getElementById('changesNotification');
                if (notification) {
                    const message = currentLanguage === 'he' ? 
                        '◊§◊ï◊®◊û◊ò ◊ú◊ê ◊™◊ß◊ô◊ü. ◊†◊ô◊™◊ü ◊ú◊î◊©◊™◊û◊© ◊ë-G-XXXXXXXXXX ◊ê◊ï UA-XXXXXX-X' : 
                        'Invalid format. Use G-XXXXXXXXXX or UA-XXXXXX-X';
                    
                    notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                    notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    notification.style.color = 'white';
                    notification.style.borderColor = '#ef4444';
                    notification.classList.add('show');
                    
                    // Auto-hide error notification after 3 seconds
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                }
                
                // Reset border color after 2 seconds
                setTimeout(() => {
                    input.style.borderColor = '';
                    input.style.boxShadow = '';
                }, 2000);
            }
        }

        // Unified clear Google Analytics input
        function clearGoogleAnalyticsInputUnified(isMobile = false) {
            const inputId = isMobile ? 'mobileGoogleAnalyticsCode' : 'desktopGoogleAnalyticsCode';
            const input = document.getElementById(inputId);
            if (input) {
                // Check if input is masked (showing asterisks)
                const isMasked = input.getAttribute('data-masked') === 'true';
                
                // Clear the input
                input.value = '';
                input.style.borderColor = '';
                input.style.boxShadow = '';
                
                // Remove masked attribute
                input.removeAttribute('data-masked');
                
                // Clear localStorage and disable Google Analytics
                localStorage.setItem('googleAnalyticsCode', '');
                updateGoogleAnalytics('');
                
                // Update clear button
                updateGoogleAnalyticsClearButtonUnified(isMobile);
                
                // Also clear the other input to stay synchronized
                const otherInputId = isMobile ? 'desktopGoogleAnalyticsCode' : 'mobileGoogleAnalyticsCode';
                const otherInput = document.getElementById(otherInputId);
                if (otherInput) {
                    otherInput.value = '';
                    otherInput.removeAttribute('data-masked');
                }
                
                // Update all input fields to ensure proper masking state
                updateGoogleAnalyticsInputFields();
                
                // Close both mobile and desktop menus so the user can see the notification
                closeAllMenus();
                
                // Show notification that Google Analytics was disabled
                const notification = document.getElementById('changesNotification');
                if (notification) {
                    const message = currentLanguage === 'he' ? 
                        'Google Analytics ◊î◊ï◊©◊ë◊™' : 
                        'Google Analytics disabled';
                    
                    notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                    notification.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                    notification.style.color = 'white';
                    notification.style.borderColor = '#6b7280';
                    notification.classList.add('show');
                    
                    // Auto-hide notification after 2 seconds
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 2000);
                }
            }
        }

        // Unified paste Google Analytics code from clipboard
        async function pasteGoogleAnalyticsCodeUnified(isMobile = false) {
            try {
                const text = await navigator.clipboard.readText();
                const inputId = isMobile ? 'mobileGoogleAnalyticsCode' : 'desktopGoogleAnalyticsCode';
                const input = document.getElementById(inputId);
                if (input) {
                    input.value = text.trim();
                    validateAndSaveGoogleAnalyticsUnified(isMobile);
                    updateGoogleAnalyticsClearButtonUnified(isMobile);
                }
            } catch (err) {
                // Fallback for browsers that don't support clipboard API
                const inputId = isMobile ? 'mobileGoogleAnalyticsCode' : 'desktopGoogleAnalyticsCode';
                const input = document.getElementById(inputId);
                if (input) {
                    input.focus();
                    // Close both mobile and desktop menus so the user can see the alert
                    closeAllMenus();
                    
                    // Show a notification to use Ctrl+V
                    const notification = document.getElementById('changesNotification');
                    if (notification) {
                        const message = currentLanguage === 'he' ? 
                            '◊†◊ô◊™◊ü ◊ú◊î◊©◊™◊û◊© ◊ë-Ctrl+V ◊ú◊î◊ì◊ë◊ß◊™ ◊ß◊ï◊ì Google Analytics' : 
                            'Use Ctrl+V to paste';
                        
                        notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                        notification.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
                        notification.style.color = 'white';
                        notification.style.borderColor = '#3b82f6';
                        notification.classList.add('show');
                        
                        setTimeout(() => {
                            notification.classList.remove('show');
                        }, 2000);
                    }
                }
            }
        }

        // Unified update Google Analytics clear button visibility and position
        function updateGoogleAnalyticsClearButtonUnified(isMobile = false) {
            const inputId = isMobile ? 'mobileGoogleAnalyticsCode' : 'desktopGoogleAnalyticsCode';
            const clearBtnId = isMobile ? 'mobileGoogleAnalyticsClear' : 'desktopGoogleAnalyticsClear';
            const pasteBtnId = isMobile ? 'mobileGoogleAnalyticsPaste' : 'desktopGoogleAnalyticsPaste';
            
            const input = document.getElementById(inputId);
            const clearBtn = document.getElementById(clearBtnId);
            const pasteBtn = document.getElementById(pasteBtnId);
            
            if (input && clearBtn && pasteBtn) {
                const hasContent = input.value.trim() !== '';
                
                // Show/hide buttons based on content
                clearBtn.style.display = hasContent ? 'flex' : 'none';
                pasteBtn.style.display = hasContent ? 'none' : 'flex';
                
                // Set height and width to match input
                clearBtn.style.height = 'calc(2.5rem + 2px)';
                clearBtn.style.width = '2.5rem';
                pasteBtn.style.height = 'calc(2.5rem + 2px)';
                pasteBtn.style.width = '2.5rem';
                clearBtn.style.fontSize = '1.1rem';
                pasteBtn.style.fontSize = '1rem';
                clearBtn.style.padding = '0';
                pasteBtn.style.padding = '0';
                clearBtn.style.top = '0px';
                pasteBtn.style.top = '0px';
                clearBtn.style.transform = 'none';
                pasteBtn.style.transform = 'none';
                clearBtn.style.display = hasContent ? 'flex' : 'none';
                pasteBtn.style.display = hasContent ? 'none' : 'flex';
                clearBtn.style.alignItems = 'center';
                clearBtn.style.justifyContent = 'center';
                pasteBtn.style.alignItems = 'center';
                pasteBtn.style.justifyContent = 'center';
                clearBtn.style.background = '#6b7280';
                pasteBtn.style.background = '#6b7280';
                clearBtn.style.color = 'white';
                pasteBtn.style.color = 'white';
                clearBtn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                pasteBtn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                clearBtn.style.border = 'none';
                pasteBtn.style.border = 'none';
                clearBtn.style.position = 'absolute';
                pasteBtn.style.position = 'absolute';
                // Position and border-radius based on language direction
                if (currentLanguage === 'he') {
                    clearBtn.style.left = '0';
                    clearBtn.style.right = 'auto';
                    pasteBtn.style.left = '0';
                    pasteBtn.style.right = 'auto';
                    clearBtn.style.borderRadius = '.5rem 0 0 .5rem';
                    pasteBtn.style.borderRadius = '.5rem 0 0 .5rem';
                    input.style.paddingLeft = '2.5rem';
                    input.style.paddingRight = '0.5rem';
                } else {
                    clearBtn.style.right = '0';
                    clearBtn.style.left = 'auto';
                    pasteBtn.style.right = '0';
                    pasteBtn.style.left = 'auto';
                    clearBtn.style.borderRadius = '0 .5rem .5rem 0';
                    pasteBtn.style.borderRadius = '0 .5rem .5rem 0';
                    input.style.paddingRight = '2.5rem';
                    input.style.paddingLeft = '0.5rem';
                }
                // Always set tooltips in the correct language
                clearBtn.title = currentLanguage === 'he' ? '◊†◊ô◊ß◊ï◊ô ◊ß◊ï◊ì Google Analytics' : 'Clear Google Analytics code';
                pasteBtn.title = currentLanguage === 'he' ? '◊î◊ì◊ë◊ß◊™ ◊ß◊ï◊ì Google Analytics' : 'Paste Google Analytics code';
            }
        }

        // Legacy wrapper functions for backward compatibility
        function validateAndSaveGoogleAnalyticsMobile() {
            validateAndSaveGoogleAnalyticsUnified(true);
        }

        function validateAndSaveGoogleAnalyticsDesktop() {
            validateAndSaveGoogleAnalyticsUnified(false);
        }

        function clearGoogleAnalyticsInputMobile() {
            clearGoogleAnalyticsInputUnified(true);
        }

        function clearGoogleAnalyticsInputDesktop() {
            clearGoogleAnalyticsInputUnified(false);
        }

        function pasteGoogleAnalyticsCodeMobile() {
            pasteGoogleAnalyticsCodeUnified(true);
        }

        function pasteGoogleAnalyticsCodeDesktop() {
            pasteGoogleAnalyticsCodeUnified(false);
        }

        function updateMobileGoogleAnalyticsClearButton() {
            updateGoogleAnalyticsClearButtonUnified(true);
        }

        function updateGoogleAnalyticsClearButtonDesktop() {
            updateGoogleAnalyticsClearButtonUnified(false);
        }

        // Validate and save Google Analytics code for mobile
        function validateAndSaveGoogleAnalyticsMobile() {
            validateAndSaveGoogleAnalytics(true);
        }

        // Clear Google Analytics input for mobile
        function clearGoogleAnalyticsInputMobile() {
            clearGoogleAnalyticsInput(true);
        }

        // Paste Google Analytics code from clipboard for mobile
        async function pasteGoogleAnalyticsCodeMobile() {
            pasteGoogleAnalyticsCode(true);
        }

        // Update Google Analytics clear button visibility and position
        function updateGoogleAnalyticsClearButton() {
            updateGoogleAnalyticsClearButtonUnified(false);
        }
        // Paste Google Analytics code from clipboard
        async function pasteGoogleAnalyticsCode() {
            pasteGoogleAnalyticsCodeUnified(false);
        }
        // Clear Google Analytics input
        function clearGoogleAnalyticsInput() {
            clearGoogleAnalyticsInputUnified(false);
        }
        // Validate and save Google Analytics code
        function validateAndSaveGoogleAnalytics() {
            validateAndSaveGoogleAnalyticsUnified(false);
        }

        // Save Google Analytics code immediately when input changes
        function saveGoogleAnalyticsImmediately() {
            // Get the analytics code from the active input (desktop or mobile)
            let analyticsCode = '';
            const desktopInput = document.getElementById('desktopGoogleAnalyticsCode');
            const mobileInput = document.getElementById('mobileGoogleAnalyticsCode');
            
            // Check which input has focus or was recently used
            if (document.activeElement === mobileInput) {
                analyticsCode = mobileInput.value.trim();
            } else {
                analyticsCode = desktopInput.value.trim();
            }
            
            // Save to localStorage
            localStorage.setItem('googleAnalyticsCode', analyticsCode);
            
            // Update Google Analytics immediately
            updateGoogleAnalytics(analyticsCode);
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show a subtle notification that it was saved
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = analyticsCode ? 
                    (currentLanguage === 'he' ? 'Google Analytics ◊î◊ï◊§◊¢◊ú' : 'Google Analytics enabled') :
                    (currentLanguage === 'he' ? 'Google Analytics ◊î◊ï◊©◊ë◊™' : 'Google Analytics disabled');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
                notification.style.color = 'white';
                notification.style.borderColor = '#3b82f6';
                notification.classList.add('show');
                
                // Auto-hide notification after 2 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        // Save desktop settings
        function saveDesktopSettings() {
            // Google Analytics is now saved immediately, so we only need to handle other settings
            // This function is kept for potential future settings that need manual save
            
            // Close desktop menu
            toggleDesktopMenu();
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show success notification
            const notification = document.getElementById('changesNotification');
            if (notification) {
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + (currentLanguage === 'he' ? '◊î◊í◊ì◊®◊ï◊™ ◊†◊©◊û◊®◊ï ◊ë◊î◊¶◊ú◊ó◊î' : 'Settings saved successfully');
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                // Auto-hide success notification after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }



        // Unified menu language update function
        function updateMenuLanguage(menuType = 'mobile') {
            const prefix = menuType === 'mobile' ? 'mobile' : 'desktop';
            
            // Update section titles
            const actionsTitle = document.getElementById(`${prefix}ActionsTitle`);
            if (actionsTitle) actionsTitle.textContent = t('mobileActions');
            
            const settingsTitle = document.getElementById(`${prefix}SettingsTitle`);
            if (settingsTitle) {
                if (menuType === 'desktop') {
                    settingsTitle.textContent = currentLanguage === 'he' ? '◊™◊¶◊ï◊í◊î' : 'Display';
                } else {
                    settingsTitle.textContent = t('mobileSettings');
                }
            }
            
            const analyticsTitle = document.getElementById(`${prefix}AnalyticsTitle`);
            if (analyticsTitle) analyticsTitle.textContent = currentLanguage === 'he' ? '◊ê◊†◊ú◊ô◊ò◊ô◊ß◊°' : 'Analytics';
            
            // Desktop-specific display title
            if (menuType === 'desktop') {
                const displayTitle = document.getElementById(`${prefix}DisplayTitle`);
                if (displayTitle) displayTitle.textContent = currentLanguage === 'he' ? '◊™◊¶◊ï◊í◊î' : 'Display';
            }
            
            // Update menu items
            const importConfig = document.getElementById(`${prefix}ImportConfig`);
            if (importConfig) importConfig.textContent = t('importConfig');
            
            // Mobile-specific add category
            if (menuType === 'mobile') {
                const addCategory = document.getElementById(`${prefix}AddCategory`);
                if (addCategory) addCategory.textContent = t('mobileAddCategory');
            }
            
            const toggleEditMode = document.getElementById(`${prefix}ToggleEditMode`);
            if (toggleEditMode) toggleEditMode.textContent = t('toggleEditMode');
            
            const shareConfiguration = document.getElementById(`${prefix}ShareConfiguration`);
            if (shareConfiguration) shareConfiguration.textContent = t('shareDashboard');
            
            const resetAll = document.getElementById(`${prefix}ResetAll`);
            if (resetAll) resetAll.textContent = currentLanguage === 'he' ? '◊ê◊ô◊§◊ï◊° ◊õ◊ú ◊î◊î◊í◊ì◊®◊ï◊™' : 'Reset All';
            
            const toggleLanguage = document.getElementById(`${prefix}ToggleLanguage`);
            if (toggleLanguage) toggleLanguage.textContent = currentLanguage === 'en' ? '◊¢◊ë◊®◊ô◊™' : 'English';
            
            const toggleDarkMode = document.getElementById(`${prefix}ToggleDarkMode`);
            if (toggleDarkMode) toggleDarkMode.textContent = currentTheme === 'light' ? 
                (currentLanguage === 'he' ? '◊û◊¶◊ë ◊õ◊î◊î' : 'Dark Mode') : 
                (currentLanguage === 'he' ? '◊û◊¶◊ë ◊ë◊î◊ô◊®' : 'Light Mode');
            
            const darkModeIcon = document.getElementById(`${prefix}DarkModeIcon`);
            if (darkModeIcon) darkModeIcon.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            
            const help = document.getElementById(`${prefix}Help`);
            if (help) help.textContent = t('mobileHelp');
            
            const serverStatusCheck = document.getElementById(`${prefix}ServerStatusCheck`);
            const serverStatusCheckItem = document.getElementById(`${prefix}ServerStatusCheckItem`);
            if (serverStatusCheck) {
                const isEnabled = localStorage.getItem('serverStatusCheckEnabled') !== 'false';
                serverStatusCheck.textContent = isEnabled ? t('disableWebsiteCheck') : t('showWebsitesStatus');
            }
            if (serverStatusCheckItem) {
                serverStatusCheckItem.title = t('serverStatusCheckTooltip');
            }
            
            // Update social media toggle
            const showSocialMediaLabel = document.getElementById(`${prefix}ShowSocialMediaLabel`);
            if (showSocialMediaLabel) {
                const isVisible = localStorage.getItem('showSocialMediaBar') === 'true';
                showSocialMediaLabel.textContent = isVisible ? 
                    (currentLanguage === 'he' ? '◊î◊°◊™◊®◊™ ◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü' : 'Hide Bottom Bar') :
                    (currentLanguage === 'he' ? '◊î◊¶◊í◊™ ◊°◊®◊í◊ú ◊™◊ó◊™◊ï◊ü' : 'Show Bottom Bar');
            }
            
            const socialMediaIcon = document.getElementById(`${prefix}SocialMediaIcon`);
            if (socialMediaIcon) {
                const isVisible = localStorage.getItem('showSocialMediaBar') === 'true';
                socialMediaIcon.textContent = isVisible ? '‚¨áÔ∏è' : '‚¨ÜÔ∏è';
            }
            
            // Update analytics section
            const googleAnalyticsLabel = document.getElementById(`${prefix}GoogleAnalyticsLabel`);
            if (googleAnalyticsLabel) googleAnalyticsLabel.textContent = currentLanguage === 'he' ? '◊ß◊ï◊ì Google Analytics:' : 'Google Analytics Code:';
            
            const settingsSectionTitle = document.getElementById(`${prefix}SettingsSectionTitle`);
            if (settingsSectionTitle) settingsSectionTitle.textContent = currentLanguage === 'he' ? '◊î◊í◊ì◊®◊ï◊™' : 'Settings';
            
            const googleAnalyticsInput = document.getElementById(`${prefix}GoogleAnalyticsCode`);
            if (googleAnalyticsInput) googleAnalyticsInput.placeholder = currentLanguage === 'he' ? 'G-XXXXXXXXXX ◊ê◊ï UA-XXXXXXXX-X' : 'G-XXXXXXXXXX or UA-XXXXXXXX-X';
            
            // Update Google Analytics button tooltips
            const clearBtn = document.getElementById(`${prefix}GoogleAnalyticsClearBtn`);
            if (clearBtn) clearBtn.title = currentLanguage === 'he' ? '◊†◊ô◊ß◊ï◊ô ◊ß◊ï◊ì Google Analytics' : 'Clear Google Analytics code';
            
            const pasteBtn = document.getElementById(`${prefix}GoogleAnalyticsPasteBtn`);
            if (pasteBtn) pasteBtn.title = currentLanguage === 'he' ? '◊î◊ì◊ë◊ß◊™ ◊ß◊ï◊ì Google Analytics' : 'Paste Google Analytics code';
            
            // Desktop-specific help text
            if (menuType === 'desktop') {
                const googleAnalyticsHelp = document.getElementById(`${prefix}GoogleAnalyticsHelp`);
                if (googleAnalyticsHelp) googleAnalyticsHelp.textContent = currentLanguage === 'he' ? 
                    '◊î◊ñ◊ü ◊ê◊™ ◊ß◊ï◊ì ◊î◊û◊¢◊ß◊ë ◊©◊ú Google Analytics. ◊î◊©◊ô◊†◊ï◊ô◊ô◊ù ◊†◊©◊û◊®◊ô◊ù ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™.' : 
                    'Enter your Google Analytics tracking code. Changes are saved automatically.';
                
                const showSocialMediaHelp = document.getElementById(`${prefix}ShowSocialMediaHelp`);
                if (showSocialMediaHelp) showSocialMediaHelp.textContent = currentLanguage === 'he' ? 
                    '◊î◊ó◊ú◊£ ◊ê◊™ ◊î◊†◊®◊ê◊ï◊™ ◊©◊ú ◊õ◊§◊™◊ï◊®◊ô ◊î◊®◊©◊™◊ï◊™ ◊î◊ó◊ë◊®◊™◊ô◊ï◊™ ◊ë◊™◊ó◊™◊ô◊™ ◊î◊ì◊£.' : 
                    'Toggle the visibility of the social media buttons at the bottom of the page.';
                
                // Update menu title
                const menuTitle = document.getElementById(`${prefix}MenuTitle`);
                if (menuTitle) menuTitle.textContent = t('mobileSettings');
            }
            
            // Update Most Used Websites toggle
            const mostUsedWebsitesEnabled = localStorage.getItem('mostUsedWebsitesEnabled') !== 'false';
            updateMostUsedWebsitesToggle(mostUsedWebsitesEnabled);
            
            // Update Open Links in New Tab toggle
            const openLinksInNewTab = localStorage.getItem('openLinksInNewTab') !== 'false';
            updateOpenLinksInNewTabToggle(openLinksInNewTab);
        }
        
        // Legacy wrapper functions for backward compatibility
        function updateMobileMenuLanguage() {
            updateMenuLanguage('mobile');
        }
        
        function updateDesktopMenuLanguage() {
            updateMenuLanguage('desktop');
        }
        // Update UI texts
        function updateTexts() {
            const h1 = document.querySelector('.header h1');
            const p = document.querySelector('.header p');
            const container = document.querySelector('.container');
            const isEditMode = container.classList.contains('edit-mode');
            
            // Clear existing content
            h1.innerHTML = '';
            p.innerHTML = '';
            
            // Get header icon
            const headerIcon = localStorage.getItem('headerIcon') || 'üè†';
            
            // Update text content with conditional edit buttons
            if (isEditMode) {
                // Use textContent for security with icon
                h1.textContent = headerIcon + ' ' + headerTitle;
                p.textContent = headerSubtitle;
                
                // Add edit button safely
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-ghost btn-small edit-btn';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.onclick = function(e) {
                    e.stopPropagation();
                    showEditHeaderModal();
                };
                editBtn.title = t('editHeader');
                
                h1.appendChild(editBtn);
                
                // Make header clickable in edit mode
                h1.onclick = function() { showEditHeaderModal(); };
                h1.title = t('clickToEdit');
                p.onclick = function() { showEditHeaderModal(); };
                p.title = t('clickToEdit');
            } else {
                // Make header title a link to the page itself in view mode
                h1.innerHTML = `<a href="${window.location.href}" style="text-decoration: none; color: inherit;">${headerIcon} ${headerTitle}</a>`;
                p.textContent = headerSubtitle;
                // Remove click handlers in view mode
                h1.onclick = null;
                p.onclick = null;
            }
            
            // Update modal directions based on language
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.setAttribute('dir', currentLanguage === 'he' ? 'rtl' : 'ltr');
            });
            
            // Apply saved colors
            const titleColor = localStorage.getItem('headerTitleColor') || '#3b82f6';
            const subtitleColor = localStorage.getItem('headerSubtitleColor') || '#6b7280';
            h1.style.color = titleColor;
            p.style.color = subtitleColor;
            
            // Update page title to match header title
            document.title = headerTitle;
            
            // Update tooltips with null checks
            const searchClearBtn = document.getElementById('searchClearBtn');
            if (searchClearBtn) searchClearBtn.title = t('clearSearch');
            
            
            

            
            const importBtn = document.querySelector('.header-icon-btn[onclick*="importFile"]');
            if (importBtn) importBtn.title = t('importConfigTooltip');
            
            const editModeBtn = document.getElementById('editModeToggle');
            if (editModeBtn) editModeBtn.title = t('toggleEditMode');
            
            const shareBtn = document.getElementById('shareBtn');
            if (shareBtn) shareBtn.title = t('shareDashboard');
            
            // Update protocol selection modal texts
            const protocolModalTitle = document.getElementById('protocolModalTitle');
            if (protocolModalTitle) protocolModalTitle.textContent = t('selectProtocol');
            
            const protocolModalDesc = document.getElementById('protocolModalDesc');
            if (protocolModalDesc) protocolModalDesc.textContent = t('selectProtocolDesc');
            
            // Update protocol option texts
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                
            // Update mobile menu texts
            updateMobileMenuLanguage();
            
            // Update desktop menu texts
            updateDesktopMenuLanguage();
                if (key) {
                    element.textContent = t(key);
                }
            });
            
            const langBtn = document.querySelector('.lang-toggle-btn');
            if (langBtn) langBtn.title = t('toggleLanguage');
            
            const darkModeBtn = document.querySelector('.dark-mode-toggle');
            if (darkModeBtn) darkModeBtn.title = t('toggleDarkMode');
            
            // Update language icon
            updateLanguageIcon();
            
            // Update placeholders
            const filterInput = document.getElementById('filterInput');
            if (filterInput) filterInput.placeholder = t('filterPlaceholder');
            
            // Update mobile menu
            const mobileFilterInput = document.getElementById('mobileFilterInput');
            if (mobileFilterInput) {
                mobileFilterInput.placeholder = t('mobileSearchPlaceholder');
            }
            
            // Update mobile menu title
            const mobileMenuTitle = document.querySelector('.mobile-menu-title');
            if (mobileMenuTitle) {
                mobileMenuTitle.textContent = t('mobileMenuTitle');
            }
            
            // Update mobile menu section titles
            const sectionTitles = document.querySelectorAll('.mobile-menu-section-title');
            if (sectionTitles[0]) sectionTitles[0].textContent = t('mobileActions');
            if (sectionTitles[1]) sectionTitles[1].textContent = t('mobileSettings');
            

            
            // Update modal close buttons
            const modalCloseBtns = document.querySelectorAll('.modal .btn-ghost[title*="Close"], .modal .btn-ghost[title*="◊°◊í◊ô◊®◊î"]');
            modalCloseBtns.forEach(btn => {
                btn.title = t('close');
            });
            


            
            // Update modal texts with null checks
            const addCategoryModal = document.querySelector('#addCategoryModal h3');
            if (addCategoryModal) addCategoryModal.textContent = t('addNewCategory');
            
            const editCategoryModal = document.querySelector('#editCategoryModal h3');
            if (editCategoryModal) editCategoryModal.textContent = t('editCategory');
            
            const editServerModal = document.querySelector('#editServerModal h3');
            if (editServerModal) editServerModal.textContent = t('editServerTitle');
            
            const editTitleModal = document.querySelector('#editTitleModal h3');
            if (editTitleModal) editTitleModal.textContent = t('editTitle');
            
            const editHeaderModal = document.querySelector('#editHeaderModal h3');
            if (editHeaderModal) editHeaderModal.textContent = t('editHeaderTitle');
            
            // Update category type options

            
            // Update modal labels with null checks
            const categoryBorderColorLabel = document.querySelector('.category-border-color-label');
            if (categoryBorderColorLabel) categoryBorderColorLabel.textContent = t('categoryBorderColor');
            
            const editCategoryBorderColorLabel = document.querySelector('.edit-category-border-color-label');
            if (editCategoryBorderColorLabel) editCategoryBorderColorLabel.textContent = t('categoryBorderColor');
            
            // Update placeholders with null checks
            const categoryName = document.getElementById('categoryName');
            if (categoryName) categoryName.placeholder = t('categoryNamePlaceholder');
            
            const editCategoryName = document.getElementById('editCategoryName');
            if (editCategoryName) editCategoryName.placeholder = t('categoryNamePlaceholder');
            
            const editServerName = document.getElementById('editServerName');
            if (editServerName) editServerName.placeholder = t('serverNamePlaceholder');
            
            const editServerUrl = document.getElementById('editServerUrl');
            if (editServerUrl) editServerUrl.placeholder = t('serverUrlPlaceholder');
            
            const editHeaderTitle = document.getElementById('editHeaderTitle');
            if (editHeaderTitle) editHeaderTitle.placeholder = t('headerTitlePlaceholder');
            
            const editHeaderSubtitle = document.getElementById('editHeaderSubtitle');
            if (editHeaderSubtitle) editHeaderSubtitle.placeholder = t('headerSubtitlePlaceholder');
            
            const editTitleText = document.getElementById('editTitleText');
            if (editTitleText) editTitleText.placeholder = t('titleTextPlaceholder');
            
            // Update delete buttons
            const deleteCategoryBtn = document.getElementById('deleteCategoryBtn');
            const deleteServerBtn = document.getElementById('deleteServerBtn');
            const deleteTitleBtn = document.getElementById('deleteTitleBtn');
            if (deleteCategoryBtn) {
                deleteCategoryBtn.textContent = t('deleteCategoryBtn');
                deleteCategoryBtn.title = t('deleteCategory');
            }
            if (deleteServerBtn) {
                deleteServerBtn.textContent = t('deleteServerBtn');
                deleteServerBtn.title = t('deleteServer');
            }
            if (deleteTitleBtn) {
                deleteTitleBtn.title = t('deleteTitle');
            }
            // Update add category button
            const addCategoryBtn = document.getElementById('addCategoryBtn');
            if (addCategoryBtn) addCategoryBtn.textContent = t('addCategory');
            // Update share options modal texts
            const shareOptionsModal = document.getElementById('shareOptionsModal');
            if (shareOptionsModal) {
                const modalTitle = shareOptionsModal.querySelector('h3');
                const modalText = shareOptionsModal.querySelector('p');
                const saveBtn = shareOptionsModal.querySelector('.btn-primary[onclick*="saveConfigurationFromShareModal"]');
                const copyBtn = shareOptionsModal.querySelector('.btn-secondary[onclick*="copyShareUrl"]');
                const shareBtn = shareOptionsModal.querySelector('.btn-secondary[onclick*="triggerNativeShare"]');
                
                if (modalTitle) modalTitle.textContent = t('shareOptionsModalTitle');
                if (modalText) modalText.textContent = t('shareOptionsModalText');
                if (saveBtn) saveBtn.textContent = currentLanguage === 'he' ? '◊©◊û◊ô◊®◊î ◊ú◊ß◊ï◊ë◊•' : 'Save to File';
                if (copyBtn) copyBtn.textContent = t('copyShareUrl');
                if (shareBtn) shareBtn.textContent = currentLanguage === 'he' ? '◊©◊ô◊™◊ï◊£ ◊õ◊™◊ï◊ë◊™ ◊ô◊ó◊ï◊ì◊ô◊™' : 'Share Unique URL';
                
                // Update warning alert if it exists
                const warningAlert = shareOptionsModal.querySelector('.share-warning-alert');
                if (warningAlert) warningAlert.textContent = t('sharingWarning');
            }
            
            const serverBorderColorLabel = document.querySelector('.server-border-color-label');
            if (serverBorderColorLabel) serverBorderColorLabel.textContent = t('serverBorderColor');
            
            const titleTextColorLabel = document.querySelector('.title-text-color-label');
            if (titleTextColorLabel) titleTextColorLabel.textContent = t('titleTextColor');
            
            // Update modal form labels with null checks
            const addCategoryLabels = document.querySelectorAll('#addCategoryModal label');
            if (addCategoryLabels[0]) addCategoryLabels[0].textContent = t('categoryName');
            if (addCategoryLabels[1]) addCategoryLabels[1].textContent = t('categoryIcon');
            
            const editCategoryLabels = document.querySelectorAll('#editCategoryModal label');
            if (editCategoryLabels[0]) editCategoryLabels[0].textContent = t('categoryName');
            if (editCategoryLabels[1]) editCategoryLabels[1].textContent = t('categoryIcon');
            
            const editServerLabels = document.querySelectorAll('#editServerModal label');
            if (editServerLabels[0]) editServerLabels[0].textContent = t('serverName');
            if (editServerLabels[1]) editServerLabels[1].textContent = t('serverUrl');
            if (editServerLabels[2]) editServerLabels[2].textContent = t('status');
            
            const editTitleLabels = document.querySelectorAll('#editTitleModal label');
            if (editTitleLabels[0]) editTitleLabels[0].textContent = t('titleText');
            if (editTitleLabels[1]) editTitleLabels[1].textContent = t('titleTextColor');
            
            const editHeaderLabels = document.querySelectorAll('#editHeaderModal label');
            if (editHeaderLabels[0]) editHeaderLabels[0].textContent = t('headerIconLabel');
            if (editHeaderLabels[1]) editHeaderLabels[1].textContent = t('headerTitleLabel');
            if (editHeaderLabels[2]) editHeaderLabels[2].textContent = t('headerSubtitleLabel');
            if (editHeaderLabels[3]) editHeaderLabels[3].textContent = t('headerTitleColorLabel');
            if (editHeaderLabels[4]) editHeaderLabels[4].textContent = t('headerSubtitleColorLabel');
            
            // Update modal buttons
            const cancelButtons = document.querySelectorAll('.btn-secondary');
            cancelButtons.forEach(btn => {
                if (btn.textContent.includes('Cancel') || btn.textContent.includes('◊ë◊ô◊ò◊ï◊ú')) {
                    btn.textContent = t('cancel');
                }
            });
            
            const saveButtons = document.querySelectorAll('.btn-primary');
            saveButtons.forEach(btn => {
                if (btn.textContent.includes('Save') || btn.textContent.includes('◊©◊û◊ô◊®◊î')) {
                    btn.textContent = t('saveChanges');
                }
            });
        }

        // Show edit header modal
        function showEditHeaderModal() {
            document.getElementById('editHeaderTitle').value = headerTitle;
            document.getElementById('editHeaderSubtitle').value = headerSubtitle;
            
            const titleColor = localStorage.getItem('headerTitleColor') || '#3b82f6';
            const subtitleColor = localStorage.getItem('headerSubtitleColor') || '#6b7280';
            
            document.getElementById('headerTitleColor').value = titleColor;
            document.getElementById('headerSubtitleColor').value = subtitleColor;
            
            // Initialize color pickers
            const titleColorPickerContainer = document.getElementById('headerTitleColorPicker');
            const subtitleColorPickerContainer = document.getElementById('headerSubtitleColorPicker');
            
            if (titleColorPickerContainer) {
                titleColorPickerContainer.innerHTML = createColorPicker(titleColor, 'selectHeaderTitleColor', 'headerTitleColor');
            }
            
            if (subtitleColorPickerContainer) {
                subtitleColorPickerContainer.innerHTML = createColorPicker(subtitleColor, 'selectHeaderSubtitleColor', 'headerSubtitleColor');
            }
            
            // Initialize header icon picker
            generateHeaderIconGrid();
            
            // Set default icon (home) or current icon if exists
            const currentIcon = localStorage.getItem('headerIcon') || 'üè†';
            window.selectedHeaderIcon = currentIcon;
            highlightSelectedHeaderIcon(currentIcon);
            
            document.getElementById('editHeaderModal').classList.remove('hidden');
        }

        // Hide edit header modal
        function hideEditHeaderModal() {
            document.getElementById('editHeaderModal').classList.add('hidden');
        }

        // Save header edit
        function saveHeaderEdit() {
            const newTitle = document.getElementById('editHeaderTitle').value.trim();
            const newSubtitle = document.getElementById('editHeaderSubtitle').value.trim();
            const titleColor = document.getElementById('headerTitleColor').value;
            const subtitleColor = document.getElementById('headerSubtitleColor').value;
            const selectedIcon = window.selectedHeaderIcon || 'üè†';
            
            // Validate input
            if (newTitle && !validateString(newTitle, 100)) {
                alert(t('titleTooLong'));
                return;
            }
            
            if (newSubtitle && !validateString(newSubtitle, 200)) {
                alert(t('subtitleTooLong'));
                return;
            }
            
            if (newTitle) {
                headerTitle = newTitle;
            }
            if (newSubtitle) {
                headerSubtitle = newSubtitle;
            }
            
            // Save colors and icon to localStorage
            localStorage.setItem('headerTitleColor', titleColor);
            localStorage.setItem('headerSubtitleColor', subtitleColor);
            localStorage.setItem('headerIcon', selectedIcon);
            
            // Apply colors to header
            document.querySelector('.header h1').style.color = titleColor;
            document.querySelector('.header p').style.color = subtitleColor;
            
                    saveData();
                    updateTexts();
                    showChangesNotification();
            hideEditHeaderModal();
        }

        // Select header title color
        function selectHeaderTitleColor(color) {
            document.getElementById('headerTitleColor').value = color;
            updateColorPickerSelection('headerTitleColorPicker', color);
        }

        // Select header subtitle color
        function selectHeaderSubtitleColor(color) {
            document.getElementById('headerSubtitleColor').value = color;
            updateColorPickerSelection('headerSubtitleColorPicker', color);
        }



        // Color selection functions
        function selectCategoryColor(color) {
            document.getElementById('categoryBorderColor').value = color;
            updateColorPickerSelection('addCategoryColorPicker', color);
        }

        function selectServerColor(color) {
            document.getElementById('editServerBorderColor').value = color;
            updateColorPickerSelection('editServerColorPicker', color);
        }

        // Updated color picker selection helper function
        function updateColorPickerSelection(containerId, color) {
            const container = document.getElementById(containerId);
            if (container) {
                container.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
            });
                const selectedOption = container.querySelector(`.color-option[data-color="${color}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                }
            }
        }

        // Filter items
        function filterItems() {
            const query = document.getElementById('filterInput').value.toLowerCase();
            const clearBtn = document.getElementById('searchClearBtn');
            const mobileClearBtn = document.getElementById('mobileSearchClearBtn');
            
            // Show/hide clear buttons based on input content
            if (query) {
                clearBtn.classList.add('visible');
                mobileClearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
                mobileClearBtn.classList.remove('visible');
            }
            
            if (!query) {
                filteredCategories = categories;
            } else {
                filteredCategories = categories.filter(category => {
                    const categoryMatch = category.name.toLowerCase().includes(query);
                    const serverMatch = category.servers.some(server => 
                        server.name.toLowerCase().includes(query) || 
                        server.url.toLowerCase().includes(query)
                    );
                    return categoryMatch || serverMatch;
                }).map(category => ({
                    ...category,
                    servers: category.servers.filter(server => 
                        server.name.toLowerCase().includes(query) || 
                        server.url.toLowerCase().includes(query) ||
                        category.name.toLowerCase().includes(query)
                    )
                }));
            }
            renderCategories();
        }

        // Clear search
        function clearSearch() {
            document.getElementById('filterInput').value = '';
            document.getElementById('searchClearBtn').classList.remove('visible');
            filterItems();
        }

        // Clear mobile search
        function clearMobileSearch() {
            document.getElementById('mobileFilterInput').value = '';
            document.getElementById('mobileSearchClearBtn').classList.remove('visible');
            document.getElementById('filterInput').value = '';
            document.getElementById('searchClearBtn').classList.remove('visible');
            filterItems();
        }
        // Render all categories
        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            const categoriesToRender = filteredCategories.length ? filteredCategories : categories;
            
            // Clear existing content
            grid.innerHTML = '';
            
            // Check edit mode once
            const container = document.querySelector('.container');
            const isEditMode = container.classList.contains('edit-mode');
            
            // Add Most Used Websites category if enabled
            if (isMostUsedWebsitesEnabled()) {
                const isMostRecentMode = localStorage.getItem('mostUsedWebsitesMode') === 'recent';
                const websites = isMostRecentMode ? getMostRecentWebsites() : getMostUsedWebsites();
                
                if (websites.length > 0) {
                    // Group websites by category and title for combined display
                    const groupedWebsites = groupWebsitesByCategoryAndTitle(websites);
                    
                    // Create mixed items (titles and servers) for Most Used Websites
                    const mixedItems = [];
                    
                    // Group consecutive items with the same combined title
                    let currentCombinedTitle = null;
                    let currentTitleId = null;
                    
                    groupedWebsites.forEach((group, index) => {
                        const combinedTitle = group.combinedTitle;
                        
                        // If this is a new combined title, add a title separator
                        if (combinedTitle !== currentCombinedTitle) {
                            currentCombinedTitle = combinedTitle;
                            currentTitleId = `title-${group.categoryName}-${index}`;
                            
                            // Determine title color: use original title color if exists, otherwise use category border color
                            const titleColor = group.titleColor || group.categoryBorderColor || '#000000';
                            
                            mixedItems.push({
                                type: 'title',
                                data: {
                                    id: currentTitleId,
                                    text: combinedTitle,
                                    textColor: titleColor
                                }
                            });
                        }
                        
                        // Add server object
                        mixedItems.push({
                            type: 'server',
                            data: {
                                id: group.websites[0].id,
                                name: group.displayName,
                                url: group.websites[0].url,
                                borderColor: group.websites[0].originalBorderColor || '#f59e0b',
                                status: 'offline', // Default status for most used websites
                                isGroup: group.websites.length > 1,
                                allUrls: group.websites.map(w => w.url),
                                categoryName: group.categoryName,
                                clickCount: group.websites[0].clickCount || 0,
                                lastVisit: group.websites[0].lastVisit || 0
                            }
                        });
                    });
                    
                    const mostUsedCategory = {
                        id: 'most-used-websites',
                        name: isMostRecentMode ? 
                            (currentLanguage === 'he' ? '◊ë◊©◊ô◊û◊ï◊© ◊ú◊ê◊ó◊®◊ï◊†◊î' : 'Latest Sites') :
                            (currentLanguage === 'he' ? '◊ë◊©◊ô◊û◊ï◊© ◊™◊ì◊ô◊®' : 'Top Sites'),
                        customIcon: isMostRecentMode ? 'üïí' : 'üî•',
                        borderColor: '#f59e0b',
                        servers: [], // Empty servers array since we're using mixedItems
                        titles: [], // Empty titles array since we're using mixedItems
                        mixedItems: mixedItems // Custom mixed items for Most Used Websites
                    };
                    
                    // Render most used category first
                    renderCategory(mostUsedCategory, grid, isEditMode);
                }
            }
            
            categoriesToRender.forEach(category => {
                renderCategory(category, grid, isEditMode);
            });
            
            // Add the "Add Category" button
            const addCategoryCard = document.createElement('div');
            addCategoryCard.className = 'category-card add-category-btn';
            addCategoryCard.onclick = showAddCategoryModal;
            addCategoryCard.style.border = '2px dashed var(--card-border)';
            addCategoryCard.style.background = 'transparent';
            addCategoryCard.style.display = 'flex';
            addCategoryCard.style.alignItems = 'center';
            addCategoryCard.style.justifyContent = 'center';
            addCategoryCard.style.cursor = 'pointer';
            addCategoryCard.style.minHeight = '200px';
            
            const addCategoryContent = document.createElement('div');
            addCategoryContent.style.textAlign = 'center';
            addCategoryContent.style.color = 'var(--text-muted)';
            
            const addCategoryText = document.createElement('div');
            addCategoryText.textContent = t('addCategory');
            
            addCategoryContent.appendChild(addCategoryText);
            addCategoryCard.appendChild(addCategoryContent);
            grid.appendChild(addCategoryCard);
        }

        // Render a single category
        function renderCategory(category, grid, isEditMode) {
            const categoryCard = document.createElement('div');
            categoryCard.className = 'category-card';
            categoryCard.id = `category-${category.id}`;
            categoryCard.style.borderColor = category.borderColor || '#94a3b8';
                
                // Create category header
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                
                const categoryIcon = document.createElement('div');
                categoryIcon.className = 'category-icon';
                categoryIcon.textContent = getCategoryIcon(category.customIcon);
                
                // Make category icon clickable in edit mode or for Most Used Websites toggle
                if (isEditMode && category.id !== 'most-used-websites') {
                    categoryIcon.onclick = () => showEditCategoryModal(category.id);
                    categoryIcon.style.cursor = 'pointer';
                    categoryIcon.title = t('editCategory');
                } else if (category.id === 'most-used-websites') {
                    categoryIcon.onclick = () => toggleMostUsedWebsitesMode();
                    categoryIcon.style.cursor = 'pointer';
                    categoryIcon.title = currentLanguage === 'he' ? '◊î◊ó◊ú◊£ ◊ë◊ô◊ü ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù ◊ú◊ê◊ó◊®◊ï◊†◊ô◊ù' : 'Toggle between popular and recent';
                }
                
                const categoryName = document.createElement('span');
                categoryName.className = 'category-name';
                categoryName.id = `categoryName-${category.id}`;
                
                // Add hint for Most Used Websites category
                if (category.id === 'most-used-websites') {
                    const isMostRecentMode = localStorage.getItem('mostUsedWebsitesMode') === 'recent';
                    const arrow = currentLanguage === 'he' ? '‚Üê' : '‚Üí';
                    const toggleHint = isMostRecentMode ? `üëÜ${arrow}üî•` : `üëÜ${arrow}üïí`;
                    categoryName.textContent = category.name + ' ' + toggleHint;
                } else {
                    categoryName.textContent = category.name; // Use textContent for security
                }
                
                // Make category name clickable in edit mode or for Most Used Websites toggle
                if (isEditMode && category.id !== 'most-used-websites') {
                    categoryName.onclick = () => editCategoryName(category.id);
                    categoryName.style.cursor = 'pointer';
                    categoryName.title = t('clickToEdit');
                } else if (category.id === 'most-used-websites') {
                    categoryName.onclick = () => toggleMostUsedWebsitesMode();
                    categoryName.style.cursor = 'pointer';
                    categoryName.title = currentLanguage === 'he' ? '◊î◊ó◊ú◊£ ◊ë◊ô◊ü ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù ◊ú◊ê◊ó◊®◊ï◊†◊ô◊ù' : 'Toggle between popular and recent';
                }
                
                categoryTitle.appendChild(categoryIcon);
                categoryTitle.appendChild(categoryName);
                
                // Create category controls
                const categoryControls = document.createElement('div');
                categoryControls.className = 'category-controls';
                
                // Only show category controls if not Most Used Websites category
                if (category.id !== 'most-used-websites') {
                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-ghost btn-small';
                    editBtn.textContent = '‚úèÔ∏è';
                    editBtn.onclick = () => showEditCategoryModal(category.id);
                    editBtn.title = t('editCategory');
                    
                    const dragHandle = document.createElement('button');
                    dragHandle.className = 'btn btn-ghost btn-small drag-handle';
                    dragHandle.textContent = '‚ãÆ‚ãÆ';
                    dragHandle.draggable = true;
                    dragHandle.ondragstart = (e) => handleCategoryDragStart(e, category.id);
                    dragHandle.ondragend = handleCategoryDragEnd;
                    dragHandle.title = t('dragToReorderCategory');
                    dragHandle.onclick = (e) => e.stopPropagation();
                    categoryControls.appendChild(editBtn);
                    categoryControls.appendChild(dragHandle);
                }
                categoryHeader.appendChild(categoryTitle);
                categoryHeader.appendChild(categoryControls);
                
                // Create server list
                const serverList = document.createElement('div');
                serverList.className = 'server-list';
                serverList.ondragover = (e) => handleServerDragOver(e, category.id);
                serverList.ondrop = (e) => handleServerDrop(e, category.id);
                serverList.style.minHeight = '50px';
                
                // Get mixed order of items (servers and titles)
                const mixedItems = category.mixedItems || getMixedItems(category);
                
                // Render items in mixed order
                mixedItems.forEach(item => {
                    if (item.type === 'server') {
                        const server = item.data;
                        const serverItem = document.createElement('div');
                        serverItem.className = 'server-item';
                        serverItem.id = `server-${server.id}`;
                        
                        // Set click behavior based on edit mode
                        if (isEditMode) {
                            // In edit mode, open edit modal instead of redirecting to website
                            serverItem.onclick = (e) => {
                                // Don't open edit modal for Most Used Websites (they don't have edit functionality)
                                if (category.id !== 'most-used-websites') {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    showEditServerModal(category.id, server.id);
                                }
                            };
                        } else {
                            // In view mode, redirect to website
                            serverItem.onclick = () => handleMobileServerClick(server.id, server.url, category.id);
                        }
                        
                        serverItem.style.position = 'relative';
                        // Use original border color for Most Used Websites, fallback to default for others
                        if (category.id === 'most-used-websites') {
                            serverItem.style.borderColor = server.borderColor || '#f59e0b';
                        } else {
                            serverItem.style.borderColor = server.borderColor || '#94a3b8';
                        }
                        
                        // Status dot
                        const statusDot = document.createElement('div');
                        statusDot.className = `status-dot status-${server.status}`;
                        statusDot.onclick = (e) => {
                            e.stopPropagation();
                            checkIndividualServerStatus(category.id, server.id);
                        };
                        statusDot.style.cursor = 'pointer';
                        statusDot.title = t('clickToCheckStatus');
                        
                        // Server info
                        const serverInfo = document.createElement('div');
                        serverInfo.className = 'server-info';
                        serverInfo.id = `serverInfo-${server.id}`;
                        
                        const serverName = document.createElement('div');
                        serverName.className = 'server-name';
                        
                        // For Most Used Websites, show count or time information
                        if (category.id === 'most-used-websites') {
                            const isMostRecentMode = localStorage.getItem('mostUsedWebsitesMode') === 'recent';
                            
                            if (isMostRecentMode) {
                                // Show time for recent mode
                                const timeDisplay = formatTimeDisplay(server.lastVisit);
                                serverName.textContent = server.name; // Use textContent for security
                                
                                // Create badge for top-right corner (LTR) or top-left corner (RTL)
                                const badge = document.createElement('div');
                                badge.className = 'server-badge';
                                badge.textContent = timeDisplay;
                                const isRTL = currentLanguage === 'he';
                                badge.style.cssText = `
                                    position: absolute;
                                    top: -8px;
                                    ${isRTL ? 'left: -8px;' : 'right: -8px;'}
                                    background: #3b82f6;
                                    color: white;
                                    font-size: 0.7em;
                                    padding: 2px 6px;
                                    border-radius: 10px;
                                    font-weight: bold;
                                    min-width: 20px;
                                    text-align: center;
                                    z-index: 10;
                                    border: 2px solid var(--card-bg);
                                `;
                                serverItem.appendChild(badge);
                            } else {
                                // Show count for popular mode
                                serverName.textContent = server.name; // Use textContent for security
                                
                                // Create badge for top-right corner (LTR) or top-left corner (RTL)
                                const badge = document.createElement('div');
                                badge.className = 'server-badge';
                                badge.textContent = server.clickCount;
                                const isRTL = currentLanguage === 'he';
                                badge.style.cssText = `
                                    position: absolute;
                                    top: -8px;
                                    ${isRTL ? 'left: -8px;' : 'right: -8px;'}
                                    background: #10b981;
                                    color: white;
                                    font-size: 0.7em;
                                    padding: 2px 6px;
                                    border-radius: 10px;
                                    font-weight: bold;
                                    min-width: 20px;
                                    text-align: center;
                                    z-index: 10;
                                    border: 2px solid var(--card-bg);
                                `;
                                serverItem.appendChild(badge);
                            }
                        } else {
                            // For regular categories, show only the website name
                            serverName.textContent = server.name; // Use textContent for security
                        }
                        
                        // Make server name clickable in edit mode (not for Most Used Websites)
                        if (isEditMode && category.id !== 'most-used-websites') {
                            serverName.style.cursor = 'pointer';
                            serverName.title = t('clickToEdit');
                            serverName.onclick = (e) => {
                                e.stopPropagation();
                                showEditServerModal(category.id, server.id);
                            };
                        }
                        
                        const serverUrl = document.createElement('div');
                        serverUrl.className = 'server-url';
                        serverUrl.textContent = server.url; // Use textContent for security
                        
                        serverInfo.appendChild(serverName);
                        serverInfo.appendChild(serverUrl);
                        
                        // Server controls (only for non-Most Used Websites categories)
                        const serverControls = document.createElement('div');
                        serverControls.className = 'server-controls';
                        
                        if (category.id !== 'most-used-websites') {
                            const serverEditBtn = document.createElement('button');
                            serverEditBtn.className = 'btn btn-ghost btn-small';
                            serverEditBtn.textContent = '‚úèÔ∏è';
                            serverEditBtn.onclick = (e) => {
                                e.stopPropagation();
                                showEditServerModal(category.id, server.id);
                            };
                            serverEditBtn.title = t('editServer');
                            
                            const serverDragHandle = document.createElement('button');
                            serverDragHandle.className = 'btn btn-ghost btn-small drag-handle';
                            serverDragHandle.textContent = '‚ãÆ‚ãÆ';
                            serverDragHandle.draggable = true;
                            serverDragHandle.ondragstart = (e) => handleServerDragStart(e, server.id, category.id);
                            serverDragHandle.ondragend = handleServerDragEnd;
                            serverDragHandle.title = t('dragToReorderServer');
                            serverDragHandle.onclick = (e) => e.stopPropagation();
                            
                            serverControls.appendChild(serverEditBtn);
                            serverControls.appendChild(serverDragHandle);
                        }
                        
                        // URL popup (create first so it can be referenced by the button)
                        const urlPopup = document.createElement('div');
                        urlPopup.className = 'url-popup';
                        urlPopup.onmouseenter = () => {
                            // Keep popup open when hovering over it
                        };
                        urlPopup.onmouseleave = () => {
                            // Hide popup when mouse leaves
                            setTimeout(() => {
                                const popupBtn = serverItem.querySelector('.url-popup-btn');
                                if (!urlPopup.matches(':hover') && !popupBtn.matches(':hover')) {
                                    urlPopup.classList.remove('show');
                                }
                            }, 100);
                        };
                        
                        const urlPopupContent = document.createElement('div');
                        urlPopupContent.className = 'url-popup-content';
                        
                        const urlDisplay = document.createElement('div');
                        urlDisplay.className = 'url-display';
                        urlDisplay.textContent = server.url; // Use textContent for security
                        
                        const urlActions = document.createElement('div');
                        urlActions.className = 'url-actions';
                        
                        const copyBtn = document.createElement('a');
                        copyBtn.href = '#';
                        copyBtn.className = 'url-copy-btn';
                        copyBtn.textContent = t('copyUrl');
                        copyBtn.onclick = (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            copyUrlToClipboard(server.url, copyBtn);
                        };
                        copyBtn.title = 'Copy URL';
                        
                        const openBtn = document.createElement('a');
                        openBtn.href = server.url;
                        openBtn.className = 'url-open-btn';
                        openBtn.target = '_blank';
                        openBtn.textContent = t('openUrl');
                        openBtn.title = 'Open URL';
                        
                        urlActions.appendChild(copyBtn);
                        urlActions.appendChild(openBtn);
                        urlPopupContent.appendChild(urlDisplay);
                        urlPopupContent.appendChild(urlActions);
                        urlPopup.appendChild(urlPopupContent);
                        
                        // URL popup button container
                        const urlPopupBtnContainer = document.createElement('div');
                        urlPopupBtnContainer.className = 'url-popup-btn-container';
                        
                        // For Most Used Websites in edit mode, show remove button on the left
                        if (category.id === 'most-used-websites' && isEditMode) {
                            const removeBtn = document.createElement('button');
                            removeBtn.className = 'btn btn-ghost btn-small remove-website-btn';
                            removeBtn.textContent = '√ó';
                            const isRTL = currentLanguage === 'he';
                            removeBtn.style.cssText = `
                                position: absolute;
                                ${isRTL ? 'right: 8px;' : 'left: 8px;'}
                                top: 50%;
                                transform: translateY(-50%);
                                background: #ef4444;
                                color: white;
                                border: none;
                                border-radius: 50%;
                                width: 24px;
                                height: 24px;
                                font-size: 14px;
                                font-weight: bold;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                opacity: 0.9;
                                transition: opacity 0.2s;
                                z-index: 10;
                            `;
                            removeBtn.onmouseenter = () => removeBtn.style.opacity = '1';
                            removeBtn.onmouseleave = () => removeBtn.style.opacity = '0.9';
                            removeBtn.onclick = (e) => {
                                e.stopPropagation();
                                removeWebsiteFromMostUsed(server.id, server.name, server.url);
                            };
                            removeBtn.title = currentLanguage === 'he' ? '◊î◊°◊® ◊û◊î◊®◊©◊ô◊û◊î' : 'Remove from list';
                            serverItem.appendChild(removeBtn);
                            
                            // Push only the status dot based on language direction
                            if (isRTL) {
                                statusDot.style.marginRight = '20px';
                            } else {
                                statusDot.style.marginLeft = '20px';
                            }
                        } else {
                            // URL popup button (separate from server controls for view mode visibility)
                            const urlPopupBtn = document.createElement('button');
                            urlPopupBtn.className = 'btn btn-ghost btn-small url-popup-btn';
                            urlPopupBtn.textContent = '‚ãØ';
                            urlPopupBtn.onmouseenter = (e) => {
                                e.stopPropagation();
                                toggleUrlPopup(serverItem, urlPopup);
                            };
                            urlPopupBtn.onmouseleave = (e) => {
                                e.stopPropagation();
                                // Hide popup after a short delay to allow moving to popup content
                                setTimeout(() => {
                                    const popup = serverItem.querySelector('.url-popup');
                                    if (popup && !popup.matches(':hover') && !urlPopupBtn.matches(':hover')) {
                                        popup.classList.remove('show');
                                    }
                                }, 100);
                            };
                            urlPopupBtn.title = t('showUrl');
                            
                            // Add button to container
                            urlPopupBtnContainer.appendChild(urlPopupBtn);
                        }
                        
                        // Add elements in correct order: status dot, server info, URL button container, server controls, URL popup
                        serverItem.appendChild(statusDot);
                        serverItem.appendChild(serverInfo);
                        serverItem.appendChild(urlPopupBtnContainer);
                        serverItem.appendChild(serverControls);
                        serverItem.appendChild(urlPopup);
                        
                        serverList.appendChild(serverItem);
                    } else if (item.type === 'title') {
                        const title = item.data;
                        const titleItem = document.createElement('div');
                        titleItem.className = 'title-separator';
                        titleItem.id = `title-${title.id}`;
                        titleItem.style.position = 'relative';
                        
                        // Title text
                        const titleText = document.createElement('div');
                        titleText.className = 'title-text';
                        titleText.textContent = title.text; // Use textContent for security
                        titleText.style.color = title.textColor || '#1e293b';
                        
                        // Title controls (only for non-Most Used Websites categories)
                        const titleControls = document.createElement('div');
                        titleControls.className = 'title-controls';
                        
                        if (category.id !== 'most-used-websites') {
                            const titleEditBtn = document.createElement('button');
                            titleEditBtn.className = 'btn btn-ghost btn-small';
                            titleEditBtn.textContent = '‚úèÔ∏è';
                            titleEditBtn.onclick = (e) => {
                                e.stopPropagation();
                                showEditTitleModal(category.id, title.id);
                            };
                            titleEditBtn.title = t('editTitle');
                            
                            const titleDragHandle = document.createElement('button');
                            titleDragHandle.className = 'btn btn-ghost btn-small drag-handle';
                            titleDragHandle.textContent = '‚ãÆ‚ãÆ';
                            titleDragHandle.draggable = true;
                            titleDragHandle.ondragstart = (e) => handleTitleDragStart(e, title.id, category.id);
                            titleDragHandle.ondragend = handleTitleDragEnd;
                            titleDragHandle.title = t('dragToReorderTitle');
                            titleDragHandle.onclick = (e) => e.stopPropagation();
                            
                            titleControls.appendChild(titleEditBtn);
                            titleControls.appendChild(titleDragHandle);
                        }
                        
                        titleItem.appendChild(titleText);
                        titleItem.appendChild(titleControls);
                        
                        serverList.appendChild(titleItem);
                    }
                });
                
                // Add server and title buttons (only for non-Most Used Websites categories)
                if (category.id !== 'most-used-websites') {
                    const addServerBtn = document.createElement('button');
                    addServerBtn.className = 'btn btn-secondary add-server-btn';
                    addServerBtn.textContent = t('addServer');
                    addServerBtn.onclick = () => addServer(category.id);
                    addServerBtn.style.width = '100%';
                    addServerBtn.style.marginTop = '0.5rem';
                    
                    serverList.appendChild(addServerBtn);
                    
                    const addTitleBtn = document.createElement('button');
                    addTitleBtn.className = 'btn btn-secondary add-title-btn';
                    addTitleBtn.textContent = t('addTitle');
                    addTitleBtn.onclick = () => addTitle(category.id);
                    addTitleBtn.style.width = '100%';
                    addTitleBtn.style.marginTop = '0.5rem';
                    
                    serverList.appendChild(addTitleBtn);
                }
                
                categoryCard.appendChild(categoryHeader);
                categoryCard.appendChild(serverList);
                grid.appendChild(categoryCard);
            }

        // Render social media bar
        renderSocialMediaBar();

        // Global variables for edit modals
        let currentEditCategoryId = null;
        let currentEditServerId = null;

        // Show edit category modal
        function showEditCategoryModal(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            
            currentEditCategoryId = categoryId;
            
            document.getElementById('editCategoryName').value = category.name;
            window.selectedEditCategoryIcon = category.customIcon || getCategoryIcon();
            
            const borderColor = category.borderColor || '#3b82f6';
            document.getElementById('editCategoryBorderColor').value = borderColor;
            
            // Initialize color picker
            const colorPickerContainer = document.getElementById('editCategoryColorPicker');
            if (colorPickerContainer) {
                colorPickerContainer.innerHTML = createColorPicker(borderColor, 'selectEditCategoryColor', 'editCategoryBorderColor');
            }
            
            document.getElementById('editCategoryModal').classList.remove('hidden');
            
            // Generate icon grid and highlight current selection
            generateIconGrid('editCategoryIconGrid', selectEditCategoryIcon);
            highlightSelectedIcon('editCategoryIconGrid', window.selectedEditCategoryIcon);
        }

        // Hide edit category modal
        function hideEditCategoryModal() {
            document.getElementById('editCategoryModal').classList.add('hidden');
            currentEditCategoryId = null;
            window.selectedEditCategoryIcon = null;
        }

        // Save edit category
        function saveEditCategory() {
            const name = document.getElementById('editCategoryName').value;
            const icon = window.selectedEditCategoryIcon;
            const borderColor = document.getElementById('editCategoryBorderColor').value;
            
            if (!icon) {
                alert(t('selectCategoryIcon'));
                return;
            }
            
            if (name && currentEditCategoryId) {
                const category = categories.find(c => c.id === currentEditCategoryId);
                
                category.name = name;
                category.borderColor = borderColor;
                category.customIcon = icon;
                
                saveData();
                renderCategories();
                showChangesNotification();
                hideEditCategoryModal();
            }
        }

        // Color selection for edit category
        function selectEditCategoryColor(color) {
            document.getElementById('editCategoryBorderColor').value = color;
            updateColorPickerSelection('editCategoryColorPicker', color);
        }
        // Comprehensive emoji list
        const categoryEmojis = [
            // Tech & Communication
            'üì∫', 'üåê', 'üíæ', '‚öôÔ∏è', 'üíª', 'üìä', 'üîí', 'üí¨', 'üìù', 'üéÆ', 'üóÑÔ∏è', 'ü§ñ', 'üì±', 'üîß', 'üì°', 'üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üíø', 'üìÄ', 'üîå', 'üîã', 'üì∂', 'üõ∞Ô∏è', 'üåç', 'üåé', 'üåè', 'üìû', 'üìü', 'üì†', 'üìª',
            
            // Buildings & Places
            'üè†', 'üè¢', 'üè•', 'üè™', 'üè®', 'üè´', 'üè≠', 'üèóÔ∏è', 'üèõÔ∏è', '‚õ™', 'üïå', 'üïç', 'üõï', '‚õ©Ô∏è', 'üïã', '‚õ∫', 'üèïÔ∏è', 'üèñÔ∏è', 'üèùÔ∏è', 'üèîÔ∏è', '‚õ∞Ô∏è', 'üåã', 'üóª', 'üóº', 'üè∞', 'üèØ', 'üèüÔ∏è', 'üé°', 'üé¢', 'üé†', 'üé™',
            
            // Transportation
            'üöÄ', '‚úàÔ∏è', 'üõ©Ô∏è', 'üõ´', 'üõ¨', 'üöÅ', 'üõ∏', 'üö¢', '‚õ¥Ô∏è', 'üõ•Ô∏è', 'üö§', '‚õµ', 'üõ∂', 'üö£', 'üö£‚Äç‚ôÇÔ∏è', 'üö£‚Äç‚ôÄÔ∏è', 'üö¥', 'üö¥‚Äç‚ôÇÔ∏è', 'üö¥‚Äç‚ôÄÔ∏è', 'üöµ', 'üöµ‚Äç‚ôÇÔ∏è', 'üöµ‚Äç‚ôÄÔ∏è', 'üèá', 'üèÇ', 'üèÇ‚Äç‚ôÇÔ∏è', 'üèÇ‚Äç‚ôÄÔ∏è', 'üèÑ', 'üèÑ‚Äç‚ôÇÔ∏è', 'üèÑ‚Äç‚ôÄÔ∏è', 'üöó', 'üöï', 'üöô',
            
            // Activities & Sports
            'üéØ', 'üé≤', 'üé≥', 'üé∞', 'üé®', 'üé≠', 'üé™', 'üéüÔ∏è', 'üé´', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üéµ', 'üé∂', 'üéº', 'üéπ', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üéπ', 'üéº',
            
            // Nature & Weather
            '‚≠ê', 'üåü', '‚ú®', 'üí´', '‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå•Ô∏è', '‚òÅÔ∏è', 'üå¶Ô∏è', 'üåßÔ∏è', '‚õàÔ∏è', 'üå©Ô∏è', 'üå®Ô∏è', '‚òÉÔ∏è', '‚õÑ', 'üå¨Ô∏è', 'üí®', 'üå™Ô∏è', 'üåà', '‚òî', '‚òÇÔ∏è', 'üåä', 'üåÖ', 'üåÑ', 'üåá', 'üåÜ', 'üåÉ', 'üåå', 'üå†', 'üåô',
            
            // Objects & Tools
            'üî•', 'üí°', 'üî¶', 'üïØÔ∏è', 'ü™î', 'üß®', 'üéÜ', 'üéá', 'üéà', 'üéâ', 'üéä', 'üéã', 'üéç', 'üéé', 'üéè', 'üéê', 'üéÄ', 'üéÅ', 'üéóÔ∏è', 'üéüÔ∏è', 'üé´', 'üéñÔ∏è', 'üèÜ', 'üèÖ', 'ü•á', 'ü•à', 'ü•â', '‚öΩ', 'üèÄ', 'üèà', '‚öæ',
            
            // Food & Drinks
            'üçï', '‚òï', 'üçî', 'üçü', 'üå≠', 'üåÆ', 'üåØ', 'ü•ô', 'ü•™', 'ü•®', 'ü•Ø', 'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üåΩ', 'ü•ï', 'ü•í', 'ü•¨', 'ü•¶', 'üßÑ', 'üßÖ', 'ü•î', 'üç†', 'ü•ê', 'ü•Ø', 'üçû', 'ü•ñ',
            
            // Business & Finance
            'üí∞', 'üí¥', 'üíµ', 'üí∂', 'üí∑', 'ü™ô', 'üí∏', 'ü§ë', 'üí≥', 'üßæ', 'üíπ', 'üìà', 'üìâ', 'üìä', 'üìã', 'üìå', 'üìç', 'üìé', 'üñáÔ∏è', 'üìê', '‚úèÔ∏è', 'üîç', 'üîé', 'üîè', 'üîê', 'üîí', 'üîì', 'üîë', 'üóùÔ∏è', 'üî®', 'ü™õ',
            
            // Education & Knowledge
            'üìö', 'üìñ', 'üìî', 'üìí', 'üìï', 'üìó', 'üìò', 'üìô', 'üìì', 'üìÉ', 'üìÑ', 'üìú', 'üìã', 'üìù', '‚úèÔ∏è', 'üñäÔ∏è', 'üñãÔ∏è', '‚úíÔ∏è', 'üñåÔ∏è', 'üñçÔ∏è', 'üìè', 'üìê', 'üìè', 'üìê', 'üìè', 'üìê', 'üìè', 'üìê', 'üìè', 'üìê', 'üìè',
            
            // People & Activities
            'üèÉ', 'üèÉ‚Äç‚ôÇÔ∏è', 'üèÉ‚Äç‚ôÄÔ∏è', 'üö∂', 'üö∂‚Äç‚ôÇÔ∏è', 'üö∂‚Äç‚ôÄÔ∏è', 'üßç', 'üßç‚Äç‚ôÇÔ∏è', 'üßç‚Äç‚ôÄÔ∏è', 'üßé', 'üßé‚Äç‚ôÇÔ∏è', 'üßé‚Äç‚ôÄÔ∏è', 'üë®‚Äçü¶Ø', 'üë©‚Äçü¶Ø', 'üë®‚Äçü¶º', 'üë©‚Äçü¶º', 'üë®‚Äçü¶Ω', 'üë©‚Äçü¶Ω', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë©‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüë©‚Äçüëß‚Äçüëß', 'üë®‚Äçüë©‚Äçüë¶‚Äçüëß', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë©‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüë©‚Äçüëß‚Äçüëß', 'üë®‚Äçüë©‚Äçüë¶‚Äçüëß', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë©‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüë©‚Äçüëß‚Äçüëß', 'üë®‚Äçüë©‚Äçüë¶‚Äçüëß',
            
            // Emotions & Symbols
            'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©', 'ü•≥',
            
            // Animals & Nature
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥',
            
            // Plants & Flowers
            'üå∏', 'üíÆ', 'üèµÔ∏è', 'üåπ', 'ü•Ä', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üå±', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üåæ', 'üåø', '‚òòÔ∏è', 'üçÄ', 'üçÅ', 'üçÇ', 'üçÉ', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üå±', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üåæ',
            
            // Time & Calendar
            'üïê', 'üïë', 'üïí', 'üïì', 'üïî', 'üïï', 'üïñ', 'üïó', 'üïò', 'üïô', 'üïö', 'üïõ', 'üïú', 'üïù', 'üïû', 'üïü', 'üï†', 'üï°', 'üï¢', 'üï£', 'üï§', 'üï•', 'üï¶', 'üïß', '‚è∞', '‚è±Ô∏è', '‚è≤Ô∏è', 'üï∞Ô∏è', '‚åõ', '‚è≥', 'üìÖ',
            
            // Miscellaneous
            'üéà', 'üéâ', 'üéä', 'üéã', 'üéç', 'üéé', 'üéè', 'üéê', 'üéÄ', 'üéÅ', 'üéóÔ∏è', 'üéüÔ∏è', 'üé´', 'üéñÔ∏è', 'üèÜ', 'üèÖ', 'ü•á', 'ü•à', 'ü•â', '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'ü™Ä', 'üèì'
        ];

        // Generate icon grid
        function generateIconGrid(containerId, selectFunction) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            categoryEmojis.forEach(emoji => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'icon-option';
                button.textContent = emoji;
                button.onclick = () => selectFunction(emoji);
                container.appendChild(button);
            });
        }

        // Unified icon grid generation for all modals
        function generateAllIconGrids() {
            // Generate category icon grids
            generateIconGrid('categoryIconGrid', selectCategoryIcon);
            generateIconGrid('editCategoryIconGrid', selectEditCategoryIcon);
            
            // Generate header icon grid
            generateHeaderIconGrid();
        }

        // Unified Google Analytics input component
        function createGoogleAnalyticsInput(containerId, isMobile = false) {
            const prefix = isMobile ? 'mobile' : 'desktop';
            const inputClass = isMobile ? 'mobile-input' : 'desktop-input';
            const clearButtonStyle = isMobile ? 
                'position: absolute; top: 0px; background: #6b7280; border: none; color: white; cursor: pointer; font-size: 1rem; padding: 0; border-radius: 0 .5rem .5rem 0; width: 2.5rem; height: calc(2.5rem + 2px); display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);' :
                'position: absolute; top: 50%; transform: translateY(-50%); background: #6b7280; border: none; color: white; cursor: pointer; font-size: 1rem; padding: 0.25rem; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);';
            const pasteButtonStyle = isMobile ?
                'position: absolute; top: 0px; background: #6b7280; border: none; color: white; cursor: pointer; font-size: 0.75rem; padding: 0; border-radius: 0 .5rem .5rem 0; width: 2.5rem; height: calc(2.5rem + 2px); display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);' :
                'position: absolute; top: 50%; transform: translateY(-50%); background: #6b7280; border: none; color: white; cursor: pointer; font-size: 0.75rem; padding: 0.25rem; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);';
            
            return `
                <label for="${prefix}GoogleAnalyticsCode" id="${prefix}GoogleAnalyticsLabel">Google Analytics Code:</label>
                <div style="position: relative;">
                    <input type="text" id="${prefix}GoogleAnalyticsCode" class="${inputClass}" placeholder="G-XXXXXXXXXX ◊ê◊ï UA-XXXXXXXX-X" style="font-family: monospace;" oninput="validateAndSaveGoogleAnalytics${isMobile ? 'Mobile' : ''}(); update${isMobile ? 'Mobile' : ''}GoogleAnalyticsClearButton();" maxlength="15">
                    <button type="button" id="${prefix}GoogleAnalyticsClear" onclick="clearGoogleAnalyticsInput${isMobile ? 'Mobile' : ''}()" style="${clearButtonStyle}" title="◊†◊ô◊ß◊ï◊ô ◊ß◊ï◊ì Google Analytics" id="${prefix}GoogleAnalyticsClearBtn">‚úï</button>
                    <button type="button" id="${prefix}GoogleAnalyticsPaste" onclick="pasteGoogleAnalyticsCode${isMobile ? 'Mobile' : ''}()" style="${pasteButtonStyle}" title="◊î◊ì◊ë◊ß◊™ ◊ß◊ï◊ì Google Analytics" id="${prefix}GoogleAnalyticsPasteBtn">üìã</button>
                </div>
            `;
        }

        // Generate all Google Analytics inputs
        function generateGoogleAnalyticsInputs() {
            // Generate mobile Google Analytics input
            const mobileContainer = document.getElementById('mobileGoogleAnalyticsContainer');
            if (mobileContainer) {
                mobileContainer.innerHTML = createGoogleAnalyticsInput('mobileGoogleAnalyticsContainer', true);
            }
            
            // Generate desktop Google Analytics input
            const desktopContainer = document.getElementById('desktopGoogleAnalyticsContainer');
            if (desktopContainer) {
                desktopContainer.innerHTML = createGoogleAnalyticsInput('desktopGoogleAnalyticsContainer', false);
            }
        }

        // Category icon functions
        function selectCategoryIcon(icon) {
            // Store selected icon for add category
            window.selectedCategoryIcon = icon;
            highlightSelectedIcon('categoryIconGrid', icon);
        }

        function selectEditCategoryIcon(icon) {
            // Store selected icon for edit category
            window.selectedEditCategoryIcon = icon;
            highlightSelectedIcon('editCategoryIconGrid', icon);
        }

        // Highlight selected icon
        function highlightSelectedIcon(gridId, selectedIcon) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            
            // Remove previous selection
            grid.querySelectorAll('.icon-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Highlight new selection
            grid.querySelectorAll('.icon-option').forEach(btn => {
                if (btn.textContent === selectedIcon) {
                    btn.classList.add('selected');
                }
            });
        }

        // Generate header icon grid
        function generateHeaderIconGrid() {
            const container = document.getElementById('headerIconPicker');
            if (!container) return;
            
            container.innerHTML = '';
            
            categoryEmojis.forEach(emoji => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'header-icon-option';
                button.textContent = emoji;
                button.onclick = () => selectHeaderIcon(emoji);
                container.appendChild(button);
            });
        }

        // Select header icon
        function selectHeaderIcon(icon) {
            window.selectedHeaderIcon = icon;
            highlightSelectedHeaderIcon(icon);
        }

        // Highlight selected header icon
        function highlightSelectedHeaderIcon(selectedIcon) {
            const container = document.getElementById('headerIconPicker');
            if (!container) return;
            
            // Remove previous selection
            container.querySelectorAll('.header-icon-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Highlight new selection
            container.querySelectorAll('.header-icon-option').forEach(btn => {
                if (btn.textContent === selectedIcon) {
                    btn.classList.add('selected');
                }
            });
        }

        // Modal mouse event tracking
        const modalMouseState = {};

        function handleModalMouseDown(event, modalId) {
            // Track where the mouse down occurred
            modalMouseState[modalId] = {
                mouseDownTarget: event.target,
                mouseDownOnOverlay: event.target.classList.contains('modal-overlay')
            };
        }
        function handleModalMouseUp(event, modalId) {
            if (!modalMouseState[modalId]) return;
            
            const state = modalMouseState[modalId];
            const mouseUpOnOverlay = event.target.classList.contains('modal-overlay');
            
            // Only close if mouse down AND mouse up were both on the overlay (outside the modal content)
            if (state.mouseDownOnOverlay && mouseUpOnOverlay) {
                // Close the modal based on modalId
                switch (modalId) {
                    case 'addCategoryModal':
                        hideAddCategoryModal();
                        break;
                    case 'editCategoryModal':
                        hideEditCategoryModal();
                        break;
                    case 'editServerModal':
                        hideEditServerModal();
                        break;
                    case 'editTitleModal':
                        hideEditTitleModal();
                        break;
                    case 'editHeaderModal':
                        hideEditHeaderModal();
                        break;
                    case 'protocolSelectionModal':
                        hideProtocolSelectionModal();
                        break;
                                case 'helpModal':
                hideHelpModal();
                break;
            case 'socialMediaModal':
                hideSocialMediaModal();
                break;

                }
            }
            
            // Clear the state
            delete modalMouseState[modalId];
        }

        // Edit category name (kept for backward compatibility)
        function editCategoryName(categoryId) {
            showEditCategoryModal(categoryId);
        }

        // Show edit server modal
        function showEditServerModal(categoryId, serverId) {
            const category = categories.find(c => c.id === categoryId);
            const server = serverId ? category.servers.find(s => s.id === serverId) : null;
            
            currentEditCategoryId = categoryId;
            currentEditServerId = serverId;
            
            // Show the modal first
            document.getElementById('editServerModal').classList.remove('hidden');
            
            // Update modal title based on whether it's a new server or existing
            const modalTitle = document.querySelector('#editServerModal h3');
            const borderColor = server ? (server.borderColor || '#94a3b8') : '#94a3b8';
            
            if (server) {
            const isNewServer = server.name.includes('New Server');
            modalTitle.textContent = isNewServer ? t('addNewServer') : t('editServerTitle');
            
            document.getElementById('editServerName').value = server.name;
            document.getElementById('editServerUrl').value = server.url;
                document.getElementById('editServerBorderColor').value = borderColor;
            } else {
                // New server
                modalTitle.textContent = t('addNewServer');
                document.getElementById('editServerName').value = '';
                document.getElementById('editServerUrl').value = '';
                document.getElementById('editServerBorderColor').value = borderColor;
            }
            
            // Initialize color picker
            const colorPickerContainer = document.getElementById('editServerColorPicker');
            if (colorPickerContainer) {
                colorPickerContainer.innerHTML = createColorPicker(borderColor, 'selectServerColor', 'editServerBorderColor');
            }
        }

        // Hide edit server modal
        function hideEditServerModal() {
            document.getElementById('editServerModal').classList.add('hidden');
            currentEditCategoryId = null;
            currentEditServerId = null;
        }

        // Protocol selection variables
        let pendingServerData = null;

        // Show protocol selection modal
        function showProtocolSelectionModal(serverData) {
            pendingServerData = serverData;
            document.getElementById('protocolSelectionModal').classList.remove('hidden');
        }

        // Hide protocol selection modal
        function hideProtocolSelectionModal() {
            document.getElementById('protocolSelectionModal').classList.add('hidden');
            pendingServerData = null;
            pendingSocialMediaData = null;
            pendingSocialMediaIndex = null;
        }

        // Select protocol and continue with server or social media save
        function selectProtocol(protocol) {
            if (pendingServerData) {
                const { name, url, borderColor } = pendingServerData;
                const fullUrl = protocol + url;
                
                // Continue with the save process
                saveServerWithUrl(name, fullUrl, borderColor);
                
                // Hide the protocol selection modal
                hideProtocolSelectionModal();
            } else if (pendingSocialMediaData) {
                const { name, url, svg } = pendingSocialMediaData;
                const fullUrl = protocol + url;
                
                // Continue with the social media save process
                saveSocialMediaWithUrl(pendingSocialMediaIndex, name, fullUrl, svg);
                
                // Hide the protocol selection modal
                hideProtocolSelectionModal();
            }
        }

        // Save social media with complete URL
        function saveSocialMediaWithUrl(index, name, url, svg) {
            const link = socialMediaLinks[index];
            if (link) {
                link.name = name;
                link.url = url;
                if (svg) {
                    link.svg = svg;
                }
                
                // Update the collapsed view with correct name
                updateCollapsedView(index, link);
                
                // Save to localStorage
                saveSocialMediaLinks();
                
                // Update the bottom social media bar without page refresh
                renderSocialMediaBar();
                
                // Close the form
                const form = document.getElementById(`expandedForm_${index}`);
                if (form) {
                    form.classList.remove('active');
                }
                
                // Clear pending data
                pendingSocialMediaData = null;
                pendingSocialMediaIndex = null;
            }
        }

        // Save server with complete URL
        function saveServerWithUrl(name, url, borderColor) {
            if (name && url && currentEditCategoryId) {
                const category = categories.find(c => c.id === currentEditCategoryId);
                
                // Initialize itemOrder if it doesn't exist
                if (!category.itemOrder) {
                    category.itemOrder = [];
                }
                
                if (currentEditServerId) {
                    // Editing existing server
                    const server = category.servers.find(s => s.id === currentEditServerId);
                    if (server) {
                        server.name = name;
                        server.url = url;
                        server.borderColor = borderColor;
                        // Keep existing status - it will be updated by status check
                    } else {
                        alert(t('serverNotFound'));
                        return;
                    }
                } else {
                    // Adding new server
                    const newServer = {
                        id: Date.now().toString(),
                        name: name,
                        url: url,
                        status: 'offline', // Default status, will be updated by status check
                        borderColor: borderColor
                    };
                    category.servers.push(newServer);
                    
                    // Add to itemOrder at the end
                    category.itemOrder.push({ type: 'server', id: newServer.id });
                }
                
                saveData();
                renderCategories();
                showChangesNotification();
                hideEditServerModal();
            } else {
                alert(t('fillRequiredFields'));
            }
        }

        // Save server edit
        function saveServerEdit() {
            const name = document.getElementById('editServerName').value.trim();
            const url = document.getElementById('editServerUrl').value.trim();
            const borderColor = document.getElementById('editServerBorderColor').value;
            
            // Validate input
            if (!validateString(name, 50)) {
                alert(t('serverNameRequired'));
                return;
            }
            
            // Check if URL has a protocol
            if (!hasProtocol(url)) {
                // Show protocol selection modal
                showProtocolSelectionModal({ name, url, borderColor });
                return;
            }
            
            // Validate URL with protocol
            if (!isValidUrl(url)) {
                alert(t('invalidUrl'));
                return;
            }
            
            // If we reach here, the URL has a valid protocol, so save it directly
            saveServerWithUrl(name, url, borderColor);
        }



        // Add server
        function addServer(categoryId) {
            showEditServerModal(categoryId, null);
        }

        // Delete server
        function deleteServer(categoryId, serverId) {
            if (confirm(t('deleteConfirm'))) {
                const category = categories.find(c => c.id === categoryId);
                category.servers = category.servers.filter(s => s.id !== serverId);
                saveData();
                renderCategories();
                showChangesNotification();
            }
        }
        // Delete category
        function deleteCategory(categoryId) {
            if (confirm(t('deleteCategoryConfirm'))) {
                categories = categories.filter(c => c.id !== categoryId);
                saveData();
                renderCategories();
                showChangesNotification();
            }
        }

        // Delete category from modal
        function deleteCategoryFromModal() {
            if (currentEditCategoryId && confirm(t('deleteCategoryConfirm'))) {
                categories = categories.filter(c => c.id !== currentEditCategoryId);
                saveData();
                renderCategories();
                showChangesNotification();
                hideEditCategoryModal();
            }
        }

        // Delete server from modal
        function deleteServerFromModal() {
            if (currentEditCategoryId && currentEditServerId && confirm(t('deleteConfirm'))) {
                const category = categories.find(c => c.id === currentEditCategoryId);
                if (category) {
                    category.servers = category.servers.filter(s => s.id !== currentEditServerId);
                    
                    // Remove from itemOrder
                    if (category.itemOrder) {
                        category.itemOrder = category.itemOrder.filter(item => 
                            !(item.type === 'server' && item.id === currentEditServerId)
                        );
                    }
                    
                    saveData();
                    renderCategories();
                    showChangesNotification();
                    hideEditServerModal();
                }
            }
        }

        // Global variables for title modals
        let currentEditTitleId = null;

        // Show edit title modal
        function showEditTitleModal(categoryId, titleId) {
            const category = categories.find(c => c.id === categoryId);
            const title = titleId ? category.titles.find(t => t.id === titleId) : null;
            
            currentEditCategoryId = categoryId;
            currentEditTitleId = titleId;
            
            // Show the modal first
            document.getElementById('editTitleModal').classList.remove('hidden');
            
            // Update modal title based on whether it's a new title or existing
            const modalTitle = document.querySelector('#editTitleModal h3');
            const textColor = title ? (title.textColor || '#1e293b') : '#1e293b';
            
            if (title) {
                modalTitle.textContent = t('editTitle');
                document.getElementById('editTitleText').value = title.text;
                document.getElementById('editTitleTextColor').value = textColor;
            } else {
                // New title
                modalTitle.textContent = t('addNewTitle');
                document.getElementById('editTitleText').value = '';
                document.getElementById('editTitleTextColor').value = textColor;
            }
            
            // Initialize color picker
            const colorPickerContainer = document.getElementById('editTitleColorPicker');
            if (colorPickerContainer) {
                colorPickerContainer.innerHTML = createColorPicker(textColor, 'selectTitleColor', 'editTitleTextColor');
            }
        }

        // Hide edit title modal
        function hideEditTitleModal() {
            document.getElementById('editTitleModal').classList.add('hidden');
            currentEditCategoryId = null;
            currentEditTitleId = null;
        }

        // Save title edit
        function saveTitleEdit() {
            const text = document.getElementById('editTitleText').value.trim();
            const textColor = document.getElementById('editTitleTextColor').value;
            
            // Validate input
            if (!validateString(text, 50)) {
                alert(t('titleTextRequired'));
                return;
            }
            
            if (text && currentEditCategoryId) {
                const category = categories.find(c => c.id === currentEditCategoryId);
                
                // Initialize titles array if it doesn't exist
                if (!category.titles) {
                    category.titles = [];
                }
                
                // Initialize itemOrder if it doesn't exist
                if (!category.itemOrder) {
                    category.itemOrder = [];
                }
                
                if (currentEditTitleId) {
                    // Editing existing title
                    const title = category.titles.find(t => t.id === currentEditTitleId);
                    if (title) {
                        title.text = text;
                        title.textColor = textColor;
                    } else {
                        alert(t('titleNotFound'));
                        return;
                    }
                } else {
                    // Adding new title
                    const newTitle = {
                        id: Date.now().toString(),
                        text: text,
                        textColor: textColor
                    };
                    category.titles.push(newTitle);
                    
                    // Add to itemOrder at the end
                    category.itemOrder.push({ type: 'title', id: newTitle.id });
                }
                
                saveData();
                renderCategories();
                showChangesNotification();
                hideEditTitleModal();
            } else {
                alert(t('fillRequiredFields'));
            }
        }
        // Delete title from modal
        function deleteTitleFromModal() {
            if (currentEditCategoryId && currentEditTitleId && confirm(t('deleteTitleConfirm'))) {
                const category = categories.find(c => c.id === currentEditCategoryId);
                if (category && category.titles) {
                    category.titles = category.titles.filter(t => t.id !== currentEditTitleId);
                    
                    // Remove from itemOrder
                    if (category.itemOrder) {
                        category.itemOrder = category.itemOrder.filter(item => 
                            !(item.type === 'title' && item.id === currentEditTitleId)
                        );
                    }
                    
                    saveData();
                    renderCategories();
                    showChangesNotification();
                    hideEditTitleModal();
                }
            }
        }

        // Color selection for title
        function selectTitleColor(color) {
            document.getElementById('editTitleTextColor').value = color;
            updateColorPickerSelection('editTitleColorPicker', color);
        }

        // Add title
        function addTitle(categoryId) {
            showEditTitleModal(categoryId, null);
        }

        // Delete title
        function deleteTitle(categoryId, titleId) {
            if (confirm(t('deleteTitleConfirm'))) {
                const category = categories.find(c => c.id === categoryId);
                if (category.titles) {
                    category.titles = category.titles.filter(t => t.id !== titleId);
                    saveData();
                    renderCategories();
                    showChangesNotification();
                }
            }
        }

        // Mobile state tracking


        // Open server
        function openServer(url) {
            if (isValidUrl(url)) {
                const openInNewTab = localStorage.getItem('openLinksInNewTab') !== 'false'; // Default to true
                if (openInNewTab) {
                    window.open(url, '_blank');
                } else {
                    window.location.href = url;
                }
            } else {
                console.error('Invalid URL:', url);
                alert(t('invalidUrlFormat'));
            }
        }

        // Handle mobile server item clicks
        function handleMobileServerClick(serverId, url, categoryId) {
            // Track the click for most used websites
            let serverName = '';
            let categoryName = '';
            
            // Check if it's from the Most Used Websites category
            if (categoryId === 'most-used-websites') {
                // Get the server name from the Most Used Websites data
                const isMostRecentMode = localStorage.getItem('mostUsedWebsitesMode') === 'recent';
                const websites = isMostRecentMode ? getMostRecentWebsites() : getMostUsedWebsites();
                const website = websites.find(w => w.id === serverId);
                if (website) {
                    serverName = website.name;
                    categoryName = website.categoryName || '';
                    trackWebsiteClick(serverId, serverName, url, website.categoryId, categoryName);
                }
            } else {
                // Regular category
                const category = categories.find(c => c.id === categoryId);
                if (category) {
                    const server = category.servers.find(s => s.id === serverId);
                    if (server) {
                        serverName = server.name;
                        categoryName = category.name;
                        trackWebsiteClick(serverId, serverName, url, categoryId, categoryName);
                    }
                }
            }
            
            // Open website directly on both mobile and desktop
            openServer(url);
            
            // If Most Used Websites is enabled, re-render to show the clicked website immediately in both modes
            if (isMostUsedWebsitesEnabled()) {
                setTimeout(() => {
                    renderCategories();
                }, 100); // Small delay to ensure the tracking data is saved
            }
        }

        // Show add category modal
        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('hidden');
            
            // Initialize color picker
            const colorPickerContainer = document.getElementById('addCategoryColorPicker');
            if (colorPickerContainer) {
                colorPickerContainer.innerHTML = createColorPicker('#3b82f6', 'selectCategoryColor', 'categoryBorderColor');
            }
            
            // Generate icon grid for add category modal
            generateIconGrid('categoryIconGrid', selectCategoryIcon);
        }

        // Hide add category modal
        function hideAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('hidden');
            document.getElementById('categoryName').value = '';
            window.selectedCategoryIcon = null;
            
            // Generate icon grid for next use
            generateIconGrid('categoryIconGrid', selectCategoryIcon);
        }

        // Add category
        function addCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const icon = window.selectedCategoryIcon;
            const borderColor = document.getElementById('categoryBorderColor').value;
            
            // Validate input
            if (!validateString(name, 50)) {
                alert(t('categoryNameRequired'));
                return;
            }
            
            if (!icon) {
                alert(t('selectCategoryIcon'));
                return;
            }
            
            if (name) {
                const newCategory = {
                    id: Date.now().toString(),
                    name,
                    borderColor,
                    servers: [],
                    customIcon: icon
                };
                categories.push(newCategory);
                saveData();
                renderCategories();
                showChangesNotification();
                hideAddCategoryModal();
            }
        }
        // Export configuration (website click data is intentionally excluded to keep it local only)
        function exportConfig() {
            const exportData = {
                categories: categories,
                headerTitle: headerTitle,
                headerSubtitle: headerSubtitle,
                headerTitleColor: localStorage.getItem('headerTitleColor') || '#3b82f6',
                headerSubtitleColor: localStorage.getItem('headerSubtitleColor') || '#6b7280',
                currentLanguage: currentLanguage,
                socialMediaLinks: socialMediaLinks,
                settings: {
                    googleAnalyticsCode: localStorage.getItem('googleAnalyticsCode') || '',
                    showSocialMediaBar: localStorage.getItem('showSocialMediaBar') === 'true',
                    serverStatusCheckEnabled: localStorage.getItem('serverStatusCheckEnabled') !== 'false',
                    mostUsedWebsitesEnabled: localStorage.getItem('mostUsedWebsitesEnabled') !== 'false',
                    mostUsedWebsitesMode: localStorage.getItem('mostUsedWebsitesMode') || 'popular',
                    openLinksInNewTab: localStorage.getItem('openLinksInNewTab') !== 'false'
                }
                // Note: websiteClickData is intentionally excluded to keep popular/recent data local only
            };
            

            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            // Get current filename and replace .html with .json
            const currentFilename = window.location.pathname.split('/').pop() || 'index.html';
            const jsonFilename = currentFilename.replace('.html', '.json');
            link.download = jsonFilename;
            
            link.click();
            URL.revokeObjectURL(url);
        }

        // Import configuration (website click data is intentionally not imported to keep it local only)
        function importConfig(event) {
            const file = event.target.files[0];
            
            // Add file type validation
            if (file.type !== 'application/json') {
                alert('Only JSON files are allowed');
                return;
            }
            
            // Add file size limit (1MB)
            if (file.size > 1024 * 1024) {
                alert('File size must be less than 1MB');
                return;
            }
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const imported = secureJsonParse(e.target.result);
                        
                        // Validate imported data
                        if (!validateImportedData(imported)) {
                            alert(t('invalidConfigFormat'));
                            return;
                        }
                        
                        if (confirm(t('importConfirm'))) {
                            // Handle both old format (just categories) and new format (with header data)
                            if (imported.categories) {
                                // New format with header data
                                categories = imported.categories;
                                if (imported.headerTitle) {
                                    headerTitle = imported.headerTitle;
                                }
                                if (imported.headerSubtitle) {
                                    headerSubtitle = imported.headerSubtitle;
                                }
                                if (imported.headerTitleColor) {
                                    localStorage.setItem('headerTitleColor', imported.headerTitleColor);
                                }
                                if (imported.headerSubtitleColor) {
                                    localStorage.setItem('headerSubtitleColor', imported.headerSubtitleColor);
                                }
                                if (imported.currentLanguage) {
                                    setLanguage(imported.currentLanguage);
                                }
                                if (imported.socialMediaLinks) {
                                    // Validate and sanitize SVG content for each link
                                    socialMediaLinks = imported.socialMediaLinks.map(link => ({
                                        ...link,
                                        svg: validateAndSanitizeSvg(link.svg)
                                    }));

                                }
                                
                                // Import settings if they exist
                                if (imported.settings) {
                                    if (imported.settings.googleAnalyticsCode !== undefined) {
                                        localStorage.setItem('googleAnalyticsCode', imported.settings.googleAnalyticsCode);
                                    }
                                    if (imported.settings.showSocialMediaBar !== undefined) {
                                        localStorage.setItem('showSocialMediaBar', imported.settings.showSocialMediaBar.toString());
                                    }
                                    if (imported.settings.serverStatusCheckEnabled !== undefined) {
                                        localStorage.setItem('serverStatusCheckEnabled', imported.settings.serverStatusCheckEnabled.toString());
                                    }
                                    if (imported.settings.mostUsedWebsitesEnabled !== undefined) {
                                        localStorage.setItem('mostUsedWebsitesEnabled', imported.settings.mostUsedWebsitesEnabled.toString());
                                    }
                                    if (imported.settings.mostUsedWebsitesMode !== undefined) {
                                        localStorage.setItem('mostUsedWebsitesMode', imported.settings.mostUsedWebsitesMode);
                                    }
                                    if (imported.settings.openLinksInNewTab !== undefined) {
                                        localStorage.setItem('openLinksInNewTab', imported.settings.openLinksInNewTab.toString());
                                    }
                                }
                            } else {
                                // Old format - just categories array
                            categories = imported;
                            }
                            saveData();
                            
                            // Update initial data for comparison after import
                            initialData = {
                                categories: categories,
                                headerTitle: headerTitle,
                                headerSubtitle: headerSubtitle
                            };
                            
                            updateTexts();
                            renderCategories();
                            renderSocialMediaBar();
                            
                            // Automatically refresh the page after successful import
                            setTimeout(() => {
                                window.location.reload();
                            }, 1000);
                        }
                    } catch (error) {
                        alert(t('invalidConfig'));
                    }
                };
                reader.readAsText(file);
            }
        }

        // Rate limiting for server status checks
        const statusCheckLimiter = {
            lastCheck: {},
            minInterval: 5000, // 5 seconds between checks
            checkLimit: function(serverId) {
                const now = Date.now();
                if (this.lastCheck[serverId] && (now - this.lastCheck[serverId]) < this.minInterval) {
                    return false;
                }
                this.lastCheck[serverId] = now;
                return true;
            }
        };
                // Check server status
        async function checkServerStatus(url, onStatusUpdate = null) {
            // Check if server status checking is enabled
            if (!isServerStatusCheckEnabled()) {
                // If status checking is disabled, return warning status
                if (onStatusUpdate) onStatusUpdate('warning');
                return 'warning';
            }
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                
                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        mode: 'no-cors',
                        signal: controller.signal,
                        credentials: 'omit'
                    });
                    
                    clearTimeout(timeoutId);
                    if (onStatusUpdate) onStatusUpdate('online');
                    return 'online';
                } catch (fetchError) {
                    clearTimeout(timeoutId);
                    
                    // Get the actual error information that JavaScript can access
                    const errorName = fetchError.name || '';
                    const errorMessage = fetchError.message || '';
                    
                    // Determine server status based on actual JavaScript error types
                    if (errorName === 'TypeError' && errorMessage.includes('Failed to fetch')) {
                        // Server is reachable but request failed (certificate issues, CORS, etc.)
                        if (onStatusUpdate) onStatusUpdate('online');
                        return 'online';
                    }
                    
                    if (errorName === 'AbortError') {
                        // Request was aborted (timeout) - server not responding
                        if (onStatusUpdate) onStatusUpdate('offline');
                        return 'offline';
                    }
                    
                    // For other errors, check if they indicate server is reachable
                    if (errorMessage.includes('Failed to fetch') || 
                        errorMessage.includes('NetworkError') ||
                        errorMessage.includes('TypeError')) {
                        if (onStatusUpdate) onStatusUpdate('online');
                        return 'online';
                    }
                    
                    // Default to offline for unknown errors
                    if (onStatusUpdate) onStatusUpdate('offline');
                    return 'offline';
                }
            } catch (error) {
                return 'offline';
            }
        }

        // Get favicon for a URL
        function getFaviconUrl(url) {
            try {
                const urlObj = new URL(url);
                return `${urlObj.protocol}//${urlObj.hostname}/favicon.ico`;
            } catch (error) {
                return null;
            }
        }









        // Update server status indicator in real-time
        function updateServerStatusIndicator(serverId, status) {
            const statusDot = document.querySelector(`#server-${serverId} .status-dot`);
            if (statusDot) {
                // Remove all status classes
                statusDot.classList.remove('status-online', 'status-offline', 'status-warning', 'status-checking');
                
                // Add the appropriate status class
                statusDot.classList.add(`status-${status}`);
                
                // Add a brief animation for status changes
                statusDot.style.animation = 'none';
                setTimeout(() => {
                    statusDot.style.animation = 'pulse 2s infinite';
                }, 10);
            }
        }

        // Check individual server status with real-time updates
        async function checkIndividualServerStatus(categoryId, serverId) {
            const category = categories.find(c => c.id === categoryId);
            const server = category.servers.find(s => s.id === serverId);
            
            if (!server) return;
            
            // Check if server status checking is enabled
            if (!isServerStatusCheckEnabled()) {
                // If status checking is disabled, show warning status
                updateServerStatusIndicator(serverId, 'warning');
                server.status = 'warning';
                return;
            }
            
            // Update to checking state
            updateServerStatusIndicator(serverId, 'checking');
            
            try {
                const status = await checkServerStatus(server.url, (newStatus) => {
                    // Real-time status update callback
                    updateServerStatusIndicator(serverId, newStatus);
                });
                
                server.status = status;
                // Don't save data after individual status checking - status is only for display
            } catch (error) {
                console.error(`Error checking status for ${server.name}:`, error);
                updateServerStatusIndicator(serverId, 'offline');
            }
        }

        // Drag and Drop functionality
        let draggedElement = null;
        let draggedType = null; // 'category', 'server', or 'title'
        let draggedCategoryId = null;
        let draggedServerId = null;
        let draggedTitleId = null;

        // Initialize drag and drop
        function initDragAndDrop() {
            // Category drag and drop
            const categoriesGrid = document.getElementById('categoriesGrid');
            if (categoriesGrid) {
                categoriesGrid.addEventListener('dragover', handleDragOver);
                categoriesGrid.addEventListener('drop', handleCategoryDrop);
            }
        }

        // Handle drag over for categories
        function handleDragOver(e) {
            e.preventDefault();
            if (draggedType === 'category') {
                const categoryCards = document.querySelectorAll('.category-card:not(.dragging)');
                categoryCards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    
                    if (e.clientY < midY) {
                        card.classList.add('drag-over');
                    } else {
                        card.classList.remove('drag-over');
                    }
                });
            }
        }
        // Handle category drop
        function handleCategoryDrop(e) {
            e.preventDefault();
            if (draggedType !== 'category') {
                return;
            }
            
            const categoryCards = document.querySelectorAll('.category-card');
            const dropIndex = Array.from(categoryCards).findIndex(card => {
                const rect = card.getBoundingClientRect();
                const midY = rect.top + rect.height / 2;
                return e.clientY < midY;
            });
            
            if (dropIndex !== -1) {
                const draggedIndex = categories.findIndex(cat => cat.id === draggedCategoryId);
                
                if (draggedIndex !== -1) {
                    const [draggedCategory] = categories.splice(draggedIndex, 1);
                    categories.splice(dropIndex, 0, draggedCategory);
                    
                    saveData();
                    renderCategories();
                    showChangesNotification();
                }
            }
            
            cleanupDragState();
        }
        // Handle server/title drop
        function handleServerDrop(e, targetCategoryId) {
            e.preventDefault();
            if (draggedType !== 'server' && draggedType !== 'title') {
                return;
            }
            
            const targetCategory = categories.find(cat => cat.id === targetCategoryId);
            if (!targetCategory) return;
            
            // Initialize itemOrder if it doesn't exist
            if (!targetCategory.itemOrder) {
                targetCategory.itemOrder = [];
            }
            
            // Check if this is a reorder within the same category
            const isSameCategory = draggedCategoryId === targetCategoryId;
            
            if (draggedType === 'server') {
                // Find source category and server
                const sourceCategory = categories.find(cat => 
                    cat.servers.some(server => server.id === draggedServerId)
                );
                const sourceServer = sourceCategory?.servers.find(server => server.id === draggedServerId);
                
                if (!sourceCategory || !sourceServer) {
                    cleanupDragState();
                    return;
                }
                
                // Get all items in the target category (excluding the dragged one)
                const serverItems = document.querySelectorAll(`#category-${targetCategoryId} .server-item:not(.dragging)`);
                const titleItems = document.querySelectorAll(`#category-${targetCategoryId} .title-separator:not(.dragging)`);
                const allItems = [...serverItems, ...titleItems];
                
                // Calculate drop position
                let dropIndex = -1;
                if (allItems.length > 0) {
                    dropIndex = Array.from(allItems).findIndex(item => {
                        const rect = item.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        return e.clientY < midY;
                    });
                    
                    // If not found, drop at the end
                    if (dropIndex === -1) {
                        dropIndex = allItems.length;
                    }
                } else {
                    // Empty category - drop at position 0
                    dropIndex = 0;
                }
                
                if (isSameCategory) {
                    // Reordering within the same category - just update itemOrder
                    const currentIndex = targetCategory.itemOrder.findIndex(item => 
                        item.type === 'server' && item.id === draggedServerId
                    );
                    if (currentIndex !== -1) {
                        targetCategory.itemOrder.splice(currentIndex, 1);
                        targetCategory.itemOrder.splice(dropIndex, 0, { type: 'server', id: draggedServerId });
                        console.log(`Server "${sourceServer.name}" reordered within category "${targetCategory.name}" from position ${currentIndex} to ${dropIndex}`);
                    }
                } else {
                    // Moving between categories
                    // Remove from source category
                    const sourceServerIndex = sourceCategory.servers.findIndex(server => server.id === draggedServerId);
                    sourceCategory.servers.splice(sourceServerIndex, 1);
                    
                    // Remove from source category's itemOrder
                    if (sourceCategory.itemOrder) {
                        const sourceOrderIndex = sourceCategory.itemOrder.findIndex(item => 
                            item.type === 'server' && item.id === draggedServerId
                        );
                        if (sourceOrderIndex !== -1) {
                            sourceCategory.itemOrder.splice(sourceOrderIndex, 1);
                        }
                    }
                    
                    // Add to target category
                    targetCategory.servers.push(sourceServer);
                    
                    // Add to target category's itemOrder at the correct position
                    const newOrderItem = { type: 'server', id: draggedServerId };
                    targetCategory.itemOrder.splice(dropIndex, 0, newOrderItem);
                    
                    console.log(`Server "${sourceServer.name}" moved from category "${sourceCategory.name}" to "${targetCategory.name}" at position ${dropIndex}`);
                }
            } else if (draggedType === 'title') {
                console.log(`Dropping title ${draggedTitleId} to category ${targetCategoryId}`);
                
                // Find source category and title
                const sourceCategory = categories.find(cat => 
                    cat.titles && cat.titles.some(title => title.id === draggedTitleId)
                );
                const sourceTitle = sourceCategory?.titles.find(title => title.id === draggedTitleId);
                
                if (!sourceCategory || !sourceTitle) {
                    cleanupDragState();
                    return;
                }
                
                // Initialize titles array if it doesn't exist
                if (!targetCategory.titles) {
                    targetCategory.titles = [];
                }
                
                // Get all items in the target category (excluding the dragged one)
                const serverItems = document.querySelectorAll(`#category-${targetCategoryId} .server-item:not(.dragging)`);
                const titleItems = document.querySelectorAll(`#category-${targetCategoryId} .title-separator:not(.dragging)`);
                const allItems = [...serverItems, ...titleItems];
                
                // Calculate drop position
                let dropIndex = -1;
                if (allItems.length > 0) {
                    dropIndex = Array.from(allItems).findIndex(item => {
                        const rect = item.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        return e.clientY < midY;
                    });
                    
                    // If not found, drop at the end
                    if (dropIndex === -1) {
                        dropIndex = allItems.length;
                    }
                } else {
                    // Empty category - drop at position 0
                    dropIndex = 0;
                }
                
                if (isSameCategory) {
                    // Reordering within the same category - just update itemOrder
                    const currentIndex = targetCategory.itemOrder.findIndex(item => 
                        item.type === 'title' && item.id === draggedTitleId
                    );
                    if (currentIndex !== -1) {
                        targetCategory.itemOrder.splice(currentIndex, 1);
                        targetCategory.itemOrder.splice(dropIndex, 0, { type: 'title', id: draggedTitleId });
                        console.log(`Title "${sourceTitle.text}" reordered within category "${targetCategory.name}" from position ${currentIndex} to ${dropIndex}`);
                    }
                } else {
                    // Moving between categories
                    // Remove from source category
                    const sourceTitleIndex = sourceCategory.titles.findIndex(title => title.id === draggedTitleId);
                    sourceCategory.titles.splice(sourceTitleIndex, 1);
                    
                    // Remove from source category's itemOrder
                    if (sourceCategory.itemOrder) {
                        const sourceOrderIndex = sourceCategory.itemOrder.findIndex(item => 
                            item.type === 'title' && item.id === draggedTitleId
                        );
                        if (sourceOrderIndex !== -1) {
                            sourceCategory.itemOrder.splice(sourceOrderIndex, 1);
                        }
                    }
                    
                    // Add to target category
                    targetCategory.titles.push(sourceTitle);
                    
                    // Add to target category's itemOrder at the correct position
                    const newOrderItem = { type: 'title', id: draggedTitleId };
                    targetCategory.itemOrder.splice(dropIndex, 0, newOrderItem);
                    
                    console.log(`Title "${sourceTitle.text}" moved from category "${sourceCategory.name}" to "${targetCategory.name}" at position ${dropIndex}`);
                }
            }
            
            console.log('Updated categories:', JSON.stringify(categories, null, 2));
            
            saveData();
            renderCategories();
            showChangesNotification();
            
            cleanupDragState();
        }

        // Clean up drag state
        function cleanupDragState() {
            console.log('Cleaning up drag state');
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
            
            // Clear all drag-over states
            document.querySelectorAll('.category-card.drag-over').forEach(card => {
                card.classList.remove('drag-over');
            });
            
            document.querySelectorAll('.server-item.drag-over').forEach(item => {
                item.classList.remove('drag-over');
            });
            
            document.querySelectorAll('.server-list.drag-over').forEach(list => {
                list.classList.remove('drag-over');
            });
            
            document.querySelectorAll('.title-separator.drag-over').forEach(item => {
                item.classList.remove('drag-over');
            });
            
            draggedType = null;
            draggedCategoryId = null;
            draggedServerId = null;
            draggedTitleId = null;
            console.log('Drag state cleaned up');
        }

        // Category drag event handlers
        function handleCategoryDragStart(event, categoryId) {
            // Find the category card element (parent of the drag handle)
            const categoryElement = event.target.closest('.category-card');
            
            if (!categoryElement) {
                console.error('Could not find category card element');
                return;
            }
            
            draggedElement = categoryElement;
            draggedType = 'category';
            draggedCategoryId = categoryId;
            draggedElement.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            
            console.log(`Started dragging category ${categoryId}`);
        }

        function handleCategoryDragEnd(event) {
            console.log('Category drag end event triggered');
            cleanupDragState();
        }

        // Server drag event handlers
        function handleServerDragStart(event, serverId, categoryId) {
            // Find the server item element (parent of the drag handle)
            const serverElement = event.target.closest('.server-item');
            
            if (!serverElement) {
                console.error('Could not find server item element');
                return;
            }
            
            draggedElement = serverElement;
            draggedType = 'server';
            draggedServerId = serverId;
            draggedCategoryId = categoryId;
            draggedElement.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            
            console.log(`Started dragging server ${serverId} from category ${categoryId}`);
        }

        function handleServerDragEnd(event) {
            console.log('Server drag end event triggered');
            cleanupDragState();
        }

        // Title drag event handlers
        function handleTitleDragStart(event, titleId, categoryId) {
            // Find the title item element (parent of the drag handle)
            const titleElement = event.target.closest('.title-separator');
            
            if (!titleElement) {
                console.error('Could not find title item element');
                return;
            }
            
            draggedElement = titleElement;
            draggedType = 'title';
            draggedTitleId = titleId;
            draggedCategoryId = categoryId;
            draggedElement.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            
            console.log(`Started dragging title ${titleId} from category ${categoryId}`);
        }

        function handleTitleDragEnd(event) {
            console.log('Title drag end event triggered');
            cleanupDragState();
        }
        function handleServerDragOver(event, categoryId) {
            event.preventDefault();
            if (draggedType === 'server' || draggedType === 'title') {
                console.log(`${draggedType} drag over event for category ${categoryId}`);
                
                // Clear all drag-over states first
                document.querySelectorAll('.server-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                document.querySelectorAll('.title-separator.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                document.querySelectorAll('.category-card.drag-over').forEach(card => {
                    card.classList.remove('drag-over');
                });
                
                const serverItems = document.querySelectorAll(`#category-${categoryId} .server-item:not(.dragging)`);
                const titleItems = document.querySelectorAll(`#category-${categoryId} .title-separator:not(.dragging)`);
                const allItems = [...serverItems, ...titleItems];
                const serverList = document.querySelector(`#category-${categoryId} .server-list`);
                
                if (allItems.length === 0) {
                    // If no items in category, show drop zone on the server list container
                    if (serverList) {
                        serverList.classList.add('drag-over');
                    }
                    return;
                }
                
                // Find the appropriate drop position
                let foundDropZone = false;
                allItems.forEach((item, index) => {
                    const rect = item.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    
                    if (event.clientY < midY && !foundDropZone) {
                        item.classList.add('drag-over');
                        foundDropZone = true;
                    }
                });
                
                // If no drop zone found, add to the last item
                if (!foundDropZone && allItems.length > 0) {
                    allItems[allItems.length - 1].classList.add('drag-over');
                }
            }
        }

        // Share functionality (website click data is intentionally excluded to keep it local only)
        function shareDashboard() {
            // Create data object with all current setup
            const shareData = {
                categories: categories,
                headerTitle: headerTitle,
                headerSubtitle: headerSubtitle,
                headerTitleColor: localStorage.getItem('headerTitleColor') || '#3b82f6',
                headerSubtitleColor: localStorage.getItem('headerSubtitleColor') || '#6b7280',
                currentLanguage: currentLanguage,
                socialMediaLinks: socialMediaLinks,
                settings: {
                    googleAnalyticsCode: localStorage.getItem('googleAnalyticsCode') || '',
                    showSocialMediaBar: localStorage.getItem('showSocialMediaBar') === 'true',
                    serverStatusCheckEnabled: localStorage.getItem('serverStatusCheckEnabled') !== 'false',
                    openLinksInNewTab: localStorage.getItem('openLinksInNewTab') !== 'false'
                }
                // Note: websiteClickData is intentionally excluded to keep popular/recent data local only
            };
            
            // Encode the data using LZString compression for better handling of special characters
            const jsonString = JSON.stringify(shareData);
            const encodedData = LZString.compressToEncodedURIComponent(jsonString);
            
            // Debug: Log encoding info
            console.log('üîß Encoding data:', {
                originalLength: jsonString.length,
                encodedLength: encodedData.length,
                compressionRatio: ((1 - encodedData.length / jsonString.length) * 100).toFixed(1) + '%'
            });
            
            // Create the long URL
            const currentUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${currentUrl}?parameters=${encodedData}`;
            
            // Show share options modal
            showShareOptionsModal(shareUrl);
        }

        // Show share options modal
        function showShareOptionsModal(shareUrl) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('shareOptionsModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'shareOptionsModal';
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal" onclick="event.stopPropagation()" dir="auto">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <button class="btn btn-ghost" onclick="hideShareOptionsModal()" title="◊°◊í◊ô◊®◊î">‚úï</button>
                            <h3>${t('shareOptionsModalTitle')}</h3>
                            <div style="width: 2rem;"></div>
                        </div>
                        <p style="margin-bottom: 1.5rem;">${t('shareOptionsModalText')}</p>
                        <div class="modal-actions">
                            <button class="btn btn-primary" data-icon="üíæ" onclick="saveConfigurationFromShareModal()">${currentLanguage === 'he' ? '◊©◊û◊ô◊®◊î ◊ú◊ß◊ï◊ë◊•' : 'Save to File'}</button>
                            <button class="btn btn-secondary" data-icon="üìã" onclick="copyShareUrl('${shareUrl}')">${t('copyShareUrl')}</button>
                            <button class="btn btn-secondary" data-icon="üì§" onclick="triggerNativeShare('${shareUrl}')">${currentLanguage === 'he' ? '◊©◊ô◊™◊ï◊£ ◊õ◊™◊ï◊ë◊™  ◊ô◊ó◊ï◊ì◊ô◊™' : 'Share unique URL'}</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Add click outside to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        hideShareOptionsModal();
                    }
                });
            }
            
            modal.classList.remove('hidden');
        }

        // Hide share options modal
        function hideShareOptionsModal() {
            const modal = document.getElementById('shareOptionsModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Trigger native share
        function triggerNativeShare(shareUrl) {
            if (navigator.share) {
                showSharingWarning();
                navigator.share({
                    title: headerTitle,
                    text: headerSubtitle,
                    url: shareUrl
                }).catch(err => {
                    console.log('Share failed:', err);
                    // Show error message
                    showShareError();
                });
            } else {
                // Fallback for browsers that don't support native sharing
                showShareError();
            }
        }
        // Show share error
        function showShareError() {
            const shareModal = document.getElementById('shareOptionsModal');
            if (shareModal) {
                // Create or update error alert in the modal
                let errorAlert = shareModal.querySelector('.share-error-alert');
                if (!errorAlert) {
                    errorAlert = document.createElement('div');
                    errorAlert.className = 'share-error-alert';
                    errorAlert.style.cssText = `
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                        color: white;
                        padding: 0.75rem 1rem;
                        border-radius: 0.5rem;
                        margin-bottom: 1rem;
                        border: 1px solid #ef4444;
                        font-size: 0.875rem;
                        text-align: center;
                    `;
                    
                    // Insert at the top of the modal content
                    const modalContent = shareModal.querySelector('.modal');
                    modalContent.insertBefore(errorAlert, modalContent.firstChild);
                }
                
                errorAlert.textContent = t('shareErrorHttps');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    if (errorAlert && errorAlert.parentNode) {
                        errorAlert.remove();
                    }
                }, 5000);
            }
        }
        // Show sharing warning
        function showSharingWarning() {
            const shareModal = document.getElementById('shareOptionsModal');
            if (shareModal) {
                // Create or update warning alert in the modal
                let warningAlert = shareModal.querySelector('.share-warning-alert');
                if (!warningAlert) {
                    warningAlert = document.createElement('div');
                    warningAlert.className = 'share-warning-alert';
                    warningAlert.style.cssText = `
                        background: linear-gradient(135deg, #f59e0b, #d97706);
                        color: white;
                        padding: 0.75rem 1rem;
                        border-radius: 0.5rem;
                        margin-bottom: 1rem;
                        border: 1px solid #f59e0b;
                        font-size: 0.875rem;
                        text-align: center;
                    `;
                    
                    // Insert at the top of the modal content
                    const modalContent = shareModal.querySelector('.modal');
                    modalContent.insertBefore(warningAlert, modalContent.firstChild);
                }
                
                warningAlert.textContent = t('sharingWarning');
                
                // Auto-hide after 8 seconds
                setTimeout(() => {
                    if (warningAlert && warningAlert.parentNode) {
                        warningAlert.remove();
                    }
                }, 8000);
            }
        }

        // Save configuration from share modal
        function saveConfigurationFromShareModal() {
            showSharingWarning();
            exportConfig();
            // Don't close the modal, just download the file
        }



        // Copy share URL (legacy function for backward compatibility)
        function copyShareUrl(url) {
            showSharingWarning();
            copyUrlToClipboard(url, null);
            // Show feedback
            const copyBtn = document.querySelector('#shareOptionsModal .btn-secondary[onclick*="copyShareUrl"]');
            if (copyBtn) {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = currentLanguage === 'he' ? '◊î◊ï◊¢◊™◊ß!' : 'Copied!';
                copyBtn.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                copyBtn.style.color = 'white';
                copyBtn.style.borderColor = '#22c55e';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '';
                    copyBtn.style.color = '';
                    copyBtn.style.borderColor = '';
                }, 1500);
            }
        }

        // Check if page was loaded with parameters
        function checkForSharedParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const longParam = urlParams.get('parameters');
            
            if (longParam) {
                try {
                    // Improved decoding logic to handle URI malformed errors
                    let jsonString;
                                    try {
                    // Try LZString decompression first (new approach)
                    console.log('üîß Attempting LZString decompression...');
                    jsonString = LZString.decompressFromEncodedURIComponent(longParam);
                    if (!jsonString) {
                        throw new Error('LZString decompression returned null');
                    }
                    console.log('‚úÖ LZString decompression successful, data length:', jsonString.length);
                } catch (lzError) {
                    console.warn('LZString decompression failed, trying legacy base64 approach:', lzError);
                    try {
                        // Legacy approach: try base64 decoding
                        jsonString = decodeURIComponent(escape(atob(longParam)));
                    } catch (decodeError) {
                        console.warn('Legacy decode also failed, trying alternative approach:', decodeError);
                        try {
                            // Alternative approach: handle the base64 directly
                            const binaryString = atob(longParam);
                            jsonString = decodeURIComponent(Array.prototype.map.call(binaryString, function(c) {
                                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                            }).join(''));
                        } catch (alternativeError) {
                            console.warn('Alternative decode also failed, trying direct approach:', alternativeError);
                            // Last resort: try direct base64 decode
                            jsonString = atob(longParam);
                        }
                    }
                }
                    
                    const sharedData = secureJsonParse(jsonString);
                    
                    // Validate the shared data
                    if (validateImportedData(sharedData)) {
                        // Load the shared data
                        loadSharedData(sharedData);
                        return true;
                    }
                } catch (error) {
                    console.error('Failed to parse long parameters:', error);
                    console.error('Parameter length:', longParam ? longParam.length : 0);
                    console.error('Parameter preview:', longParam ? longParam.substring(0, 100) + '...' : 'null');
                }
            }
            
            return false;
        }

        // Load shared data
        function loadSharedData(sharedData) {
            // Update the data
            categories = sharedData.categories || categories;
            headerTitle = sharedData.headerTitle || headerTitle;
            headerSubtitle = sharedData.headerSubtitle || headerSubtitle;
            
            // Load social media links if they exist
            if (sharedData.socialMediaLinks) {
                // Validate and sanitize SVG content for each link
                socialMediaLinks = sharedData.socialMediaLinks.map(link => ({
                    ...link,
                    svg: validateAndSanitizeSvg(link.svg)
                }));
                // Debug: Log social media links being loaded from URL
                console.log('üîß Loading social media links from URL:', socialMediaLinks);
                socialMediaLinks.forEach((link, index) => {
                    console.log(`üîß URL link ${index}:`, { name: link.name, url: link.url, svg: link.svg ? link.svg.substring(0, 100) + '...' : 'NO SVG' });
                });
            }
            
            // Load settings if they exist
            if (sharedData.settings) {
                if (sharedData.settings.googleAnalyticsCode !== undefined) {
                    localStorage.setItem('googleAnalyticsCode', sharedData.settings.googleAnalyticsCode);
                }
                if (sharedData.settings.showSocialMediaBar !== undefined) {
                    localStorage.setItem('showSocialMediaBar', sharedData.settings.showSocialMediaBar.toString());
                }
                if (sharedData.settings.serverStatusCheckEnabled !== undefined) {
                    localStorage.setItem('serverStatusCheckEnabled', sharedData.settings.serverStatusCheckEnabled.toString());
                }
            }
            
            // Apply header colors if they exist
            if (sharedData.headerTitleColor) {
                localStorage.setItem('headerTitleColor', sharedData.headerTitleColor);
            }
            if (sharedData.headerSubtitleColor) {
                localStorage.setItem('headerSubtitleColor', sharedData.headerSubtitleColor);
            }
            if (sharedData.currentLanguage) {
                setLanguage(sharedData.currentLanguage);
            }
            
            // Initialize status indicators for all servers (default to offline)
            categories.forEach(category => {
                category.servers.forEach(server => {
                    if (!server.status) {
                        server.status = 'offline';
                    }
                });
            });
            
            // Update the export button to show "Save to Local"
            updateExportButtonForSharedMode();
            
            // Store initial data for comparison
            initialData = {
                categories: categories,
                headerTitle: headerTitle,
                headerSubtitle: headerSubtitle,
                socialMediaLinks: socialMediaLinks
            };
            
            // Render social media bar after loading data
            renderSocialMediaBar();
            
            // Check all server statuses if enabled (for shared data)
            if (isServerStatusCheckEnabled()) {
                setTimeout(() => {
                    checkAllServerStatuses();
                }, 500);
            }
            
            // Ensure shared mode warning shows after all operations
            setTimeout(() => {
                showSharedModeWarning();
            }, 100);
            
            console.log('‚úÖ Shared data loaded successfully');
        }

        // Update export button for shared mode
        function updateExportButtonForSharedMode() {
            const editBtn = document.getElementById('editModeToggle');
            
            // Hide edit button in shared mode
            if (editBtn) {
                editBtn.style.display = 'none';
            }
        }

        // Show shared mode warning
        function showSharedModeWarning() {
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const originalUrl = window.location.pathname;
                const warningText = t('sharedModeWarning').replace('ORIGINAL_URL', originalUrl);
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + warningText;
                notification.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                notification.style.color = 'white';
                notification.style.borderColor = '#f59e0b';
                notification.classList.add('show');
            }
        }

        // Save shared data to local storage
        function saveSharedDataToLocal() {
            // Save current data to localStorage
            saveData();
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show success notification
            const notification = document.getElementById('changesNotification');
            if (notification) {
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + t('savedToLocalSuccess');
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                // Auto-hide success notification after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Show edit button after local saving
            const editBtn = document.getElementById('editModeToggle');
            if (editBtn) {
                editBtn.style.display = '';
            }
            
            // Remove parameters from URL
            const newUrl = window.location.pathname;
            window.history.replaceState({}, '', newUrl);
        }
        // Initialize app
        async function init() {
            await loadData();
            
            // Initialize theme
            initTheme();
            
            // Load saved language
            const savedLang = localStorage.getItem('dashboardLanguage') || 'en';
            setLanguage(savedLang);
            
            // Load and apply settings
            loadAndApplySettings();
            
            // Initialize filter
            filteredCategories = categories;
            renderCategories();
            
            // Check all server statuses if enabled (after categories are rendered)
            if (isServerStatusCheckEnabled()) {
                // Delay the status check slightly to ensure the UI is fully loaded
                setTimeout(() => {
                    checkAllServerStatuses();
                }, 1000);
            }
            
            // Add search input event listener
            document.getElementById('filterInput').addEventListener('input', filterItems);
            
            // Add mobile search functionality
            const mobileFilterInput = document.getElementById('mobileFilterInput');
            if (mobileFilterInput) {
                mobileFilterInput.addEventListener('input', function() {
                    document.getElementById('filterInput').value = this.value;
                    filterItems();
                });
            }
            
            // Add keyboard event listeners for modals
            document.addEventListener('keydown', handleModalKeyboard);
            
            // Initialize drag and drop
            initDragAndDrop();
            

            
            // Generate modals dynamically
            generateModals();
            
            // Generate icon grids after modals are created
            generateAllIconGrids();
            
            // Generate Google Analytics inputs
            generateGoogleAnalyticsInputs();
            

            
            // Render social media bar
            renderSocialMediaBar();
            
            // Update status indicators based on server status check setting
            updateAllStatusIndicators();
            
            // Check all server statuses if enabled
            if (isServerStatusCheckEnabled()) {
                // Delay the status check slightly to ensure the UI is fully loaded
                setTimeout(() => {
                    checkAllServerStatuses();
                }, 500);
            }
        }

                    function loadAndApplySettings() {
                // Load Google Analytics settings
                const analyticsCode = localStorage.getItem('googleAnalyticsCode') || '';
                if (analyticsCode) {
                    updateGoogleAnalytics(analyticsCode);
                }
                
                // Load social media bar visibility settings
                const showSocialBar = localStorage.getItem('showSocialMediaBar') === 'true'; // Default to false
                updateSocialMediaBarVisibility(showSocialBar);
                
                // Load server status check setting
                const serverStatusCheckEnabled = localStorage.getItem('serverStatusCheckEnabled') !== 'false'; // Default to true
                updateServerStatusCheckToggle(serverStatusCheckEnabled);
                
                // Load most used websites setting
            const mostUsedWebsitesEnabled = localStorage.getItem('mostUsedWebsitesEnabled') !== 'false'; // Default to true
            const openLinksInNewTab = localStorage.getItem('openLinksInNewTab') !== 'false'; // Default to true
            
            // Update menu items with a small delay to ensure they're rendered
            setTimeout(() => {
                updateMostUsedWebsitesToggle(mostUsedWebsitesEnabled);
                updateOpenLinksInNewTabToggle(openLinksInNewTab);
                updateSocialMediaIconToggle(showSocialBar);
            }, 100);
                
                // Update status indicators based on setting
                updateAllStatusIndicators();
                
                // Update Google Analytics input fields to show masked values if GA is loaded
                updateGoogleAnalyticsInputFields();
                
                // Ensure mobile menu input fields are also updated
                setTimeout(() => {
                    updateGoogleAnalyticsInputFields();
                }, 100);
        }

        // Server Status Check Functions
        function toggleServerStatusCheck() {
            const currentState = localStorage.getItem('serverStatusCheckEnabled') !== 'false'; // Default to true
            const newState = !currentState;
            
            // Save to localStorage immediately
            localStorage.setItem('serverStatusCheckEnabled', newState ? 'true' : 'false');
            
            // Update toggle switches
            updateServerStatusCheckToggle(newState);
            
            // Update status indicators based on new setting
            updateAllStatusIndicators();
            
            // If enabling status checking, perform the checks
            if (newState) {
                setTimeout(() => {
                    checkAllServerStatuses();
                }, 100);
            }
        }

        function toggleMostUsedWebsites() {
            const currentState = localStorage.getItem('mostUsedWebsitesEnabled') !== 'false'; // Default to true
            const newState = !currentState;
            
            // Save to localStorage immediately
            localStorage.setItem('mostUsedWebsitesEnabled', newState ? 'true' : 'false');
            
            // Update toggle switches
            updateMostUsedWebsitesToggle(newState);
            
            // Re-render categories to show/hide most used category
            renderCategories();
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show notification
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = newState ? 
                    (currentLanguage === 'he' ? '◊ß◊ò◊í◊ï◊®◊ô◊ô◊™ ◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù ◊û◊ï◊§◊¢◊ú◊™' : 'Most used websites enabled') :
                    (currentLanguage === 'he' ? '◊ß◊ò◊í◊ï◊®◊ô◊ô◊™ ◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù ◊û◊ï◊©◊ë◊™◊™' : 'Most used websites disabled');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        function toggleMostUsedWebsitesMode() {
            const currentMode = localStorage.getItem('mostUsedWebsitesMode') || 'popular';
            const newMode = currentMode === 'popular' ? 'recent' : 'popular';
            
            // Save to localStorage immediately
            localStorage.setItem('mostUsedWebsitesMode', newMode);
            
            // Re-render categories to update the display
            renderCategories();
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show notification
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = newMode === 'recent' ? 
                    (currentLanguage === 'he' ? '◊û◊ï◊¶◊í◊ô◊ù ◊ë◊©◊ô◊û◊ï◊© ◊ú◊ê◊ó◊®◊ï◊†◊î' : 'Showing most recent websites') :
                    (currentLanguage === 'he' ? '◊û◊ï◊¶◊í◊ô◊ù ◊ê◊™◊®◊ô◊ù ◊§◊ï◊§◊ï◊ú◊®◊ô◊ô◊ù' : 'Showing most popular websites');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
                notification.style.color = 'white';
                notification.style.borderColor = '#3b82f6';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }
        function toggleOpenLinksInNewTab() {
            const currentState = localStorage.getItem('openLinksInNewTab') !== 'false'; // Default to true
            const newState = !currentState;
            
            // Save to localStorage immediately
            localStorage.setItem('openLinksInNewTab', newState ? 'true' : 'false');
            
            // Update toggle switches
            updateOpenLinksInNewTabToggle(newState);
            
            // Close both mobile and desktop menus so the user can see the alert
            closeAllMenus();
            
            // Show notification
            const notification = document.getElementById('changesNotification');
            if (notification) {
                const message = newState ? 
                    (currentLanguage === 'he' ? '◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ô◊ô◊§◊™◊ó◊ï ◊ë◊ò◊ê◊ë ◊ó◊ì◊©' : 'Links will open in new tab') :
                    (currentLanguage === 'he' ? '◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ô◊ô◊§◊™◊ó◊ï ◊ë◊ê◊ï◊™◊ï ◊ò◊ê◊ë' : 'Links will open in same tab');
                
                notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                notification.style.color = 'white';
                notification.style.borderColor = '#22c55e';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        function updateServerStatusCheckToggle(enabled) {
            const desktopText = document.getElementById('desktopServerStatusCheck');
            const mobileText = document.getElementById('mobileServerStatusCheck');
            const desktopIcon = document.querySelector('#desktopServerStatusCheckItem .desktop-menu-item-icon');
            const mobileIcon = document.querySelector('#mobileServerStatusCheckItem .mobile-menu-item-icon');
            
            if (desktopText) {
                desktopText.textContent = enabled ? t('disableWebsiteCheck') : t('showWebsitesStatus');
            }
            
            if (mobileText) {
                mobileText.textContent = enabled ? t('disableWebsiteCheck') : t('showWebsitesStatus');
            }

            // Update icon styling
            if (desktopIcon) {
                if (enabled) {
                    desktopIcon.classList.remove('disabled');
                } else {
                    desktopIcon.classList.add('disabled');
                }
            }
            
            if (mobileIcon) {
                if (enabled) {
                    mobileIcon.classList.remove('disabled');
                } else {
                    mobileIcon.classList.add('disabled');
                }
            }
        }

        function updateMostUsedWebsitesToggle(enabled) {
            const desktopText = document.getElementById('desktopMostUsedWebsites');
            const mobileText = document.getElementById('mobileMostUsedWebsites');
            const desktopIcon = document.querySelector('#desktopMostUsedWebsitesItem .desktop-menu-item-icon');
            const mobileIcon = document.querySelector('#mobileMostUsedWebsitesItem .mobile-menu-item-icon');
            

            
            if (desktopText) {
                const text = enabled ? t('hideMostUsedWebsites') : t('showMostUsedWebsites');
                desktopText.textContent = text;
            }
            
            if (mobileText) {
                const text = enabled ? t('hideMostUsedWebsites') : t('showMostUsedWebsites');
                mobileText.textContent = text;
            }

            // Update icon styling
            if (desktopIcon) {
                if (enabled) {
                    desktopIcon.classList.remove('disabled');
                } else {
                    desktopIcon.classList.add('disabled');
                }
            }
            
            if (mobileIcon) {
                if (enabled) {
                    mobileIcon.classList.remove('disabled');
                } else {
                    mobileIcon.classList.add('disabled');
                }
            }
        }

        function updateOpenLinksInNewTabToggle(enabled) {
            const desktopText = document.getElementById('desktopOpenLinksInNewTab');
            const mobileText = document.getElementById('mobileOpenLinksInNewTab');
            const desktopIcon = document.querySelector('#desktopOpenLinksInNewTabItem .desktop-menu-item-icon');
            const mobileIcon = document.querySelector('#mobileOpenLinksInNewTabItem .mobile-menu-item-icon');
            
            if (desktopText) {
                const text = enabled ? t('openLinksInSameTab') : t('openLinksInNewTab');
                desktopText.textContent = text;
            }
            
            if (mobileText) {
                const text = enabled ? t('openLinksInSameTab') : t('openLinksInNewTab');
                mobileText.textContent = text;
            }

            // Update icon styling
            if (desktopIcon) {
                if (enabled) {
                    desktopIcon.classList.remove('disabled');
                } else {
                    desktopIcon.classList.add('disabled');
                }
            }
            
            if (mobileIcon) {
                if (enabled) {
                    mobileIcon.classList.remove('disabled');
                } else {
                    mobileIcon.classList.add('disabled');
                }
            }
        }

        function updateSocialMediaIconToggle(visible) {
            const desktopIcon = document.querySelector('#desktopSocialMediaIcon');
            const mobileIcon = document.querySelector('#mobileSocialMediaIcon');
            
            // Update icon styling
            if (desktopIcon) {
                if (visible) {
                    desktopIcon.classList.remove('disabled');
                } else {
                    desktopIcon.classList.add('disabled');
                }
            }
            
            if (mobileIcon) {
                if (visible) {
                    mobileIcon.classList.remove('disabled');
                } else {
                    mobileIcon.classList.add('disabled');
                }
            }
        }

        function updateAllStatusIndicators() {
            const statusCheckEnabled = localStorage.getItem('serverStatusCheckEnabled') !== 'false'; // Default to true
            
            // Get all status dots
            const statusDots = document.querySelectorAll('.status-dot');
            
            statusDots.forEach(statusDot => {
                if (!statusCheckEnabled) {
                    // When status checking is disabled, show all indicators as yellow (warning)
                    statusDot.classList.remove('status-online', 'status-offline', 'status-checking');
                    statusDot.classList.add('status-warning');
                } else {
                    // When status checking is enabled, keep current status or default to offline
                    if (!statusDot.classList.contains('status-online') && 
                        !statusDot.classList.contains('status-offline') && 
                        !statusDot.classList.contains('status-checking')) {
                        statusDot.classList.add('status-offline');
                    }
                }
            });
        }

        function isServerStatusCheckEnabled() {
            return localStorage.getItem('serverStatusCheckEnabled') !== 'false'; // Default to true
        }

        function isMostUsedWebsitesEnabled() {
            return localStorage.getItem('mostUsedWebsitesEnabled') !== 'false'; // Default to true
        }

        // Track website click for most used websites
        function trackWebsiteClick(serverId, serverName, serverUrl, categoryId, categoryName) {
            if (!isMostUsedWebsitesEnabled()) {
                return; // Don't track if feature is disabled
            }
            
            const clickData = localStorage.getItem('websiteClickData') || '{}';
            const clickCounts = JSON.parse(clickData);
            
            // Create a unique key for this website
            const websiteKey = `${serverId}_${serverName}_${serverUrl}`;
            
            // Get current timestamp
            const currentTime = Date.now();
            
            // Find the actual website to get its border color
            const category = categories.find(c => c.id === categoryId);
            let websiteBorderColor = '#f59e0b'; // Default fallback
            
            if (category) {
                const server = category.servers.find(s => s.id === serverId);
                if (server) {
                    websiteBorderColor = server.borderColor || getCategoryBorderColor(categoryId);
                }
            }
            
            // Update or create website data
            if (clickCounts[websiteKey]) {
                clickCounts[websiteKey].count = (clickCounts[websiteKey].count || 0) + 1;
                clickCounts[websiteKey].lastVisit = currentTime;
            } else {
                clickCounts[websiteKey] = {
                    count: 1,
                    firstVisit: currentTime,
                    lastVisit: currentTime,
                    categoryId: categoryId,
                    categoryName: categoryName,
                    originalBorderColor: websiteBorderColor
                };
            }
            
            // Keep only the 20 most recent websites (remove oldest if more than 20)
            const websiteEntries = Object.entries(clickCounts);
            if (websiteEntries.length > 20) {
                // Sort by last visit time and remove oldest
                const sortedByLastVisit = websiteEntries.sort((a, b) => 
                    (b[1].lastVisit || 0) - (a[1].lastVisit || 0)
                );
                
                // Keep only the 20 most recent
                const newClickCounts = {};
                sortedByLastVisit.slice(0, 20).forEach(([key, data]) => {
                    newClickCounts[key] = data;
                });
                
                localStorage.setItem('websiteClickData', JSON.stringify(newClickCounts));
            } else {
                localStorage.setItem('websiteClickData', JSON.stringify(clickCounts));
            }
        }

        // Get most used websites (by click count)
        function getMostUsedWebsites() {
            if (!isMostUsedWebsitesEnabled()) {
                return [];
            }
            
            const clickData = localStorage.getItem('websiteClickData') || '{}';
            const clickCounts = JSON.parse(clickData);
            
            // Convert to array and sort by click count
            const websites = Object.entries(clickCounts)
                .map(([key, data]) => {
                    const [serverId, serverName, serverUrl] = key.split('_', 3);
                    return {
                        id: serverId,
                        name: serverName,
                        url: serverUrl,
                        clickCount: data.count || 0,
                        lastVisit: data.lastVisit || 0,
                        categoryId: data.categoryId,
                        categoryName: data.categoryName,
                        originalBorderColor: data.originalBorderColor || '#f59e0b'
                    };
                })
                .sort((a, b) => b.clickCount - a.clickCount)
                .slice(0, 10); // Top 10 most used
            
            return websites;
        }

        // Get category border color
        function getCategoryBorderColor(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            return category ? category.borderColor : '#f59e0b';
        }

        // Format time display for Most Used Websites
        function formatTimeDisplay(timestamp) {
            const now = Date.now();
            const timeDiff = now - timestamp;
            const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds
            
            if (timeDiff < oneDay) {
                // Within 24 hours, show time in HH:MM format
                const date = new Date(timestamp);
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${hours}:${minutes}`;
            } else {
                // More than 24 hours, show "before X days"
                const days = Math.floor(timeDiff / oneDay);
                return `before ${days} days`;
            }
        }
        // Remove website from Most Used Websites and reset its count
        function removeWebsiteFromMostUsed(serverId, serverName, serverUrl) {
            if (!isMostUsedWebsitesEnabled()) {
                return;
            }
            
            // Get current click data
            const clickData = localStorage.getItem('websiteClickData') || '{}';
            const clickCounts = JSON.parse(clickData);
            
            // Create the website key to find and remove
            const websiteKey = `${serverId}_${serverName}_${serverUrl}`;
            
            // Remove the website from localStorage
            if (clickCounts[websiteKey]) {
                delete clickCounts[websiteKey];
                localStorage.setItem('websiteClickData', JSON.stringify(clickCounts));
                
                // Show notification
                const notification = document.getElementById('changesNotification');
                if (notification) {
                    const message = currentLanguage === 'he' ? 
                        `◊î◊ê◊™◊® "${serverName}" ◊î◊ï◊°◊® ◊û◊î◊®◊©◊ô◊û◊î` : 
                        `"${serverName}" removed from list`;
                    notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + message;
                    notification.classList.add('show');
                }
                
                // Re-render categories to update the display
                setTimeout(() => {
                    renderCategories();
                }, 100);
            }
        }

        // Find the title that appears above a server in its original category
        function findTitleAboveServer(serverId, categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category || !category.itemOrder) return null;
            
            let titleAbove = null;
            let foundServer = false;
            
            // Go through itemOrder to find the title above this server
            for (let i = 0; i < category.itemOrder.length; i++) {
                const item = category.itemOrder[i];
                
                if (item.type === 'title') {
                    const title = category.titles.find(t => t.id === item.id);
                    if (title) {
                        titleAbove = title;
                    }
                } else if (item.type === 'server' && item.id === serverId) {
                    foundServer = true;
                    break; // Found the server, stop looking
                }
            }
            
            return foundServer ? titleAbove : null;
        }

        // Group websites by category and title for combined display
        function groupWebsitesByCategoryAndTitle(websites) {
            const groups = {};
            
            websites.forEach(website => {
                const categoryName = website.categoryName || 'Unknown';
                const websiteName = website.name;
                
                // Find the title above this website in its original category
                const titleAbove = findTitleAboveServer(website.id, website.categoryId);
                const titleText = titleAbove ? titleAbove.text : null;
                const titleColor = titleAbove ? titleAbove.textColor : null;
                
                // Create combined title
                const combinedTitle = titleText ? 
                    `${categoryName} - ${titleText}` : 
                    categoryName;
                
                // Create key based on combined title and website name
                const key = `${combinedTitle}-${websiteName}`;
                
                if (!groups[key]) {
                    // Get the actual category border color
                    const category = categories.find(c => c.id === website.categoryId);
                    const categoryBorderColor = category ? category.borderColor : '#f59e0b';
                    
                    groups[key] = {
                        categoryName: categoryName,
                        titleText: titleText,
                        titleColor: titleColor,
                        combinedTitle: combinedTitle,
                        categoryBorderColor: categoryBorderColor,
                        websites: [],
                        displayName: websiteName
                    };
                }
                
                groups[key].websites.push(website);
            });
            
            // Convert to array and sort by the first website's criteria (most recent or most popular)
            const isMostRecentMode = localStorage.getItem('mostUsedWebsitesMode') === 'recent';
            return Object.values(groups).sort((a, b) => {
                if (isMostRecentMode) {
                    return b.websites[0].lastVisit - a.websites[0].lastVisit;
                } else {
                    return b.websites[0].clickCount - a.websites[0].clickCount;
                }
            }).slice(0, 10); // Keep top 10 groups
        }

        // Get most recent websites (by last visit time)
        function getMostRecentWebsites() {
            if (!isMostUsedWebsitesEnabled()) {
                return [];
            }
            
            const clickData = localStorage.getItem('websiteClickData') || '{}';
            const clickCounts = JSON.parse(clickData);
            
            // Convert to array and sort by last visit time
            const websites = Object.entries(clickCounts)
                .map(([key, data]) => {
                    const [serverId, serverName, serverUrl] = key.split('_', 3);
                    return {
                        id: serverId,
                        name: serverName,
                        url: serverUrl,
                        clickCount: data.count || 0,
                        lastVisit: data.lastVisit || 0,
                        categoryId: data.categoryId,
                        categoryName: data.categoryName,
                        originalBorderColor: data.originalBorderColor || '#f59e0b'
                    };
                })
                .sort((a, b) => b.lastVisit - a.lastVisit)
                .slice(0, 10); // Top 10 most recent
            
            return websites;
        }

        // Check all server statuses
        async function checkAllServerStatuses() {
            if (!isServerStatusCheckEnabled()) {
                // If status checking is disabled, show all as warning
                updateAllStatusIndicators();
                return;
            }

            console.log('üîç Starting server status checks...');
            
            // Get all servers from all categories
            const allServers = [];
            categories.forEach(category => {
                category.servers.forEach(server => {
                    allServers.push({
                        categoryId: category.id,
                        serverId: server.id,
                        server: server
                    });
                });
            });

            // Check each server status with a small delay to avoid overwhelming
            for (let i = 0; i < allServers.length; i++) {
                const { categoryId, serverId, server } = allServers[i];
                
                // Update to checking state
                updateServerStatusIndicator(serverId, 'checking');
                
                try {
                    const status = await checkServerStatus(server.url, (newStatus) => {
                        // Real-time status update callback
                        updateServerStatusIndicator(serverId, newStatus);
                    });
                    
                    server.status = status;
                    
                    // Add a small delay between checks to avoid overwhelming the network
                    if (i < allServers.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                            } catch (error) {
                updateServerStatusIndicator(serverId, 'offline');
                server.status = 'offline';
            }
            }
            
            console.log('‚úÖ Server status checks completed');
        }
        // Handle keyboard events for modals and search
        function handleModalKeyboard(event) {
            if (event.key === 'Escape') {
                event.preventDefault();
                event.stopPropagation(); // Prevent other handlers from processing
                
                // Check if any modal is visible
                const visibleModal = document.querySelector('.modal-overlay:not(.hidden)');
                
                if (visibleModal) {
                    // Close modal without saving
                    if (visibleModal.id === 'addCategoryModal') {
                        hideAddCategoryModal();
                    } else if (visibleModal.id === 'editCategoryModal') {
                        hideEditCategoryModal();
                    } else if (visibleModal.id === 'editServerModal') {
                        hideEditServerModal();
                    } else if (visibleModal.id === 'editTitleModal') {
                        hideEditTitleModal();
                    } else if (visibleModal.id === 'editHeaderModal') {
                        hideEditHeaderModal();
                    } else if (visibleModal.id === 'protocolSelectionModal') {
                        hideProtocolSelectionModal();
                    } else if (visibleModal.id === 'shareOptionsModal') {
                        hideShareOptionsModal();
                    } else if (visibleModal.id === 'socialMediaModal') {
                        hideSocialMediaModal();
                    } else if (visibleModal.id === 'helpModal') {
                        hideHelpModal();
                    }
                    return; // Exit early, don't check for edit mode
                }
                
                // Check if mobile menu is open
                const mobileMenu = document.querySelector('.mobile-menu');
                if (mobileMenu && mobileMenu.classList.contains('active')) {
                    closeMobileMenu();
                    return; // Exit early, don't check for edit mode
                }
                
                // Check if desktop menu is open
                const desktopMenu = document.getElementById('desktopMenu');
                if (desktopMenu && desktopMenu.classList.contains('show')) {
                    desktopMenu.classList.remove('show');
                    document.removeEventListener('click', handleDesktopMenuClickOutside);
                    document.removeEventListener('mousedown', handleDesktopMenuMouseDown);
                    return; // Exit early, don't check for edit mode
                }
                
                // No modal or menu open, check if search has filter applied
                    const filterInput = document.getElementById('filterInput');
                    const mobileFilterInput = document.getElementById('mobileFilterInput');
                    
                    if (filterInput && filterInput.value.trim() !== '') {
                        clearSearch();
                    return; // Exit early, don't check for edit mode
                    } else if (mobileFilterInput && mobileFilterInput.value.trim() !== '') {
                        clearMobileSearch();
                    return; // Exit early, don't check for edit mode
                    }
                
                // No modal, menu, or search active - now check if edit mode is active
                const container = document.querySelector('.container');
                if (container && container.classList.contains('edit-mode')) {
                    toggleEditMode();
                }
            } else if (event.key === 'Enter') {
                const visibleModal = document.querySelector('.modal-overlay:not(.hidden)');
                if (visibleModal) {
                    event.preventDefault();
                    // Save and close modal
                    if (visibleModal.id === 'addCategoryModal') {
                        addCategory();
                    } else if (visibleModal.id === 'editCategoryModal') {
                        saveEditCategory();
                    } else if (visibleModal.id === 'editServerModal') {
                        saveServerEdit();
                    } else if (visibleModal.id === 'editTitleModal') {
                        saveTitleEdit();
                    } else if (visibleModal.id === 'editHeaderModal') {
                        saveHeaderEdit();
                    }
                }
            }
        }

        // Start the app
        init();

        // URL popup toggle function
        function toggleUrlPopup(serverItem, urlPopup) {
            // Close all other open popups first
            document.querySelectorAll('.url-popup.manual-open').forEach(popup => {
                if (popup !== urlPopup) {
                    popup.classList.remove('manual-open');
                    popup.closest('.server-item').classList.remove('has-manual-popup');
                    // Remove active state from other buttons
                    const otherBtn = popup.closest('.server-item').querySelector('.url-popup-btn');
                    if (otherBtn) otherBtn.classList.remove('active');
                }
            });

            // Toggle current popup
            const popupBtn = serverItem.querySelector('.url-popup-btn');
            if (urlPopup.classList.contains('manual-open')) {
                urlPopup.classList.remove('manual-open');
                serverItem.classList.remove('has-manual-popup');
                if (popupBtn) popupBtn.classList.remove('active');
            } else {
                urlPopup.classList.add('manual-open');
                serverItem.classList.add('has-manual-popup');
                if (popupBtn) popupBtn.classList.add('active');
            }
        }

        // Close URL popup when clicking outside
        document.addEventListener('click', function(event) {
            const urlPopups = document.querySelectorAll('.url-popup.manual-open');
            urlPopups.forEach(popup => {
                const serverItem = popup.closest('.server-item');
                const popupBtn = serverItem.querySelector('.url-popup-btn');
                const popupBtnContainer = serverItem.querySelector('.url-popup-btn-container');
                
                // Check if click is outside the popup and not on the popup button or its container
                if (!popup.contains(event.target) && !popupBtnContainer.contains(event.target)) {
                    popup.classList.remove('manual-open');
                    serverItem.classList.remove('has-manual-popup');
                    if (popupBtn) popupBtn.classList.remove('active');
                }
            });
        });

        // Copy URL to clipboard
        async function copyUrlToClipboard(url, button) {
            try {
                await navigator.clipboard.writeText(url);
                
                // Show temporary success feedback
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = t('copiedUrl');
                    button.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    button.style.color = 'white';
                    button.style.borderColor = '#22c55e';
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                        button.style.color = '';
                        button.style.borderColor = '';
                    }, 1500);
                }
                
            } catch (err) {
                console.error('Failed to copy URL:', err);
                
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show feedback
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = t('copiedUrl');
                    button.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    button.style.color = 'white';
                    button.style.borderColor = '#22c55e';
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                        button.style.color = '';
                        button.style.borderColor = '';
                    }, 1500);
                }
            }
        }

        // Help modal functions
        function showHelpModal() {
            const modal = document.getElementById('helpModal');
            const title = document.getElementById('helpModalTitle');
            const content = document.getElementById('helpModalContent');
            
            // Set title based on language
            title.textContent = currentLanguage === 'he' ? '◊ê◊ô◊†◊ì◊ß◊° ◊©◊ô◊®◊ï◊™◊ô◊ù ◊ê◊ô◊©◊ô - ◊¢◊ñ◊®◊î' : 'Personal Services Index - Help';
            
            // Set content based on language
            content.innerHTML = currentLanguage === 'he' ? getHebrewHelpContent() : getEnglishHelpContent();
            
            modal.classList.remove('hidden');
        }

        function hideHelpModal() {
            const modal = document.getElementById('helpModal');
            modal.classList.add('hidden');
        }


        function updateGoogleAnalytics(analyticsCode) {
            // Remove existing Google Analytics scripts
            const existingScripts = document.querySelectorAll('script[src*="googletagmanager.com"], script[src*="google-analytics.com"]');
            existingScripts.forEach(script => script.remove());
            
            // Remove existing gtag function
            if (window.gtag) {
                delete window.gtag;
            }
            
            // If analytics code is provided, add Google Analytics
            if (analyticsCode) {
                // Add Google Analytics script
                const gaScript = document.createElement('script');
                gaScript.async = true;
                gaScript.src = `https://www.googletagmanager.com/gtag/js?id=${analyticsCode}`;
                document.head.appendChild(gaScript);
                
                // Add gtag configuration
                const gtagScript = document.createElement('script');
                gtagScript.innerHTML = `
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', '${analyticsCode}');
                `;
                document.head.appendChild(gtagScript);
                
                console.log('‚úÖ Google Analytics enabled with code:', analyticsCode);
            } else {
                console.log('‚úÖ Google Analytics disabled');
            }
            
            // Update input fields to show masked values if GA is loaded
            updateGoogleAnalyticsInputFields();
        }

        function updateGoogleAnalyticsInputFields() {
            const isGALoaded = isGoogleAnalyticsLoaded();
            const analyticsCode = localStorage.getItem('googleAnalyticsCode') || '';
            
            // Update desktop input
            const desktopInput = document.getElementById('desktopGoogleAnalyticsCode');
            if (desktopInput) {
                if (isGALoaded && analyticsCode) {
                    desktopInput.value = '*'.repeat(analyticsCode.length);
                    desktopInput.setAttribute('data-masked', 'true');
                } else {
                    desktopInput.value = analyticsCode;
                    desktopInput.removeAttribute('data-masked');
                }
            }
            
            // Update mobile input
            const mobileInput = document.getElementById('mobileGoogleAnalyticsCode');
            if (mobileInput) {
                if (isGALoaded && analyticsCode) {
                    mobileInput.value = '*'.repeat(analyticsCode.length);
                    mobileInput.setAttribute('data-masked', 'true');
                } else {
                    mobileInput.value = analyticsCode;
                    mobileInput.removeAttribute('data-masked');
                }
            }
        }

        function isGoogleAnalyticsLoaded() {
            // Check if Google Analytics scripts are present
            const gaScripts = document.querySelectorAll('script[src*="googletagmanager.com"], script[src*="google-analytics.com"]');
            return gaScripts.length > 0 || window.gtag !== undefined;
        }

        function updateSocialMediaBarVisibility(show) {
            const socialMediaBar = document.getElementById('socialMediaBar');
            if (socialMediaBar) {
                if (show) {
                    socialMediaBar.style.display = 'block';
                } else {
                    socialMediaBar.style.display = 'none';
                }
            }
        }
        function resetAllSettings() {
            const warningMessage = currentLanguage === 'he' 
                ? '◊ú◊ê◊§◊° ◊ê◊™ ◊õ◊ú ◊î◊î◊í◊ì◊®◊ï◊™ ◊ï◊î◊®◊©◊ô◊û◊î? ◊§◊¢◊ï◊ú◊î ◊ñ◊ï ◊ú◊ê ◊†◊ô◊™◊†◊™ ◊ú◊ë◊ô◊ò◊ï◊ú.'
                : 'Are you sure you want to reset all settings and the list? This action cannot be undone.';
            
            if (confirm(warningMessage)) {
                // Clear all localStorage
                localStorage.clear();
                
                // Reset to language-appropriate defaults
                resetToLanguageDefaults();
                
                // Reset dark mode to default
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
                
                // Clear Google Analytics
                updateGoogleAnalytics('');
                
                // Hide social media bar by default
                updateSocialMediaBarVisibility(false);
                
                // Enable server status check by default
                localStorage.setItem('serverStatusCheckEnabled', 'true');
                
                // Enable Most Used Websites by default
                localStorage.setItem('mostUsedWebsitesEnabled', 'true');
                localStorage.setItem('mostUsedWebsitesMode', 'popular');
                
                // Clear website click data
                localStorage.removeItem('websiteClickData');
                
                // Update UI
                updateDashboard();
                updateServerList();
                updateTitleList();
                updateSocialMediaBar();
                
                // Re-render categories to show fresh state
                renderCategories();
                
                // Close both mobile and desktop menus so the user can see the alert
                closeAllMenus();
                
                // Show success notification
                const notification = document.getElementById('changesNotification');
                if (notification) {
                    notification.innerHTML = '<button class="notification-close-btn" onclick="hideChangesNotification()" title="' + t('close') + '">‚úï</button>' + (currentLanguage === 'he' ? '◊î◊õ◊ú ◊ê◊ï◊§◊° ◊ë◊î◊¶◊ú◊ó◊î' : 'Everything reset successfully');
                    notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    notification.style.color = 'white';
                    notification.style.borderColor = '#22c55e';
                    notification.classList.add('show');
                    
                    // Auto-hide success notification after 3 seconds
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                }
                
                console.log('‚úÖ All settings and data reset successfully');
                
                // Automatically reload the page with new settings after a short delay
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }



        function getEnglishHelpContent() {

            return `
                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-bottom: 0.5rem;">üìã Welcome to Your Personal Dashboard!</h4>
                <p>This page is your private, customizable launchpad for all your favorite websites and local services. Everything you need, one click away‚Äîright in your browser, with no data ever sent to a server.</p>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üöÄ What Can You Do?</h4>
                <ul style="list-style: none; padding-left: 0;">
                    <li style="margin-bottom: 0.5rem;">üé® <strong>Organize:</strong> Group your links into categories like "Work", "Fun", or "Projects".</li>
                    <li style="margin-bottom: 0.5rem;">üö¶ <strong>Status at a Glance:</strong> Instantly see which services are online.</li>
                    <li style="margin-bottom: 0.5rem;">üíæ <strong>Backup & Restore:</strong> Save your setup to a file, or import it back anytime.</li>
                    <li style="margin-bottom: 0.5rem;">üì§ <strong>Share:</strong> Create a special link to share your dashboard layout (all data is packed into the link itself).</li>
                    <li style="margin-bottom: 0.5rem;">üåô <strong>Dark/Light Mode & Language:</strong> Toggle between color themes and English/Hebrew.</li>
                </ul>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üîç Quick Start</h4>
                <ol>
                    <li>On mobile, use the menu to access all features. On desktop, some buttons (edit, import, export, language, dark mode) are available in the menu only.</li>
                    <li>Click <strong>‚úèÔ∏è Edit Mode</strong> to unlock editing.</li>
                    <li>Use <strong>‚ûï Add Category</strong> to create a group, then <strong>‚ûï Add URL</strong> to add links.</li>
                    <li>Customize colors, icons, and even add social media links at the bottom bar.</li>
                    <li>Your changes are saved automatically in your browser.</li>
                </ol>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üîí Privacy First</h4>
                <ul style="list-style: none; padding-left: 0;">
                    <li>‚úÖ <strong>Local Only:</strong> All your data stays in your browser. Nothing is sent or stored online.</li>
                    <li>‚úÖ <strong>Self-contained Sharing:</strong> Shared links contain all your data‚Äîno server needed.</li>
                    <li>‚úÖ <strong>Full Control:</strong> Export/import your setup as a file whenever you want.</li>
                </ul>
            `;
        }

        function getHebrewHelpContent() {

            return `
                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-bottom: 0.5rem;">üìã ◊ë◊®◊ï◊õ◊ô◊ù ◊î◊ë◊ê◊ô◊ù ◊ú◊ì◊©◊ë◊ï◊®◊ì ◊î◊ê◊ô◊©◊ô ◊©◊ú◊õ◊ù!</h4>
                <p>◊î◊¢◊û◊ï◊ì ◊î◊ñ◊î ◊î◊ï◊ê ◊ú◊ï◊ó ◊î◊ë◊ß◊®◊î ◊î◊§◊®◊ò◊ô ◊ï◊î◊û◊ï◊™◊ê◊ù ◊©◊ú◊õ◊ù ◊ú◊õ◊ú ◊î◊ê◊™◊®◊ô◊ù ◊ï◊î◊©◊ô◊®◊ï◊™◊ô◊ù ◊©◊ê◊™◊ù ◊ê◊ï◊î◊ë◊ô◊ù. ◊î◊õ◊ú ◊ë◊ú◊ó◊ô◊¶◊î ◊ê◊ó◊™, ◊ô◊©◊ô◊®◊ï◊™ ◊û◊î◊ì◊§◊ì◊§◊ü ‚Äì ◊ë◊ú◊ô ◊ú◊©◊ú◊ï◊ó ◊†◊™◊ï◊†◊ô◊ù ◊ú◊©◊ï◊ù ◊©◊®◊™.</p>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üöÄ ◊û◊î ◊ê◊§◊©◊® ◊ú◊¢◊©◊ï◊™?</h4>
                <ul style="list-style: none; padding-right: 0;">
                    <li style="margin-bottom: 0.5rem;">üé® <strong>◊ê◊®◊í◊ï◊ü:</strong> ◊°◊ì◊®◊ï ◊ß◊ô◊©◊ï◊®◊ô◊ù ◊ë◊ß◊ò◊í◊ï◊®◊ô◊ï◊™ ◊õ◊û◊ï "◊¢◊ë◊ï◊ì◊î", "◊õ◊ô◊£" ◊ê◊ï "◊§◊®◊ï◊ô◊ß◊ò◊ô◊ù".</li>
                    <li style="margin-bottom: 0.5rem;">üö¶ <strong>◊°◊ò◊ò◊ï◊° ◊ë◊û◊ë◊ò:</strong> ◊®◊ê◊ï ◊û◊ô◊ì ◊ê◊ô◊ú◊ï ◊©◊ô◊®◊ï◊™◊ô◊ù ◊ñ◊û◊ô◊†◊ô◊ù.</li>
                    <li style="margin-bottom: 0.5rem;">üíæ <strong>◊í◊ô◊ë◊ï◊ô ◊ï◊©◊ó◊ñ◊ï◊®:</strong> ◊©◊û◊®◊ï ◊ê◊™ ◊î◊î◊í◊ì◊®◊ï◊™ ◊ú◊ß◊ï◊ë◊•, ◊ê◊ï ◊ô◊ô◊ë◊ê◊ï ◊ê◊ï◊™◊ü ◊ó◊ñ◊®◊î ◊ë◊õ◊ú ◊¢◊™.</li>
                    <li style="margin-bottom: 0.5rem;">üì§ <strong>◊©◊ô◊™◊ï◊£:</strong> ◊¶◊®◊ï ◊ß◊ô◊©◊ï◊® ◊û◊ô◊ï◊ó◊ì ◊ú◊©◊ô◊™◊ï◊£ ◊î◊ì◊©◊ë◊ï◊®◊ì (◊õ◊ú ◊î◊û◊ô◊ì◊¢ ◊†◊û◊¶◊ê ◊ë◊ß◊ô◊©◊ï◊® ◊¢◊¶◊û◊ï).</li>
                    <li style="margin-bottom: 0.5rem;">üåô <strong>◊û◊¶◊ë ◊õ◊î◊î/◊ë◊î◊ô◊® ◊ï◊©◊§◊î:</strong> ◊¢◊ë◊®◊ï ◊ë◊ô◊ü ◊¢◊®◊õ◊ï◊™ ◊¶◊ë◊¢◊ô◊ù ◊ï◊ê◊†◊í◊ú◊ô◊™/◊¢◊ë◊®◊ô◊™.</li>
                </ul>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üîç ◊û◊ì◊®◊ô◊ö ◊û◊î◊ô◊®</h4>
                <ol>
                    <li>◊ë◊û◊ï◊ë◊ô◊ô◊ú, ◊õ◊ú ◊î◊§◊ô◊¶'◊®◊ô◊ù ◊ñ◊û◊ô◊†◊ô◊ù ◊ë◊™◊§◊®◊ô◊ò. ◊ë◊ì◊°◊ß◊ò◊ï◊§, ◊ó◊ú◊ß ◊û◊î◊õ◊§◊™◊ï◊®◊ô◊ù (◊¢◊®◊ô◊õ◊î, ◊ô◊ô◊ë◊ï◊ê, ◊ô◊ô◊¶◊ï◊ê, ◊©◊§◊î, ◊û◊¶◊ë ◊õ◊î◊î) ◊ñ◊û◊ô◊†◊ô◊ù ◊®◊ß ◊ë◊™◊§◊®◊ô◊ò.</li>
                    <li>◊ú◊ó◊¶◊ï ◊¢◊ú <strong>‚úèÔ∏è ◊û◊¶◊ë ◊¢◊®◊ô◊õ◊î</strong> ◊õ◊ì◊ô ◊ú◊ê◊§◊©◊® ◊¢◊®◊ô◊õ◊î.</li>
                    <li>◊î◊ï◊°◊ô◊§◊ï <strong>‚ûï ◊ß◊ò◊í◊ï◊®◊ô◊î</strong> ◊ú◊ô◊¶◊ô◊®◊™ ◊ß◊ë◊ï◊¶◊î, ◊ï◊ê◊ñ <strong>‚ûï ◊ê◊™◊®</strong> ◊ú◊î◊ï◊°◊§◊™ ◊ß◊ô◊©◊ï◊®◊ô◊ù.</li>
                    <li>◊î◊™◊ê◊ô◊û◊ï ◊¶◊ë◊¢◊ô◊ù, ◊ê◊ô◊ô◊ß◊ï◊†◊ô◊ù, ◊ï◊î◊ï◊°◊ô◊§◊ï ◊®◊©◊™◊ï◊™ ◊ó◊ë◊®◊™◊ô◊ï◊™ ◊ë◊°◊®◊í◊ú ◊î◊™◊ó◊™◊ï◊ü.</li>
                    <li>◊î◊õ◊ú ◊†◊©◊û◊® ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™ ◊ë◊ì◊§◊ì◊§◊ü ◊©◊ú◊õ◊ù.</li>
                </ol>

                <h4 style="color: var(--accent-color, #6366f1); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem;">üîí ◊§◊®◊ò◊ô◊ï◊™ ◊û◊¢◊ú ◊î◊õ◊ú</h4>
                <ul style="list-style: none; padding-right: 0;">
                    <li>‚úÖ <strong>◊î◊õ◊ú ◊û◊ß◊ï◊û◊ô:</strong> ◊õ◊ú ◊î◊û◊ô◊ì◊¢ ◊†◊©◊ê◊® ◊ë◊ì◊§◊ì◊§◊ü ◊©◊ú◊õ◊ù. ◊©◊ï◊ù ◊ì◊ë◊® ◊ú◊ê ◊†◊©◊ú◊ó ◊ê◊ï ◊†◊©◊û◊® ◊ê◊ï◊†◊ú◊ô◊ô◊ü.</li>
                    <li>‚úÖ <strong>◊©◊ô◊™◊ï◊£ ◊¢◊¶◊û◊ê◊ô:</strong> ◊ß◊ô◊©◊ï◊®◊ô ◊©◊ô◊™◊ï◊£ ◊û◊õ◊ô◊ú◊ô◊ù ◊ê◊™ ◊õ◊ú ◊î◊û◊ô◊ì◊¢ ‚Äì ◊ë◊ú◊ô ◊©◊®◊™.</li>
                    <li>‚úÖ <strong>◊©◊ú◊ô◊ò◊î ◊û◊ú◊ê◊î:</strong> ◊ô◊ô◊¶◊ê◊ï/◊ô◊ô◊ë◊ê◊ï ◊ê◊™ ◊î◊î◊í◊ì◊®◊ï◊™ ◊õ◊ß◊ï◊ë◊• ◊û◊™◊ô ◊©◊™◊®◊¶◊ï.</li>
                </ul>
            `;
        }

        // Global variables for edit modals
    </script>
    <style>
        /* Modal close button styles */
        .modal .btn-ghost[title="Close"] {
            background: none !important;
            border: none !important;
            font-size: 1.25rem !important;
            color: var(--text-muted) !important;
            cursor: pointer !important;
            padding: 0.5rem !important;
            border-radius: 50% !important;
            width: 2rem !important;
            height: 2rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s !important;
        }
        
        .modal .btn-ghost[title="Close"]:hover {
            background: rgba(148, 163, 184, 0.2) !important;
            color: var(--text-primary) !important;
        }
        
        /* Share modal button styles */
        #shareOptionsModal .modal-actions .btn {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            text-align: center !important;
            min-height: 4rem !important;
            padding: 0.75rem 1rem !important;
            gap: 0.25rem !important;
        }
        
        #shareOptionsModal .modal-actions .btn::before {
            content: attr(data-icon);
            font-size: 1.5rem !important;
            line-height: 1 !important;
        }
    </style>
</body>
</html>